<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.31">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>3&nbsp; Data visualization – Modern Statistics for Modern Biology</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./imgs/msmb-favicon.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-af5ec82acda093b5ee751184164e9432.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-d63985d606c7f07261ad561a6cfde940.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="msmb.css">
<meta property="og:title" content="3&nbsp; Data visualization – Modern Statistics for Modern Biology">
<meta property="og:description" content="If you are a biologist and want to get the best out of the powerful methods of modern computational statistics, this is your book.">
<meta property="og:image" content="https://www.huber.embl.de/msmb/03-chap_files/figure-html/fig-graphics-onedridge4-1.png">
<meta property="og:site_name" content="Modern Statistics for Modern Biology">
<meta property="og:image:height" content="480">
<meta property="og:image:width" content="560">
<meta name="twitter:title" content="3&nbsp; Data visualization – Modern Statistics for Modern Biology">
<meta name="twitter:description" content="If you are a biologist and want to get the best out of the powerful methods of modern computational statistics, this is your book.">
<meta name="twitter:image" content="https://www.huber.embl.de/msmb/03-chap_files/figure-html/fig-graphics-onedridge4-1.png">
<meta name="twitter:card" content="summary">
<meta name="twitter:image-height" content="480">
<meta name="twitter:image-width" content="560">
<script type="text/javascript">
  var _paq = _paq || [];
  
  // Call disableCookies before calling trackPageView 
  _paq.push(['disableCookies']);
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u='//tr-denbi.embl.de/heimdall/';
    _paq.push(['setTrackerUrl', u+'p.php']);
    _paq.push(['setSiteId', '26']);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'p.js'; s.parentNode.insertBefore(g,s);
  })();
</script>

</head>

<body class="floating nav-fixed slimcontent quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Modern Statistics for Modern Biology</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-chapters" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Chapters</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-chapters">    
        <li>
    <a class="dropdown-item" href="./index.html">
 <span class="dropdown-text">Home</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./00-chap.html">
 <span class="dropdown-text">Introduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./01-chap.html">
 <span class="dropdown-text">Generative Models for Discrete Data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./02-chap.html">
 <span class="dropdown-text">Statistical Modeling</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03-chap.html">
 <span class="dropdown-text">Data visualization</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./04-chap.html">
 <span class="dropdown-text">Mixture Models</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./05-chap.html">
 <span class="dropdown-text">Clustering</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./06-chap.html">
 <span class="dropdown-text">Testing</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./07-chap.html">
 <span class="dropdown-text">Multivariate Analysis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./08-chap.html">
 <span class="dropdown-text">High-Throughput Count Data &amp; Generalized Linear Models</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./09-chap.html">
 <span class="dropdown-text">Multivariate methods for heterogeneous data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./10-chap.html">
 <span class="dropdown-text">Networks and Trees</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./11-chap.html">
 <span class="dropdown-text">Image data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./12-chap.html">
 <span class="dropdown-text">Supervised Learning</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./13-chap.html">
 <span class="dropdown-text">Design of High Throughput Experiments and their Analyses</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./14-chap.html">
 <span class="dropdown-text">Statistical Concordance</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./15-chap.html">
 <span class="dropdown-text">Acknowledgements</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./16-chap.html">
 <span class="dropdown-text">References</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Sections</h2>
   
  <ul class="collapse">
  <li><a href="#goals-for-this-chapter" id="toc-goals-for-this-chapter" class="nav-link active" data-scroll-target="#goals-for-this-chapter"><span class="header-section-number">3.1</span> Goals for this chapter</a></li>
  <li><a href="#base-r-plotting" id="toc-base-r-plotting" class="nav-link" data-scroll-target="#base-r-plotting"><span class="header-section-number">3.2</span> Base R plotting</a></li>
  <li><a href="#sec-graphics-exampledata" id="toc-sec-graphics-exampledata" class="nav-link" data-scroll-target="#sec-graphics-exampledata"><span class="header-section-number">3.3</span> An example dataset</a></li>
  <li><a href="#sec-graphics-ggplot" id="toc-sec-graphics-ggplot" class="nav-link" data-scroll-target="#sec-graphics-ggplot"><span class="header-section-number">3.4</span> ggplot2</a></li>
  <li><a href="#the-grammar-of-graphics" id="toc-the-grammar-of-graphics" class="nav-link" data-scroll-target="#the-grammar-of-graphics"><span class="header-section-number">3.5</span> The grammar of graphics</a></li>
  <li><a href="#sec-graphics-univar" id="toc-sec-graphics-univar" class="nav-link" data-scroll-target="#sec-graphics-univar"><span class="header-section-number">3.6</span> Visualizing data in 1D</a></li>
  <li><a href="#sec-graphics-2d" id="toc-sec-graphics-2d" class="nav-link" data-scroll-target="#sec-graphics-2d"><span class="header-section-number">3.7</span> Visualizing data in 2D: scatterplots</a></li>
  <li><a href="#sec-graphics-facets" id="toc-sec-graphics-facets" class="nav-link" data-scroll-target="#sec-graphics-facets"><span class="header-section-number">3.8</span> Visualizing more than two dimensions</a></li>
  <li><a href="#sec-graphics-color" id="toc-sec-graphics-color" class="nav-link" data-scroll-target="#sec-graphics-color"><span class="header-section-number">3.9</span> Color</a></li>
  <li><a href="#heatmaps" id="toc-heatmaps" class="nav-link" data-scroll-target="#heatmaps"><span class="header-section-number">3.10</span> Heatmaps</a></li>
  <li><a href="#data-transformations" id="toc-data-transformations" class="nav-link" data-scroll-target="#data-transformations"><span class="header-section-number">3.11</span> Data transformations</a></li>
  <li><a href="#mathematical-symbols-and-other-fonts" id="toc-mathematical-symbols-and-other-fonts" class="nav-link" data-scroll-target="#mathematical-symbols-and-other-fonts"><span class="header-section-number">3.12</span> Mathematical symbols and other fonts</a></li>
  <li><a href="#genomic-data" id="toc-genomic-data" class="nav-link" data-scroll-target="#genomic-data"><span class="header-section-number">3.13</span> Genomic data</a></li>
  <li><a href="#summary-of-this-chapter" id="toc-summary-of-this-chapter" class="nav-link" data-scroll-target="#summary-of-this-chapter"><span class="header-section-number">3.14</span> Summary of this chapter</a></li>
  <li><a href="#further-reading" id="toc-further-reading" class="nav-link" data-scroll-target="#further-reading"><span class="header-section-number">3.15</span> Further reading</a></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises"><span class="header-section-number">3.16</span> Exercises</a></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-graphics" class="quarto-section-identifier"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Data visualization</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="cell page-columns page-full" data-layout-align="center">

<div class="no-row-height column-margin column-container"><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="imgs/xkcd-plotting.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img src="imgs/xkcd-plotting.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></a></p>
</figure>
</div>
</div></div></div>
<p>There are (at least) two types of data visualization. The first enables a scientist to explore data and make discoveries about the complex processes at work. The other type of visualization provides informative, clear and visually attractive illustrations of her results that she can show to others and eventually include in a publication.</p>
<p>Both of these types of visualizations can be made with R. In fact, R offers multiple graphics systems. This is because R is extensible, and because progress in R graphics over the years has proceeded largely not by replacing the old functions, but by adding packages. Each of the different graphics systems has its advantages and limitations. In this chapter we will get to know two of them. First, we have a cursory look at the base R plotting functions<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>. Subsequently we will switch to <strong><a href="https://cran.r-project.org/web/packages/ggplot2/">ggplot2</a></strong>.</p>
<div class="no-row-height column-margin column-container"><div id="fn1"><p><sup>1</sup>&nbsp;They live in the <strong><a href="https://cran.r-project.org/web/packages/graphics/">graphics</a></strong> package, which ships with every basic R installation.</p></div></div><div class="cell page-columns page-full" data-layout-align="center">

<div class="no-row-height column-margin column-container"><div class="cell-output-display">
<div id="fig-graphics-plotter" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-graphics-plotter-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="imgs/Automatisches_Zeichengeraet_ZUSE_Z64_ubt_web.jpg" class="lightbox" data-gallery="quarto-lightbox-gallery-2" title="Figure&nbsp;3.1: The ZUSE Plotter Z64 (presented in 1961). Source: https://en.wikipedia.org/wiki/Plotter."><img src="imgs/Automatisches_Zeichengeraet_ZUSE_Z64_ubt_web.jpg" class="img-fluid quarto-figure quarto-figure-center figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-graphics-plotter-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.1: The ZUSE Plotter Z64 (presented in 1961). Source: <a href="https://en.wikipedia.org/wiki/Plotter">https://en.wikipedia.org/wiki/Plotter</a>.
</figcaption>
</figure>
</div>
</div></div></div>
<p>Base R graphics came historically first: simple, procedural, conceptually motivated by drawing on a canvas. There are specialized functions for different types of plots. These are easy to call – but when you want to combine them to build up more complex plots, or exchange one for another, this quickly gets messy, or even impossible. The user plots (the word harks back to some of the first graphics devices – see <a href="#fig-graphics-plotter" class="quarto-xref">Figure&nbsp;<span>3.1</span></a>) directly onto a (conceptual) canvas. She explicitly needs to deal with decisions such as how much space to allocate to margins, axes labels, titles, legends, subpanels; once something is “plotted” it cannot be moved or erased.</p>
<p>There is a more high-level approach: in the <em>grammar of graphics</em>, graphics are built up from modular logical pieces, so that we can easily try different visualization types for our data in an intuitive and easily deciphered way, like we can switch in and out parts of a sentence in human language. There is no concept of a canvas or a plotter, rather, the user gives <strong><a href="https://cran.r-project.org/web/packages/ggplot2/">ggplot2</a></strong> a high-level description of the plot she wants, in the form of an R object, and the rendering engine takes a wholistic view on the scene to lay out the graphics and render them on the output device.</p>
<section id="goals-for-this-chapter" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="goals-for-this-chapter"><span class="header-section-number">3.1</span> Goals for this chapter</h2>
<p>In this chapter, we will:</p>
<ul>
<li><p>Learn how to rapidly and flexibly explore datasets by visualization.</p></li>
<li><p>Create beautiful and intuitive plots for scientific presentations and publications.</p></li>
<li><p>Review the basics of base R plotting.</p></li>
<li><p>Understand the logic behind the <em>grammar of graphics</em> concept.</p></li>
<li><p>Introduce <strong><a href="https://cran.r-project.org/web/packages/ggplot2/">ggplot2</a></strong>’s <code>ggplot</code> function.</p></li>
<li><p>See how to plot data in one, two, or even three to five dimensions, and explore faceting.</p></li>
<li><p>Create “along-genome” plots for molecular biology data (or along other sequences, e.g., peptides).</p></li>
<li><p>Discuss some of our options of interactive graphics.</p></li>
</ul>
</section>
<section id="base-r-plotting" class="level2 page-columns page-full" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="base-r-plotting"><span class="header-section-number">3.2</span> Base R plotting</h2>
<p>The most basic function is <code>plot</code>. In the code below, the output of which is shown in <a href="#fig-graphics-basicplotting1" class="quarto-xref">Figure&nbsp;<span>3.2</span></a>, it is used to plot data from an enzyme-linked immunosorbent assay (ELISA) assay. The assay was used to quantify the activity of the enzyme deoxyribonuclease (DNase), which degrades DNA. The data are assembled in the R object <code>DNase</code>, which conveniently comes with base R. The object <code>DNase</code> is a dataframe whose columns are <code>Run</code>, the assay run; <code>conc</code>, the protein concentration that was used; and <code>density</code>, the measured optical density.</p>
<div class="cell page-columns page-full" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(DNase)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Run       conc density
1   1 0.04882812   0.017
2   1 0.04882812   0.018
3   1 0.19531250   0.121
4   1 0.19531250   0.124
5   1 0.39062500   0.206
6   1 0.39062500   0.215</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(DNase<span class="sc">$</span>conc, DNase<span class="sc">$</span>density)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

<div class="no-row-height column-margin column-container"><div class="cell-output-display">
<div id="fig-graphics-basicplotting1" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-graphics-basicplotting1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="03-chap_files/figure-html/fig-graphics-basicplotting1-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3" title="Figure&nbsp;3.2: Plot of concentration vs.&nbsp;density for an ELISA assay of DNase."><img src="03-chap_files/figure-html/fig-graphics-basicplotting1-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="320"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-graphics-basicplotting1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.2: Plot of concentration vs.&nbsp;density for an ELISA assay of DNase.
</figcaption>
</figure>
</div>
</div></div></div>
<p>This basic plot can be customized, for example by changing the plot symbol and axis labels using the parameters <code>xlab</code>, <code>ylab</code> and <code>pch</code> (plot character), as shown in <a href="#fig-graphics-basicplotting2" class="quarto-xref">Figure&nbsp;<span>3.3</span></a>. Information about the variables is stored in the object <code>DNase</code>, and we can access it with the <code>attr</code> function.</p>
<div class="cell page-columns page-full" data-layout-align="center">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(DNase<span class="sc">$</span>conc, DNase<span class="sc">$</span>density,</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylab =</span> <span class="fu">attr</span>(DNase, <span class="st">"labels"</span>)<span class="sc">$</span>y,</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="fu">paste</span>(<span class="fu">attr</span>(DNase, <span class="st">"labels"</span>)<span class="sc">$</span>x, <span class="fu">attr</span>(DNase, <span class="st">"units"</span>)<span class="sc">$</span>x),</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">pch =</span> <span class="dv">3</span>,</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">col =</span> <span class="st">"blue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

<div class="no-row-height column-margin column-container"><div class="cell-output-display">
<div id="fig-graphics-basicplotting2" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-graphics-basicplotting2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="03-chap_files/figure-html/fig-graphics-basicplotting2-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4" title="Figure&nbsp;3.3: Same data as in Figure&nbsp;fig-graphics-basicplotting1 but with better axis labels and a different plot symbol."><img src="03-chap_files/figure-html/fig-graphics-basicplotting2-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="320"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-graphics-basicplotting2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.3: Same data as in <a href="#fig-graphics-basicplotting1" class="quarto-xref">Figure&nbsp;<span>3.2</span></a> but with better axis labels and a different plot symbol.
</figcaption>
</figure>
</div>
</div></div></div>
<div id="wrn-graphics-metadata" class="callout callout-style-default callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Question&nbsp;3.1
</div>
</div>
<div class="callout-body-container callout-body">
<p>Annotating dataframe columns with “metadata” such as longer descriptions, physical units, provenance information, etc., seems like a useful feature. Is this way of storing such information, as in the <code>DNase</code> object, standardized or common across the R ecosystem? Are there other standardized or common ways for doing this?</p>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>There is no good or widely used infrastructure in regular R <em>data.frame</em>s for this, nor in the tidyverse (<em>data_frame</em>, <em>tibble</em>). But have a look at the <em>DataFrame</em> class in the Bioconductor package <strong><a href="https://bioconductor.org/packages/S4Vectors/">S4Vectors</a></strong>. Among other things it is used to annotate the rows and columns of a <em>SummarizedExperiment</em>.</p>
</div>
</div>
</div>
<p>Besides scatterplots, we can also use built-in functions to create histograms and boxplots (<a href="#fig-graphics-basicplotting3" class="quarto-xref">Figure&nbsp;<span>3.4</span></a>).</p>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(DNase<span class="sc">$</span>density, <span class="at">breaks=</span><span class="dv">25</span>, <span class="at">main =</span> <span class="st">""</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(density <span class="sc">~</span> Run, <span class="at">data =</span> DNase)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-graphics-basicplotting3" class="quarto-layout-panel page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-graphics-basicplotting3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<div class="quarto-layout-row page-full">

<div class="no-row-height column-margin column-container"><div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-graphics-basicplotting3" style="flex-basis: 100.0%;justify-content: center;">
<div id="fig-graphics-basicplotting3-1" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center" width="240">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-graphics-basicplotting3-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="03-chap_files/figure-html/fig-graphics-basicplotting3-1.png" class="lightbox" data-gallery="fig-graphics-basicplotting3" title="Figure&nbsp;3.4&nbsp;(a): "><img src="03-chap_files/figure-html/fig-graphics-basicplotting3-1.png" id="fig-graphics-basicplotting3-1" class="img-fluid quarto-figure quarto-figure-center anchored figure-img" data-ref-parent="fig-graphics-basicplotting3" width="240"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-graphics-basicplotting3-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a)
</figcaption>
</figure>
</div>
</div></div></div>
<div class="quarto-layout-row page-full">

<div class="no-row-height column-margin column-container"><div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-graphics-basicplotting3" style="flex-basis: 100.0%;justify-content: center;">
<div id="fig-graphics-basicplotting3-2" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center" width="240">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-graphics-basicplotting3-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="03-chap_files/figure-html/fig-graphics-basicplotting3-2.png" class="lightbox" data-gallery="fig-graphics-basicplotting3" title="Figure&nbsp;3.4&nbsp;(b): "><img src="03-chap_files/figure-html/fig-graphics-basicplotting3-2.png" id="fig-graphics-basicplotting3-2" class="img-fluid quarto-figure quarto-figure-center anchored figure-img" data-ref-parent="fig-graphics-basicplotting3" width="240"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-graphics-basicplotting3-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b)
</figcaption>
</figure>
</div>
</div></div></div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-graphics-basicplotting3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.4: (a) Histogram of the density from the ELISA assay, and (b) boxplots of these values stratified by the assay run. The boxes are ordered along the axis in lexicographical order because the runs were stored as text strings. We could use R’s type conversion functions to achieve numerical ordering.
</figcaption>
</figure>
</div>
<p>Boxplots are convenient for showing multiple distributions next to each other in a compact space. We will see more about plotting multiple univariate distributions in <a href="#sec-graphics-univar" class="quarto-xref"><span>Section 3.6</span></a>.</p>
<p>The base R plotting functions are great for quick interactive exploration of data; but we run soon into their limitations if we want to create more sophisticated displays. We are going to use a visualization framework called the grammar of graphics, implemented in the package <strong><a href="https://cran.r-project.org/web/packages/ggplot2/">ggplot2</a></strong>, that enables step by step construction of high quality graphics in a logical and elegant manner. First let us introduce and load an example dataset.</p>
</section>
<section id="sec-graphics-exampledata" class="level2 page-columns page-full" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="sec-graphics-exampledata"><span class="header-section-number">3.3</span> An example dataset</h2>
<div class="cell page-columns page-full" data-layout-align="center">

<div class="no-row-height column-margin column-container"><div class="cell-output-display">
<div id="fig-graphics-cells" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-graphics-cells-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="imgs/Yusukecells-2_web.jpg" class="lightbox" data-gallery="quarto-lightbox-gallery-7" title="Figure&nbsp;3.5: Single-section immunofluorescence image of the E3.5 mouse blastocyst stained for Serpinh1, a marker of primitive endoderm (blue), Gata6 (red) and Nanog (green)."><img src="imgs/Yusukecells-2_web.jpg" class="img-fluid quarto-figure quarto-figure-center figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-graphics-cells-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.5: Single-section immunofluorescence image of the E3.5 mouse blastocyst stained for Serpinh1, a marker of primitive endoderm (blue), Gata6 (red) and Nanog (green).
</figcaption>
</figure>
</div>
</div></div></div>
<p>To properly testdrive the <strong><a href="https://cran.r-project.org/web/packages/ggplot2/">ggplot2</a></strong> functionality, we are going to need a dataset that is big enough and has some complexity so that it can be sliced and viewed from many different angles. We’ll use a gene expression microarray dataset that reports the transcriptomes of around 100 individual cells from mouse embryos at different time points in early development. The mammalian embryo starts out as a single cell, the fertilized egg. Through synchronized waves of cell divisions, the egg multiplies into a clump of cells that at first show no discernible differences between them. At some point, though, cells choose different lineages. By further and further specification, the different cell types and tissues arise that are needed for a full organism. The aim of the experiment, explained by <span class="citation" data-cites="Ohnishi2014">Ohnishi et al. (<a href="16-chap.html#ref-Ohnishi2014" role="doc-biblioref">2014</a>)</span>, was to investigate the gene expression changes associated with the first symmetry breaking event in the embryo. We’ll further explain the data as we go. More details can be found in the paper and in the documentation of the Bioconductor data package <strong><a href="https://bioconductor.org/packages/Hiiragi2013/">Hiiragi2013</a></strong>. We first load the data:</p>
<div class="cell page-columns page-full" data-layout-align="center">

<div class="no-row-height column-margin column-container"><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="imgs/devil.png" class="lightbox" data-gallery="quarto-lightbox-gallery-8"><img src="imgs/devil.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="123"></a></p>
</figure>
</div>
</div></div></div>
<div class="page-columns page-full"><p></p><div class="no-row-height column-margin column-container"><span class="margin-aside">It is unfortunate that the data object has the rather generic name <code>x</code>, rather than a more descriptive name. To avoid name collisions, perhaps the most pragmatic solution would be to run code such as following: <code>esHiiragi = x; rm(list="x")</code>.</span></div></div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"Hiiragi2013"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="warning">
<pre class="knitr r">In chunk 'loadHiiragi': Warning: replacing previous import 'boot::logit' by 'gtools::logit' whenloading 'Hiiragi2013'</pre>
</div>
<div class="warning">
<pre class="knitr r">In chunk 'loadHiiragi': Warning: replacing previous import 'boot::inv.logit' by 'gtools::inv.logit'when loading 'Hiiragi2013'</pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"x"</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(Biobase<span class="sc">::</span><span class="fu">exprs</span>(x))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 45101   101</code></pre>
</div>
</div>
<p>You can print out a more detailed summary of the <em>ExpressionSet</em> object <code>x</code> by just typing <code>x</code> at the R prompt. The 101 columns of the data matrix (accessed above through the <code>exprs</code> function from the <strong><a href="https://bioconductor.org/packages/Biobase/">Biobase</a></strong> package) correspond to the samples (each of these is a single cell), the 45101 rows correspond to the genes probed by the array, an Affymetrix mouse4302 array. The data were normalized using the RMA method <span class="citation" data-cites="Irizarry:Biostat:2003">(<a href="16-chap.html#ref-Irizarry:Biostat:2003" role="doc-biblioref">Irizarry et al. 2003</a>)</span>. The raw data are also available in the package (in the data object <code>a</code>) and at EMBL-EBI’s ArrayExpress database under the accession code E-MTAB-1681.</p>
<p>Let’s have a look at what information is available about the samples<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>.</p>
<div class="no-row-height column-margin column-container"><div id="fn2"><p><sup>2</sup>&nbsp;The notation #CAB2D6 is a hexadecimal representation of the RGB coordinates of a color; more on this in <a href="#sec-graphics-colorspaces" class="quarto-xref"><span>Section 3.10.2</span></a>.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">pData</span>(x), <span class="at">n =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        File.name Embryonic.day Total.number.of.cells lineage genotype
1 E3.25  1_C32_IN         E3.25                    32               WT
2 E3.25  2_C32_IN         E3.25                    32               WT
          ScanDate sampleGroup sampleColour
1 E3.25 2011-03-16       E3.25      #CAB2D6
2 E3.25 2011-03-16       E3.25      #CAB2D6</code></pre>
</div>
</div>
<p>The information provided is a mix of information about the cells (i.e., age, size and genotype of the embryo from which they were obtained) and technical information (scan date, raw data file name). By convention, time in the development of the mouse embryo is measured in days, and reported as, for instance, <code>E3.5</code>. Moreover, in the paper the authors divided the cells into 8 biological groups (<code>sampleGroup</code>), based on age, genotype and lineage, and they defined a color scheme to represent these groups (<code>sampleColour</code><a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>). Using the following code (see below for explanations), we define a small dataframe <code>groups</code> that contains summary information for each group: the number of cells and the preferred color.</p>
<div class="no-row-height column-margin column-container"><div id="fn3"><p><sup>3</sup>&nbsp;This identifier in the dataset uses the British spelling. Everywhere else in this book, we use the US spelling (color). The <strong><a href="https://cran.r-project.org/web/packages/ggplot2/">ggplot2</a></strong> package generally accepts both spellings.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"dplyr"</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>groups <span class="ot">=</span> <span class="fu">group_by</span>(<span class="fu">pData</span>(x), sampleGroup) <span class="sc">|&gt;</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>(), <span class="at">color =</span> <span class="fu">unique</span>(sampleColour))</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>groups</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 3
  sampleGroup         n color  
  &lt;chr&gt;           &lt;int&gt; &lt;chr&gt;  
1 E3.25              36 #CAB2D6
2 E3.25 (FGF4-KO)    17 #FDBF6F
3 E3.5 (EPI)         11 #A6CEE3
4 E3.5 (FGF4-KO)      8 #FF7F00
5 E3.5 (PE)          11 #B2DF8A
6 E4.5 (EPI)          4 #1F78B4
7 E4.5 (FGF4-KO)     10 #E31A1C
8 E4.5 (PE)           4 #33A02C</code></pre>
</div>
</div>
<p>The cells in the groups whose name contains <code>FGF4-KO</code> are from embryos in which the FGF4 gene, an important regulator of cell differentiation, was knocked out. Starting from E3.5, the wildtype cells (without the FGF4 knock-out) undergo the first symmetry breaking event and differentiate into different cell lineages, called pluripotent epiblast (EPI) and primitive endoderm (PE).</p>
<p>Since the code chunk above is the first instance that we encounter the pipe operator <code>|&gt;</code> and the functions <code>group_by</code> and <code>summarise</code> from the <strong><a href="https://cran.r-project.org/web/packages/dplyr/">dplyr</a></strong> package, let’s unpack the code. First, the pipe <code>|&gt;</code><a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a>. Generally, the pipe is useful for making nested function calls easier to read for humans. The following two lines of code are equivalent to R.</p>
<div class="no-row-height column-margin column-container"><div id="fn4"><p><sup>4</sup>&nbsp;<code>|&gt;</code> is the pipe operator that has been coming with base R since version 4.1, released in 2021. The package <strong><a href="https://cran.r-project.org/web/packages/magrittr/">magrittr</a></strong> has provided the <code>%&gt;%</code> operator, which has similar although not identical semantics, already since a long time before, as well as several other piping related operators, such as <code>%&lt;&gt;%</code> and <code>%T&gt;%</code>. As much of the book was written before 2021, <strong><a href="https://cran.r-project.org/web/packages/magrittr/">magrittr</a></strong>’s <code>%&gt;%</code> operator is used in many places. We are occasionally updating from <code>%&gt;%</code> to <code>|&gt;</code> during book maintenance, as in the code shown here.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">f</span>(x) <span class="sc">|&gt;</span> <span class="fu">g</span>(y) <span class="sc">|&gt;</span> <span class="fu">h</span>()</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">h</span>(<span class="fu">g</span>(<span class="fu">f</span>(x), y))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>It says: “Evaluate <code>f(x)</code>, then pass the result to function <code>g</code> as the first argument, while <code>y</code> is passed to <code>g</code> as the second argument. Then pass the output of <code>g</code> to the function <code>h</code>.” You could repeat this ad infinitum. Especially if the arguments <code>x</code> and <code>y</code> are complex expressions themselves, or if there is quite a chain of functions involved, the first version tends to be easier to read.</p>
<p>The <code>group_by</code> function simply “marks” the dataframe with a note that all subsequent operations should not be applied to the whole dataframe at once, but to blocks defined by the <code>sampleGroup</code> factor. Finally, <code>summarise</code> computes summary statistics; this could be, e.g., the <code>mean</code>, <code>sum</code>; in this case, we just compute the number of rows in each block, <code>n()</code>, and the prevalent color.</p>
</section>
<section id="sec-graphics-ggplot" class="level2 page-columns page-full" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="sec-graphics-ggplot"><span class="header-section-number">3.4</span> ggplot2</h2>
<p><strong><a href="https://cran.r-project.org/web/packages/ggplot2/">ggplot2</a></strong> is a package by Hadley Wickham <span class="citation" data-cites="ggplot2">(<a href="16-chap.html#ref-ggplot2" role="doc-biblioref">Wickham 2016</a>)</span> that implements the idea of <strong>grammar of graphics</strong> – a concept created by Leland Wilkinson in his eponymous book <span class="citation" data-cites="GrofGrbook">(<a href="16-chap.html#ref-GrofGrbook" role="doc-biblioref">Wilkinson 2005</a>)</span>. We will explore some of its functionality in this chapter, and you will see many examples of how it can be used in the rest of this book. Comprehensive documentation for the package can be found <a href="https://ggplot2.tidyverse.org">on its website</a>. The online documentation includes example use cases for each of the graphic types that are introduced in this chapter (and many more) and is an invaluable resource when creating figures.</p>
<p>Let’s start by loading the package and redoing the simple plot of <a href="#fig-graphics-basicplotting1" class="quarto-xref">Figure&nbsp;<span>3.2</span></a>.</p>
<div class="cell page-columns page-full" data-layout-align="center">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"ggplot2"</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(DNase, <span class="fu">aes</span>(<span class="at">x =</span> conc, <span class="at">y =</span> density)) <span class="sc">+</span> <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

<div class="no-row-height column-margin column-container"><div class="cell-output-display">
<div id="fig-graphics-figredobasicplottingwithggplot" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-graphics-figredobasicplottingwithggplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="03-chap_files/figure-html/fig-graphics-figredobasicplottingwithggplot-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-9" title="Figure&nbsp;3.6: Our first ggplot2 figure, similar to the base graphics Figure&nbsp;fig-graphics-basicplotting1."><img src="03-chap_files/figure-html/fig-graphics-figredobasicplottingwithggplot-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="280"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-graphics-figredobasicplottingwithggplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.6: Our first <strong><a href="https://cran.r-project.org/web/packages/ggplot2/">ggplot2</a></strong> figure, similar to the base graphics <a href="#fig-graphics-basicplotting1" class="quarto-xref">Figure&nbsp;<span>3.2</span></a>.
</figcaption>
</figure>
</div>
</div></div></div>
<p>We just wrote our first “sentence” using the grammar of graphics. Let’s deconstruct this sentence. First, we specified the dataframe that contains the data, <code>DNase</code>. The <code>aes</code> (this stands for <strong>aesthetic</strong>) argument states which variables we want to see mapped to the <span class="math inline">\(x\)</span>- and <span class="math inline">\(y\)</span>-axes, respectively. Finally, we stated that we want the plot to use points (as opposed to, say, lines or bars), by adding the result of calling the function <code>geom_point</code>.</p>
<p>Now let’s turn to the mouse single cell data and plot the number of samples for each of the 8 groups using the <code>ggplot</code> function. The result is shown in <a href="#fig-graphics-qplot1" class="quarto-xref">Figure&nbsp;<span>3.7</span></a>.</p>
<div class="cell page-columns page-full" data-layout-align="center">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(groups, <span class="fu">aes</span>(<span class="at">x =</span> sampleGroup, <span class="at">y =</span> n)) <span class="sc">+</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

<div class="no-row-height column-margin column-container"><div class="cell-output-display">
<div id="fig-graphics-qplot1" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-graphics-qplot1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="03-chap_files/figure-html/fig-graphics-qplot1-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-10" title="Figure&nbsp;3.7: A barplot, produced with the ggplot function from the table of group sizes in the mouse single cell data."><img src="03-chap_files/figure-html/fig-graphics-qplot1-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="400"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-graphics-qplot1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.7: A barplot, produced with the <code>ggplot</code> function from the table of group sizes in the mouse single cell data.
</figcaption>
</figure>
</div>
</div></div></div>
<p>With <code>geom_bar</code> we now told <code>ggplot</code> that we want each data item (each row of <code>groups</code>) to be represented by a bar. Bars are one example of geometric object (<strong>geom</strong> in the <strong><a href="https://cran.r-project.org/web/packages/ggplot2/">ggplot2</a></strong> package’s parlance) that <code>ggplot</code> knows about. We have already seen another such object in <a href="#fig-graphics-figredobasicplottingwithggplot" class="quarto-xref">Figure&nbsp;<span>3.6</span></a>: points, indicated by the <code>geom_point</code> function. We will encounter many other geoms later. We used the <code>aes</code> to indicate that we want the groups shown along the <span class="math inline">\(x\)</span>-axis and the sizes along the <span class="math inline">\(y\)</span>-axis. Finally, we provided the argument <code>stat = "identity"</code> (in other words, do nothing) to the <code>geom_bar</code> function, since otherwise it would try to compute a histogram of the data (the default value of <code>stat</code> is <code>"count"</code>). <code>stat</code> is short for <em>statistic</em>, which is what we call any function of data. Besides the identity and count statistic, there are others, such as smoothing, averaging, binning, or other operations that reduce the data in some way.</p>
<p>These concepts –data, geometrical objects, statistics– are some of the ingredients of the grammar of graphics, just as nouns, verbs and adverbs are ingredients of an English sentence.</p>
<div class="callout callout-style-default callout-tip no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Task
</div>
</div>
<div class="callout-body-container callout-body">
<p>Flip the <span class="math inline">\(x\)</span>- and <span class="math inline">\(y\)</span>-aesthetics to produce a horizontal barplot.</p>
</div>
</div>
<p>The plot in <a href="#fig-graphics-qplot1" class="quarto-xref">Figure&nbsp;<span>3.7</span></a> is not bad, but there are several potential improvements. We can use color for the bars to help us quickly see which bar corresponds to which group. This is particularly useful if we use the same color scheme in several plots. To this end, let’s define a named vector <code>groupColor</code> that contains our desired colors for each possible value of <code>sampleGroup</code>.<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a></p>
<div class="no-row-height column-margin column-container"><div id="fn5"><p><sup>5</sup>&nbsp;The information is completely equivalent to that in the <code>sampleGroup</code> and <code>color</code> columns of the dataframe <code>groups</code>; we are just adapting to the fact that <strong><a href="https://cran.r-project.org/web/packages/ggplot2/">ggplot2</a></strong> expects this information in the form of a named vector.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>groupColor <span class="ot">=</span> <span class="fu">setNames</span>(groups<span class="sc">$</span>color, groups<span class="sc">$</span>sampleGroup)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Another thing that we need to fix in <a href="#fig-graphics-qplot1" class="quarto-xref">Figure&nbsp;<span>3.7</span></a> is the readability of the bar labels. Right now they are running into each other — a common problem when you have descriptive names.</p>
<div class="cell page-columns page-full" data-layout-align="center">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(groups, <span class="fu">aes</span>(<span class="at">x =</span> sampleGroup, <span class="at">y =</span> n, <span class="at">fill =</span> sampleGroup)) <span class="sc">+</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> groupColor, <span class="at">name =</span> <span class="st">"Groups"</span>) <span class="sc">+</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

<div class="no-row-height column-margin column-container"><div class="cell-output-display">
<div id="fig-graphics-qplot2" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-graphics-qplot2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="03-chap_files/figure-html/fig-graphics-qplot2-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-11" title="Figure&nbsp;3.8: Similar to Figure&nbsp;fig-graphics-qplot1, but with colored bars and better bar labels."><img src="03-chap_files/figure-html/fig-graphics-qplot2-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="400"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-graphics-qplot2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.8: Similar to <a href="#fig-graphics-qplot1" class="quarto-xref">Figure&nbsp;<span>3.7</span></a>, but with colored bars and better bar labels.
</figcaption>
</figure>
</div>
</div></div></div>
<p>This is now already a longer and more complex sentence. Let’s dissect it. We added an argument, <code>fill</code> to the <code>aes</code> function that states that we want the bars to be colored (filled) based on <code>sampleGroup</code> (which in this case co-incidentally is also the value of the <code>x</code> argument, but that need not always be so). Furthermore we added a call to the <code>scale_fill_manual</code> function, which takes as its input a color map – i.e., the mapping from the possible values of a variable to the associated colors – as a named vector. We also gave this color map a title (note that in more complex plots, there can be several different color maps involved). Had we omitted the call to <code>scale_fill_manual</code>, <strong><a href="https://cran.r-project.org/web/packages/ggplot2/">ggplot2</a></strong> would have used its choice of default colors. We also added a call to <code>theme</code> stating that we want the <span class="math inline">\(x\)</span>-axis labels rotated by 90 degrees and right-aligned (<code>hjust</code>; the default would be to center).</p>
<section id="data-flow" class="level3 page-columns page-full" data-number="3.4.1">
<h3 data-number="3.4.1" class="anchored" data-anchor-id="data-flow"><span class="header-section-number">3.4.1</span> Data flow</h3>
<div class="cell page-columns page-full" data-layout-align="center">

<div class="no-row-height column-margin column-container"><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="imgs/devil.png" class="lightbox" data-gallery="quarto-lightbox-gallery-12"><img src="imgs/devil.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="123"></a></p>
</figure>
</div>
</div></div></div>
<div class="page-columns page-full"><p> The function <code>ggplot</code> expects your data in a dataframe. If they are in a matrix, in separate vectors, or other types of objects, you will have to convert them. The packages <strong><a href="https://cran.r-project.org/web/packages/dplyr/">dplyr</a></strong> and <strong><a href="https://cran.r-project.org/web/packages/broom/">broom</a></strong>, among others, offer facilities to this end. We will discuss this more in <a href="13-chap.html#sec-design-datarep" class="quarto-xref"><span>Section 13.10</span></a>, and you will see examples of such conversions throughout the book.</p><div class="no-row-height column-margin column-container"><span class="margin-aside">This includes the base R <em>data.frame</em> as well as the <em>tibble</em> (and synonymous <em>data_frame</em>) classes from the <strong><a href="https://cran.r-project.org/web/packages/tibble/">tibble</a></strong> package in the tidyverse.</span></div></div>
<p>The result of a call to the <code>ggplot</code> is a <em>ggplot</em> object. Let’s recall a piece of code from above:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>gg <span class="ot">=</span> <span class="fu">ggplot</span>(DNase, <span class="fu">aes</span>(<span class="at">x =</span> conc, <span class="at">y =</span> density)) <span class="sc">+</span> <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We have now assigned the output of <code>ggplot</code> to the object <code>gg</code>, instead of sending it directly to the console, where it was “printed” and produced <a href="#fig-graphics-figredobasicplottingwithggplot" class="quarto-xref">Figure&nbsp;<span>3.6</span></a>. The situation is completely analogous to what you’re used to from working with the R console: when you enter an expression such as <code>1+1</code> and hit “Enter”, the result is printed. When the expression is an assignment, such as <code>s = 1+1</code>, the side effect takes place (the name <code>"s"</code> is bound to an object in memory that represents the value of <code>1+1</code>), but nothing is printed. Similarly, when an expression is evaluated as part of a script called with <code>source</code>, it is not printed. Thus, the above code also does not create any graphic output, since no <code>print</code> method is invoked. To print <code>gg</code>, type its name (in an interactive session) or call <code>print</code> on it:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>gg</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(gg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="saving-figures" class="level3" data-number="3.4.2">
<h3 data-number="3.4.2" class="anchored" data-anchor-id="saving-figures"><span class="header-section-number">3.4.2</span> Saving figures</h3>
<p><strong><a href="https://cran.r-project.org/web/packages/ggplot2/">ggplot2</a></strong> has a built-in plot saving function called <code>ggsave</code>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggsave</span>(<span class="st">"DNAse-histogram-demo.pdf"</span>, <span class="at">plot =</span> gg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There are two major ways of storing plots: vector graphics and raster (pixel) graphics. In vector graphics, the plot is stored as a series of geometrical primitives such as points, lines, curves, shapes and typographic characters. The preferred format in R for saving plots into a vector graphics format is PDF. In raster graphics, the plot is stored in a dot matrix data structure. The main limitation of raster formats is their limited resolution, which depends on the number of pixels available. In R, the most commonly used device for raster graphics output is <code>png</code>. Generally, it’s preferable to save your plots in a vector graphics format, since it is always possible later to convert a vector graphics file into a raster format of any desired resolution, while the reverse is quite difficult. And you don’t want the figures in your talks or papers look poor because of pixelization artefacts!</p>
</section>
</section>
<section id="the-grammar-of-graphics" class="level2 page-columns page-full" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="the-grammar-of-graphics"><span class="header-section-number">3.5</span> The grammar of graphics</h2>
<p>The components of <strong><a href="https://cran.r-project.org/web/packages/ggplot2/">ggplot2</a></strong>’s grammar of graphics are</p>
<ol type="1">
<li><p>one or more datasets,</p></li>
<li><p>one or more geometric objects that serve as the visual representations of the data, – for instance, points, lines, rectangles, contours,</p></li>
<li><p>descriptions of how the variables in the data are mapped to visual properties (aesthetics) of the geometric objects, and an associated scale (e. g., linear, logarithmic, rank),</p></li>
<li><p>one or more coordinate systems,</p></li>
<li><p>statistical summarization rules,</p></li>
<li><p>a facet specification, i.e.&nbsp;the use of multiple similar subplots to look at subsets of the same data,</p></li>
<li><p>optional parameters that affect the layout and rendering, such text size, font and alignment, legend positions.</p></li>
</ol>
<p>In the examples above, Figures <a href="#fig-graphics-qplot1" class="quarto-xref"><span>3.7</span></a> and <a href="#fig-graphics-qplot2" class="quarto-xref"><span>3.8</span></a>, the dataset was <code>groupsize</code>, the variables were the numeric values as well as the names of <code>groupsize</code>, which we mapped to the aesthetics <span class="math inline">\(y\)</span>-axis and <span class="math inline">\(x\)</span>-axis respectively, the scale was linear on the <span class="math inline">\(y\)</span> and rank-based on the <span class="math inline">\(x\)</span>-axis (the bars are ordered alphanumerically and each has the same width), and the geometric object was the rectangular bar.</p>
<p>Items 4–7 in the above list are optional. If you don’t specify them, then the Cartesian is used as the coordinate system, the statistical summary is the trivial one (i.e., the identity), and no facets or subplots are made (we’ll see examples later on, in <a href="#sec-graphics-facets" class="quarto-xref"><span>Section 3.8</span></a>). The first three items are required: a valid <strong><a href="https://cran.r-project.org/web/packages/ggplot2/">ggplot2</a></strong> “sentence” needs to contain at least one of each of them.</p>
<p>In fact, <strong><a href="https://cran.r-project.org/web/packages/ggplot2/">ggplot2</a></strong>’s implementation of the grammar of graphics allows you to use the same type of component multiple times, in what are called <strong>layers</strong> <span class="citation" data-cites="Wickham:LayeredGrammar">(<a href="16-chap.html#ref-Wickham:LayeredGrammar" role="doc-biblioref">Wickham 2010</a>)</span>. For example, the code below uses three types of geometric objects in the same plot, for the same data: points, a line and a confidence band.</p>
<div class="cell page-columns page-full" data-layout-align="center">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>dftx <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="fu">t</span>(Biobase<span class="sc">::</span><span class="fu">exprs</span>(x)), <span class="fu">pData</span>(x))</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>( dftx, <span class="fu">aes</span>( <span class="at">x =</span> X1426642_at, <span class="at">y =</span> X1418765_at )) <span class="sc">+</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>( <span class="at">shape =</span> <span class="dv">1</span> ) <span class="sc">+</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>( <span class="at">method =</span> <span class="st">"loess"</span> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

<div class="no-row-height column-margin column-container"><div class="cell-output-display">
<div id="fig-graphics-scp2layers1" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-graphics-scp2layers1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="03-chap_files/figure-html/fig-graphics-scp2layers1-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-13" title="Figure&nbsp;3.9: A scatterplot with three layers that show different statistics of the same data: points (geom_point), a smooth regression line and a confidence band (the latter two from geom_smooth)."><img src="03-chap_files/figure-html/fig-graphics-scp2layers1-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="280"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-graphics-scp2layers1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.9: A scatterplot with three layers that show different statistics of the same data: points (<code>geom_point</code>), a smooth regression line and a confidence band (the latter two from <code>geom_smooth</code>).
</figcaption>
</figure>
</div>
</div></div></div>
<p>Here we had to assemble a copy of the expression data (<code>Biobase::exprs(x)</code>) and the sample annotation data (<code>pData(x)</code>) all together into the dataframe <code>dftx</code> – since this is the data format that <strong><a href="https://cran.r-project.org/web/packages/ggplot2/">ggplot2</a></strong> functions most easily take as input (more on this in <a href="13-chap.html#sec-design-datarep" class="quarto-xref"><span>Section 13.10</span></a>).</p>
<p>We can further enhance the plot by using colors – since each of the points in <a href="#fig-graphics-scp2layers1" class="quarto-xref">Figure&nbsp;<span>3.9</span></a> corresponds to one sample, it makes sense to use the <code>sampleColour</code> information in the object <code>x</code>.</p>
<div class="cell page-columns page-full" data-layout-align="center">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dftx, <span class="fu">aes</span>(<span class="at">x =</span> X1426642_at, <span class="at">y =</span> X1418765_at))  <span class="sc">+</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> sampleGroup), <span class="at">shape =</span> <span class="dv">19</span>) <span class="sc">+</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> groupColor, <span class="at">guide =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"loess"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

<div class="no-row-height column-margin column-container"><div class="cell-output-display">
<div id="fig-graphics-scp2layers2" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-graphics-scp2layers2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="03-chap_files/figure-html/fig-graphics-scp2layers2-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-14" title="Figure&nbsp;3.10: As Figure&nbsp;fig-graphics-scp2layers1, but in addition with points colored by the time point and cell lineage (as defined in Figure&nbsp;fig-graphics-qplot2). We can now see that the expression values of the gene Timd2 (targeted by the probe 1418765_at, along the y-axis) are consistently high in the early time points, whereas its expression goes down in the EPI samples at days 3.5 and 4.5. In the FGF4-KO, this decrease is delayed - at E3.5, its expression is still high. Conversely, the gene Fn1 (1426642_at, x-axis) is off in the early timepoints and then goes up at days 3.5 and 4.5. The PE samples (green) show a high degree of cell-to-cell variability."><img src="03-chap_files/figure-html/fig-graphics-scp2layers2-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="280"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-graphics-scp2layers2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.10: As <a href="#fig-graphics-scp2layers1" class="quarto-xref">Figure&nbsp;<span>3.9</span></a>, but in addition with points colored by the time point and cell lineage (as defined in <a href="#fig-graphics-qplot2" class="quarto-xref">Figure&nbsp;<span>3.8</span></a>). We can now see that the expression values of the gene Timd2 (targeted by the probe 1418765_at, along the y-axis) are consistently high in the early time points, whereas its expression goes down in the EPI samples at days 3.5 and 4.5. In the FGF4-KO, this decrease is delayed - at E3.5, its expression is still high. Conversely, the gene Fn1 (1426642_at, x-axis) is off in the early timepoints and then goes up at days 3.5 and 4.5. The PE samples (green) show a high degree of cell-to-cell variability.
</figcaption>
</figure>
</div>
</div></div></div>
<div id="wrn-graphics-layers" class="callout callout-style-default callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Question&nbsp;3.2
</div>
</div>
<div class="callout-body-container callout-body">
<p>In the code above we defined the <code>color</code> aesthetics (<code>aes</code>) only for the <code>geom_point</code> layer, while we defined the <code>x</code> and <code>y</code> aesthetics for all layers. What happens if we set the <code>color</code> aesthetics for all layers, i.e., move it into the argument list of <code>ggplot</code>?</p>
</div>
</div>
<div id="wrn-graphics-scpsmoothline" class="callout callout-style-default callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Question&nbsp;3.3
</div>
</div>
<div class="callout-body-container callout-body">
<p>Is it always meaningful to visualize scatterplot data together with a regression line as in Figures <a href="#fig-graphics-scp2layers1" class="quarto-xref"><span>3.9</span></a> and <a href="#fig-graphics-scp2layers2" class="quarto-xref"><span>3.10</span></a>?</p>
</div>
</div>
<p>As an aside, if we want to find out which genes are targeted by these probe identifiers, and what they might do, we can call:</p>
<div class="cell page-columns page-full" data-layout-align="center">

<div class="no-row-height column-margin column-container"><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="imgs/devil.png" class="lightbox" data-gallery="quarto-lightbox-gallery-15"><img src="imgs/devil.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="123"></a></p>
</figure>
</div>
</div></div></div>
<div class="page-columns page-full"><p></p><div class="no-row-height column-margin column-container"><span class="margin-aside">Note that here were need to use the original feature identifiers (e.,g., “1426642_at”, without the leading “X”). This is the notation used by the microarray manufacturer, by the Bioconductor annotation packages, and also inside the object <code>x</code>. The leading “X” that we used above when working with <code>dftx</code> was inserted during the creation of <code>dftx</code> by the constructor function <code>data.frame</code>, since its argument <code>check.names</code> is set to <code>TRUE</code> by default. Alternatively, we could have kept the original identifier notation by setting <code>check.names = FALSE</code>, but then our code (e.g., the calls to <code>aes()</code>) would need to use backticks around the identifiers to make sure R interprets them correctly.</span></div></div>
<div class="page-columns page-full"><p></p><div class="no-row-height column-margin column-container"><span class="margin-aside">Note the use of the <code>::</code> operator to call the <code>select</code> function by its fully qualified name, including the package. We already encountered this in <a href="02-chap.html" class="quarto-xref"><span>Chapter 2</span></a>.</span></div></div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"mouse4302.db"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>AnnotationDbi<span class="sc">::</span><span class="fu">select</span>(mouse4302.db,</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>   <span class="at">keys =</span> <span class="fu">c</span>(<span class="st">"1426642_at"</span>, <span class="st">"1418765_at"</span>), <span class="at">keytype =</span> <span class="st">"PROBEID"</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>   <span class="at">columns =</span> <span class="fu">c</span>(<span class="st">"SYMBOL"</span>, <span class="st">"GENENAME"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     PROBEID SYMBOL                                            GENENAME
1 1426642_at    Fn1                                       fibronectin 1
2 1418765_at  Timd2 T cell immunoglobulin and mucin domain containing 2</code></pre>
</div>
</div>
<p>Often when using <code>ggplot</code> you will only need to specify the data, aesthetics and a geometric object. Most geometric objects implicitly call a suitable default statistical summary of the data. For example, if you are using <code>geom_smooth</code>, then <strong><a href="https://cran.r-project.org/web/packages/ggplot2/">ggplot2</a></strong> uses <code>stat = "smooth"</code> by default and displays a line; if you use <code>geom_histogram</code>, the data are binned and the result is displayed in barplot format. Here’s an example:</p>
<div class="cell page-columns page-full" data-layout-align="center">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>dfx <span class="ot">=</span> <span class="fu">as.data.frame</span>(Biobase<span class="sc">::</span><span class="fu">exprs</span>(x))</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dfx, <span class="fu">aes</span>(<span class="at">x =</span> <span class="st">`</span><span class="at">20 E3.25</span><span class="st">`</span>)) <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="fl">0.2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

<div class="no-row-height column-margin column-container"><div class="cell-output-display">
<div id="fig-graphics-hists" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-graphics-hists-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="03-chap_files/figure-html/fig-graphics-hists-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-16" title="Figure&nbsp;3.11: Histogram of probe intensities for one particular sample, cell number 20, which was from day E3.25."><img src="03-chap_files/figure-html/fig-graphics-hists-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="280"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-graphics-hists-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.11: Histogram of probe intensities for one particular sample, cell number 20, which was from day E3.25.
</figcaption>
</figure>
</div>
</div></div></div>
<div id="wrn-graphics-dftxvsdftx2" class="callout callout-style-default callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Question&nbsp;3.4
</div>
</div>
<div class="callout-body-container callout-body">
<p>What is the difference between the objects <code>dfx</code> and <code>dftx</code>? Why did we need to create them both?</p>
</div>
</div>
<p>Let’s come back to the barplot example from above.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>pb <span class="ot">=</span> <span class="fu">ggplot</span>(groups, <span class="fu">aes</span>(<span class="at">x =</span> sampleGroup, <span class="at">y =</span> n))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This creates a plot object <code>pb</code>. If we try to display it, it creates an empty plot, because we haven’t specified what geometric object we want to use. All that we have in our <code>pb</code> object so far are the data and the aesthetics (<a href="#fig-graphics-figbpempty" class="quarto-xref">Figure&nbsp;<span>3.12</span></a>).</p>
<div class="cell page-columns page-full" data-layout-align="center">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(pb)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "gg"     "ggplot"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>pb</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

<div class="no-row-height column-margin column-container"><div class="cell-output-display">
<div id="fig-graphics-figbpempty" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-graphics-figbpempty-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="03-chap_files/figure-html/fig-graphics-figbpempty-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-17" title="Figure&nbsp;3.12: pb: without a geometric object (a geom), the plot area remains empty. With the default style parameters, the tick labels on the x-axis are not legible."><img src="03-chap_files/figure-html/fig-graphics-figbpempty-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="256"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-graphics-figbpempty-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.12: <code>pb</code>: without a geometric object (a <code>geom</code>), the plot area remains empty. With the default style parameters, the tick labels on the <span class="math inline">\(x\)</span>-axis are not legible.
</figcaption>
</figure>
</div>
</div></div></div>
<p>Now we can simply add on the other components of our plot through using the <code>+</code> operator (<a href="#fig-graphics-bpgg3" class="quarto-xref">Figure&nbsp;<span>3.13</span></a>):</p>
<div class="cell page-columns page-full" data-layout-align="center">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>pb <span class="ot">=</span> pb <span class="sc">+</span> <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>pb <span class="ot">=</span> pb <span class="sc">+</span> <span class="fu">aes</span>(<span class="at">fill =</span> sampleGroup)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>pb <span class="ot">=</span> pb <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>pb <span class="ot">=</span> pb <span class="sc">+</span> <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> groupColor, <span class="at">name =</span> <span class="st">"Groups"</span>)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>pb</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

<div class="no-row-height column-margin column-container"><div class="cell-output-display">
<div id="fig-graphics-bpgg3" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-graphics-bpgg3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="03-chap_files/figure-html/fig-graphics-bpgg3-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-18" title="Figure&nbsp;3.13: The graphics object bp in its full glory."><img src="03-chap_files/figure-html/fig-graphics-bpgg3-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="400"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-graphics-bpgg3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.13: The graphics object <code>bp</code> in its full glory.
</figcaption>
</figure>
</div>
</div></div></div>
<p>This step-wise buildup –taking a graphics object already produced in some way and then further refining it– can be more convenient and easy to manage than, say, providing all the instructions upfront to the single function call that creates the graphic.</p>
<p>We can quickly try out different visualization ideas without having to rebuild our plots each time from scratch, but rather store the partially finished object and then modify it in different ways. For example we can switch our plot to polar coordinates to create an alternative visualization of the barplot.</p>
<div class="cell page-columns page-full" data-layout-align="center">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>pb.polar <span class="ot">=</span> pb <span class="sc">+</span> <span class="fu">coord_polar</span>() <span class="sc">+</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">""</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">""</span>)</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>pb.polar</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

<div class="no-row-height column-margin column-container"><div class="cell-output-display">
<div id="fig-graphics-bpgg7" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-graphics-bpgg7-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="03-chap_files/figure-html/fig-graphics-bpgg7-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-19" title="Figure&nbsp;3.14: A barplot in a polar coordinate system."><img src="03-chap_files/figure-html/fig-graphics-bpgg7-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="400"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-graphics-bpgg7-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.14: A barplot in a polar coordinate system.
</figcaption>
</figure>
</div>
</div></div></div>
<p>Note above that we can override previously set <code>theme</code> parameters by simply setting them to a new value – no need to go back to recreating <code>pb</code>, where we originally set them.</p>
</section>
<section id="sec-graphics-univar" class="level2 page-columns page-full" data-number="3.6">
<h2 data-number="3.6" class="anchored" data-anchor-id="sec-graphics-univar"><span class="header-section-number">3.6</span> Visualizing data in 1D</h2>
<p>A common task in biological data analysis is the comparison between several samples of univariate measurements. In this section we’ll explore some possibilities for visualizing and comparing such samples. As an example, we’ll use the intensities of a set of four genes: Fgf4, Gata4, Gata6 and Sox2<a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a>. On the microarray, they are represented by</p>
<div class="no-row-height column-margin column-container"><div id="fn6"><p><sup>6</sup>&nbsp;You can read more about these genes in <span class="citation" data-cites="Ohnishi2014">(<a href="16-chap.html#ref-Ohnishi2014" role="doc-biblioref">Ohnishi et al. 2014</a>)</span>.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>selectedProbes <span class="ot">=</span> <span class="fu">c</span>( <span class="at">Fgf4 =</span> <span class="st">"1420085_at"</span>, <span class="at">Gata4 =</span> <span class="st">"1418863_at"</span>,</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">Gata6 =</span> <span class="st">"1425463_at"</span>,  <span class="at">Sox2 =</span> <span class="st">"1416967_at"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To extract data from this representation and convert them into a dataframe, we use the function <code>melt</code> from the <strong><a href="https://cran.r-project.org/web/packages/reshape2/">reshape2</a></strong> package<a href="#fn7" class="footnote-ref" id="fnref7" role="doc-noteref"><sup>7</sup></a>.</p>
<div class="no-row-height column-margin column-container"><div id="fn7"><p><sup>7</sup>&nbsp;We’ll talk more about the concepts and mechanics of different data representations in <a href="13-chap.html#sec-design-datarep" class="quarto-xref"><span>Section 13.10</span></a>.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"reshape2"</span>)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>genes <span class="ot">=</span> <span class="fu">melt</span>(Biobase<span class="sc">::</span><span class="fu">exprs</span>(x)[selectedProbes, ],</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">varnames =</span> <span class="fu">c</span>(<span class="st">"probe"</span>, <span class="st">"sample"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For good measure, we also add a column that provides the gene symbol along with the probe identifiers.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>genes<span class="sc">$</span>gene <span class="ot">=</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(selectedProbes)[<span class="fu">match</span>(genes<span class="sc">$</span>probe, selectedProbes)]</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(genes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       probe  sample    value  gene
1 1420085_at 1 E3.25 3.027715  Fgf4
2 1418863_at 1 E3.25 4.843137 Gata4
3 1425463_at 1 E3.25 5.500618 Gata6
4 1416967_at 1 E3.25 1.731217  Sox2
5 1420085_at 2 E3.25 9.293016  Fgf4
6 1418863_at 2 E3.25 5.530016 Gata4</code></pre>
</div>
</div>
<section id="sec-graphics-univar-bar" class="level3 page-columns page-full" data-number="3.6.1">
<h3 data-number="3.6.1" class="anchored" data-anchor-id="sec-graphics-univar-bar"><span class="header-section-number">3.6.1</span> Barplots</h3>
<p>A popular way to display data such as in our dataframe <code>genes</code> is through barplots (<a href="#fig-graphics-onedbp1" class="quarto-xref">Figure&nbsp;<span>3.15</span></a>).</p>
<div class="cell page-columns page-full" data-layout-align="center">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(genes, <span class="fu">aes</span>(<span class="at">x =</span> gene, <span class="at">y =</span> value)) <span class="sc">+</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun =</span> mean, <span class="at">geom =</span> <span class="st">"bar"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

<div class="no-row-height column-margin column-container"><div class="cell-output-display">
<div id="fig-graphics-onedbp1" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-graphics-onedbp1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="03-chap_files/figure-html/fig-graphics-onedbp1-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-20" title="Figure&nbsp;3.15: Barplots showing the means of the distributions of expression measurements from four probes."><img src="03-chap_files/figure-html/fig-graphics-onedbp1-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="240"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-graphics-onedbp1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.15: Barplots showing the means of the distributions of expression measurements from four probes.
</figcaption>
</figure>
</div>
</div></div></div>
<p>In <a href="#fig-graphics-onedbp1" class="quarto-xref">Figure&nbsp;<span>3.15</span></a>, each bar represents the mean of the values for that gene. Such plots are commonly used in the biological sciences, as well as in the popular media. However, summarizing the data into only a single number, the mean, loses much of the information, and given the amount of space they take, barplot are a poor way to visualize data<a href="#fn8" class="footnote-ref" id="fnref8" role="doc-noteref"><sup>8</sup></a>.</p>
<div class="no-row-height column-margin column-container"><div id="fn8"><p><sup>8</sup>&nbsp;In fact, if the mean is not an appropriate summary, such as for highly skewed or multimodal distributions, or for datasets with large outliers, this kind of visualization can be outright misleading.</p></div></div><p>Sometimes we want to add error bars, and one way to achieve this in <strong><a href="https://cran.r-project.org/web/packages/ggplot2/">ggplot2</a></strong> is as follows.</p>
<div class="cell page-columns page-full" data-layout-align="center">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"Hmisc"</span>)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(genes, <span class="fu">aes</span>( <span class="at">x =</span> gene, <span class="at">y =</span> value, <span class="at">fill =</span> gene)) <span class="sc">+</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun =</span> mean, <span class="at">geom =</span> <span class="st">"bar"</span>) <span class="sc">+</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun.data =</span> mean_cl_normal, <span class="at">geom =</span> <span class="st">"errorbar"</span>,</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">width =</span> <span class="fl">0.25</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

<div class="no-row-height column-margin column-container"><div class="cell-output-display">
<div id="fig-graphics-onedbp2" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-graphics-onedbp2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="03-chap_files/figure-html/fig-graphics-onedbp2-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-21" title="Figure&nbsp;3.16: Barplots with error bars indicating standard error of the mean."><img src="03-chap_files/figure-html/fig-graphics-onedbp2-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="300"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-graphics-onedbp2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.16: Barplots with error bars indicating standard error of the mean.
</figcaption>
</figure>
</div>
</div></div></div>
<p>Here, we see again the principle of layered graphics: we use two summary functions, <code>mean</code> and <code>mean_cl_normal</code>, and two associated geometric objects, <code>bar</code> and <code>errorbar</code>. The function <code>mean_cl_normal</code> is from the <strong><a href="https://cran.r-project.org/web/packages/Hmisc/">Hmisc</a></strong> package and computes the standard error (or <strong>c</strong>onfidence <strong>l</strong>imits) of the mean; it’s a simple function, and we could also compute it ourselves using base R expressions if we wished to do so. We have also colored the bars to make the plot more visually pleasing.</p>
</section>
<section id="boxplots" class="level3 page-columns page-full" data-number="3.6.2">
<h3 data-number="3.6.2" class="anchored" data-anchor-id="boxplots"><span class="header-section-number">3.6.2</span> Boxplots</h3>
<p>Boxplots take up a similar amount of space as barplots, but are much more informative.</p>
<div class="cell page-columns page-full" data-layout-align="center">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">=</span> <span class="fu">ggplot</span>(genes, <span class="fu">aes</span>( <span class="at">x =</span> gene, <span class="at">y =</span> value, <span class="at">fill =</span> gene))</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">geom_boxplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

<div class="no-row-height column-margin column-container"><div class="cell-output-display">
<div id="fig-graphics-onedboxpl" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-graphics-onedboxpl-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="03-chap_files/figure-html/fig-graphics-onedboxpl-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-22" title="Figure&nbsp;3.17: Boxplots."><img src="03-chap_files/figure-html/fig-graphics-onedboxpl-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="300"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-graphics-onedboxpl-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.17: Boxplots.
</figcaption>
</figure>
</div>
</div></div></div>
<p>In <a href="#fig-graphics-onedboxpl" class="quarto-xref">Figure&nbsp;<span>3.17</span></a> we see that two of the genes (Gata4, Gata6) have relatively concentrated distributions, with only a few data points venturing out in the direction of higher values. For Fgf4, we see that the distribution is right-skewed: the median, indicated by the horizontal black bar within the box is closer to the lower (or left) side of the box. Conversely, for Sox2 the distribution is left-skewed.</p>
</section>
<section id="dot-plots-and-beeswarm-plots" class="level3 page-columns page-full" data-number="3.6.3">
<h3 data-number="3.6.3" class="anchored" data-anchor-id="dot-plots-and-beeswarm-plots"><span class="header-section-number">3.6.3</span> Dot plots and beeswarm plots</h3>
<p>If the number of data points is not too large, it is possible to show the data points directly, and it is good practice to do so, compared to the summaries we saw above. However, plotting the data directly will often lead to overlapping points, which can be visually unpleasant, or even obscure the data. We can try to lay out the points so that they are as near possible to their proper locations without overlap <span class="citation" data-cites="Wilkinson:DotPlots:1999">(<a href="16-chap.html#ref-Wilkinson:DotPlots:1999" role="doc-biblioref">Wilkinson 1999</a>)</span>.</p>
<div class="cell page-columns page-full" data-layout-nrow="1" data-layout-align="center" data-fig-cap-location="margin">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">geom_dotplot</span>(<span class="at">binaxis =</span> <span class="st">"y"</span>, <span class="at">binwidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">6</span>,</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">stackdir =</span> <span class="st">"center"</span>, <span class="at">stackratio =</span> <span class="fl">0.75</span>,</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">color =</span> gene))</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"ggbeeswarm"</span>)</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">geom_beeswarm</span>(<span class="fu">aes</span>(<span class="at">color =</span> gene))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-graphics-oneddot" class="quarto-layout-panel page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-graphics-oneddot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-graphics-oneddot" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-graphics-oneddot-1" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center" width="400">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-graphics-oneddot-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="03-chap_files/figure-html/fig-graphics-oneddot-1.png" class="lightbox" data-gallery="fig-graphics-oneddot" title="Figure&nbsp;3.18&nbsp;(a): "><img src="03-chap_files/figure-html/fig-graphics-oneddot-1.png" id="fig-graphics-oneddot-1" class="img-fluid quarto-figure quarto-figure-center anchored figure-img" data-ref-parent="fig-graphics-oneddot" width="400"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-graphics-oneddot-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a)
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-graphics-oneddot" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-graphics-oneddot-2" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center" width="400">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-graphics-oneddot-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="03-chap_files/figure-html/fig-graphics-oneddot-2.png" class="lightbox" data-gallery="fig-graphics-oneddot" title="Figure&nbsp;3.18&nbsp;(b): "><img src="03-chap_files/figure-html/fig-graphics-oneddot-2.png" id="fig-graphics-oneddot-2" class="img-fluid quarto-figure quarto-figure-center anchored figure-img" data-ref-parent="fig-graphics-oneddot" width="400"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-graphics-oneddot-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b)
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-graphics-oneddot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.18: (a) Dot plots, made using <code>geom_dotplot</code> from <strong><a href="https://cran.r-project.org/web/packages/ggplot2/">ggplot2</a></strong>. (b) Beeswarm plots, made using <code>geom_beeswarm</code> from <strong><a href="https://cran.r-project.org/web/packages/ggbeeswarm/">ggbeeswarm</a></strong>.
</figcaption>
</figure>
</div>
</div>
<p>The plot in panel (a) of <a href="#fig-graphics-oneddot" class="quarto-xref">Figure&nbsp;<span>3.18</span></a>. The <span class="math inline">\(y\)</span>-coordinates of the points are discretized into bins (above we chose a bin size of 1/6), and then they are stacked next to each other.</p>
<p>An alternative is provided by the package <strong><a href="https://cran.r-project.org/web/packages/ggbeeswarm/">ggbeeswarm</a></strong>, which provides <code>geom_beeswarm</code>. The plot is shown in panel (b) of <a href="#fig-graphics-oneddot" class="quarto-xref">Figure&nbsp;<span>3.18</span></a>. The layout algorithm aims to avoid overlaps between the points. If a point were to overlap an existing point, it is shifted along the <span class="math inline">\(x\)</span>-axis by a small amount sufficient to avoid overlap. Some tweaking of the layout parameters is usually needed for each new dataset to make a dot plot or a beeswarm plot look good.</p>
</section>
<section id="sec-graphics-univar:dens" class="level3 page-columns page-full" data-number="3.6.4">
<h3 data-number="3.6.4" class="anchored" data-anchor-id="sec-graphics-univar:dens"><span class="header-section-number">3.6.4</span> Density plots</h3>
<p>Yet another way to represent the same data is by density plots. Here, we try to estimate the underlying data-generating density by smoothing out the data points (<a href="#fig-graphics-oneddens" class="quarto-xref">Figure&nbsp;<span>3.19</span></a>).</p>
<div class="cell page-columns page-full" data-layout-align="center">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(genes, <span class="fu">aes</span>( <span class="at">x =</span> value, <span class="at">color =</span> gene)) <span class="sc">+</span> <span class="fu">geom_density</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

<div class="no-row-height column-margin column-container"><div class="cell-output-display">
<div id="fig-graphics-oneddens" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-graphics-oneddens-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="03-chap_files/figure-html/fig-graphics-oneddens-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-25" title="Figure&nbsp;3.19: Density plots."><img src="03-chap_files/figure-html/fig-graphics-oneddens-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="300"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-graphics-oneddens-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.19: Density plots.
</figcaption>
</figure>
</div>
</div></div></div>
<p>As you can see from Figures <a href="#fig-graphics-onedboxpl" class="quarto-xref"><span>3.17</span></a>—<a href="#fig-graphics-oneddens" class="quarto-xref"><span>3.19</span></a>, boxplots work fairly well for unimodal data, but they can be misleading if the data distribution is multimodal, and they also do not always give a fair impression of long-tailed distributions. By showing the data points, or their densities, directly, Figures <a href="#fig-graphics-oneddot" class="quarto-xref"><span>3.18</span></a>—<a href="#fig-graphics-oneddens" class="quarto-xref"><span>3.19</span></a>) give a better impression of such features. For instance, we can see that the data for Fgf4 and Sox2 are bimodal, while Gata4 and Gata6 have most of their values concentrated around a baseline, but a certain fraction of cells have elevated expression levels, across a wide range of values.</p>
<p>Density estimation has, however, a number of complications, in particular, the need for choosing a smoothing window. A window size that is small enough to capture peaks in the dense regions of the data may lead to instable (“wiggly”) estimates elsewhere. On the other hand, if the window is made bigger, pronounced features of the density, such as sharp peaks, may be smoothed out. Moreover, the density lines do not convey the information on how much data was used to estimate them, and plots like <a href="#fig-graphics-oneddens" class="quarto-xref">Figure&nbsp;<span>3.19</span></a> can be especially problematic if the sample sizes for the curves differ.</p>
</section>
<section id="violin-plots" class="level3 page-columns page-full" data-number="3.6.5">
<h3 data-number="3.6.5" class="anchored" data-anchor-id="violin-plots"><span class="header-section-number">3.6.5</span> Violin plots</h3>
<p>Density plots such as <a href="#fig-graphics-oneddens" class="quarto-xref">Figure&nbsp;<span>3.19</span></a> can look crowded if there are several densities, and one idea is to arrange the densities in a layout inspired by boxplots: the violin plot (<a href="#fig-graphics-onedviolin" class="quarto-xref">Figure&nbsp;<span>3.20</span></a>). Here, the density estimate is used to draw a symmetric shape, which sometimes visually reminds of a violin.</p>
<div class="cell page-columns page-full" data-layout-align="center">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">geom_violin</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

<div class="no-row-height column-margin column-container"><div class="cell-output-display">
<div id="fig-graphics-onedviolin" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-graphics-onedviolin-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="03-chap_files/figure-html/fig-graphics-onedviolin-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-26" title="Figure&nbsp;3.20: Violin plots."><img src="03-chap_files/figure-html/fig-graphics-onedviolin-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="280"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-graphics-onedviolin-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.20: Violin plots.
</figcaption>
</figure>
</div>
</div></div></div>
</section>
<section id="sec-graphics-univar:ridge" class="level3 page-columns page-full" data-number="3.6.6">
<h3 data-number="3.6.6" class="anchored" data-anchor-id="sec-graphics-univar:ridge"><span class="header-section-number">3.6.6</span> Ridgeline plots</h3>
<p>Another play on density plots are ridgeline plots (<a href="#fig-graphics-onedridge4" class="quarto-xref">Figure&nbsp;<span>3.21</span></a>):</p>
<div class="cell page-columns page-full" data-layout-align="center">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"ggridges"</span>)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(genes, <span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> gene, <span class="at">fill =</span> gene)) <span class="sc">+</span> </span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density_ridges</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

<div class="no-row-height column-margin column-container"><div class="cell-output-display">
<div id="fig-graphics-onedridge4" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-graphics-onedridge4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="03-chap_files/figure-html/fig-graphics-onedridge4-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-27" title="Figure&nbsp;3.21: Ridgeline plots."><img src="03-chap_files/figure-html/fig-graphics-onedridge4-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="280"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-graphics-onedridge4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.21: Ridgeline plots.
</figcaption>
</figure>
</div>
</div></div></div>
<p>This type of display is perhaps most appropriate if the number of densities shown goes into the dozens.</p>
<div class="cell" data-layout-align="center" data-warning.known="rows containing non-finite values">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>top42 <span class="ot">=</span> <span class="fu">order</span>(<span class="fu">rowMeans</span>(Biobase<span class="sc">::</span><span class="fu">exprs</span>(x)), <span class="at">decreasing =</span> <span class="cn">TRUE</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">42</span>]</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>g42 <span class="ot">=</span> <span class="fu">melt</span>(Biobase<span class="sc">::</span><span class="fu">exprs</span>(x)[<span class="fu">rev</span>(top42), ], <span class="at">varnames =</span> <span class="fu">c</span>(<span class="st">"probe"</span>, <span class="st">"sample"</span>))</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(g42, <span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> probe)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell page-columns page-full" data-layout-align="center" data-warning.known="rows containing non-finite outside">

<div class="no-row-height column-margin column-container"><div class="cell-output-display">
<div id="fig-graphics-onedridge42" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-graphics-onedridge42-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="03-chap_files/figure-html/fig-graphics-onedridge42-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-28" title="Figure&nbsp;3.22: Like Figure&nbsp;fig-graphics-onedridge4, with more genes."><img src="03-chap_files/figure-html/fig-graphics-onedridge42-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="280"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-graphics-onedridge42-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.22: Like <a href="#fig-graphics-onedridge4" class="quarto-xref">Figure&nbsp;<span>3.21</span></a>, with more genes.
</figcaption>
</figure>
</div>
</div></div></div>
</section>
<section id="sec-graphics-ecdf" class="level3 page-columns page-full" data-number="3.6.7">
<h3 data-number="3.6.7" class="anchored" data-anchor-id="sec-graphics-ecdf"><span class="header-section-number">3.6.7</span> ECDF plots</h3>
<p>The mathematically most convenient way to describe the distribution of a one-dimensional random variable <span class="math inline">\(X\)</span> is its <strong>cumulative distribution function</strong> (<strong>CDF</strong>), i.e., the function defined by</p>
<p><span class="anchored-eq" data-anchor-id="eq-graphics" id="eq-graphics-def-cdf"><span class="math display">\[
F(x) = P(X\le x),
\tag{3.1}\]</span></span></p>
<p>where <span class="anchored-eq" data-anchor-id="eq-graphics" class="math inline">\(x\)</span> takes all values along the real axis. The density of <span class="math inline">\(X\)</span> is then the derivative of <span class="math inline">\(F\)</span>, if it exists<a href="#fn9" class="footnote-ref" id="fnref9" role="doc-noteref"><sup>9</sup></a>. The finite sample version of the probability <a href="#eq-graphics-def-cdf" class="quarto-xref"><span>3.1</span></a> is called the <strong>empirical cumulative distribution function</strong> (<strong>ECDF</strong>),</p>
<div class="no-row-height column-margin column-container"><div id="fn9"><p><sup>9</sup>&nbsp;By its definition, <span class="anchored-eq" data-anchor-id="eq-xvbrnqszojec" class="math inline">\(F\)</span> tends to 0 for small <span class="math inline">\(x\)</span> (<span class="math inline">\(x\to-\infty\)</span>) and to 1 for large <span class="math inline">\(x\)</span> (<span class="math inline">\(x\to+\infty\)</span>).</p></div></div><p><span id="eq-xvbrnqszojec"><span class="math display">\[
F_{n}(x) = \frac{\text{number of $i$ for which } x_i \le x}{n} = \frac{1}{n}\sum_{i=1}^n 𝟙({x\le x_i}),
\tag{3.2}\]</span></span></p>
<p>where <span class="math inline">\(x_1,...,x_n\)</span> denote a sample of <span class="math inline">\(n\)</span> draws from <span class="math inline">\(X\)</span> and <span class="math inline">\(𝟙\)</span> is the indicator function, i.e., the function that takes the value 1 if the expression in its argument is true and 0 otherwise. If this sounds abstract, we can get a perhaps more intuitive understanding from the following example (<a href="#fig-graphics-ecdfexample" class="quarto-xref">Figure&nbsp;<span>3.23</span></a>):</p>
<div class="cell page-columns page-full" data-layout-align="center">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>simdata <span class="ot">=</span> <span class="fu">rnorm</span>(<span class="dv">70</span>)</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">index =</span> <span class="fu">seq</span>(<span class="at">along =</span> simdata),</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">sx =</span> <span class="fu">sort</span>(simdata)) <span class="sc">%&gt;%</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> sx, <span class="at">y =</span> index)) <span class="sc">+</span> <span class="fu">geom_step</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

<div class="no-row-height column-margin column-container"><div class="cell-output-display">
<div id="fig-graphics-ecdfexample" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-graphics-ecdfexample-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="03-chap_files/figure-html/fig-graphics-ecdfexample-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-29" title="Figure&nbsp;3.23: Sorted values of simdata versus their index. This is the empirical cumulative distribution function of simdata."><img src="03-chap_files/figure-html/fig-graphics-ecdfexample-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:75.0%"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-graphics-ecdfexample-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.23: Sorted values of <code>simdata</code> versus their index. This is the empirical cumulative distribution function of <code>simdata</code>.
</figcaption>
</figure>
</div>
</div></div></div>
<p>Plotting the sorted values against their ranks gives the essential features of the ECDF (<a href="#fig-graphics-ecdfexample" class="quarto-xref">Figure&nbsp;<span>3.23</span></a>). In practice, we do not need to do the sorting and the other steps in the above code manually and will rather use the <code>stat_ecdf()</code> geometric object. The ECDFs of our data are shown in <a href="#fig-graphics-onedecdf" class="quarto-xref">Figure&nbsp;<span>3.24</span></a>.</p>
<div class="cell page-columns page-full" data-layout-align="center">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(genes, <span class="fu">aes</span>( <span class="at">x =</span> value, <span class="at">color =</span> gene)) <span class="sc">+</span> <span class="fu">stat_ecdf</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

<div class="no-row-height column-margin column-container"><div class="cell-output-display">
<div id="fig-graphics-onedecdf" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-graphics-onedecdf-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="03-chap_files/figure-html/fig-graphics-onedecdf-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-30" title="Figure&nbsp;3.24: Empirical cumulative distribution functions (ECDF)."><img src="03-chap_files/figure-html/fig-graphics-onedecdf-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="280"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-graphics-onedecdf-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.24: Empirical cumulative distribution functions (ECDF).
</figcaption>
</figure>
</div>
</div></div></div>
<p>The ECDF has several nice properties:</p>
<ul>
<li><p>It is lossless: the ECDF <span class="math inline">\(F_{n}(x)\)</span> contains all the information contained in the original sample <span class="math inline">\(x_1,...,x_n\)</span>, except for the order of the values, which is assumed to be unimportant.</p></li>
<li><p>As <span class="math inline">\(n\)</span> grows, the ECDF <span class="math inline">\(F_{n}(x)\)</span> converges to the true CDF <span class="math inline">\(F(x)\)</span>. Even for limited sample sizes <span class="math inline">\(n\)</span>, the difference between the two functions tends to be small. Note that this is not the case for the empirical density! Without smoothing, the empirical density of a finite sample is a sum of Dirac delta functions, which is difficult to visualize and quite different from any underlying smooth, true density. With smoothing, the difference can be less pronounced, but is difficult to control, as we discussed above.</p></li>
</ul>
<div class="cell page-columns page-full" data-layout-align="center">
<div class="cell-output-display page-columns page-full">
<div id="fig-graphics-Lawrence-TCGA-Nature-2013-Fig1" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full" data-fig-align="center" data-cap-location="margin">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-graphics-Lawrence-TCGA-Nature-2013-Fig1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="imgs/Lawrence-TCGA-Nature-2013-Fig1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-31" title="Figure&nbsp;3.25: Part of Figure 1 from @Lawrence:Nature:2013. Each dot corresponds to a tumour-normal pair, with vertical position indicating the total frequency of somatic mutations in the exome. The resulting curves are, in essence, ECDF plots, and conceptually this plot is similar to Figure&nbsp;fig-graphics-onedecdf, just that the graphs are rotated by 90 degrees (i.e., the roles of x- and y-axis are exchanged) and the curves for the individual tumor types are horizontally displaced to keep them better apart."><img src="imgs/Lawrence-TCGA-Nature-2013-Fig1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:75.0%"></a>
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-graphics-Lawrence-TCGA-Nature-2013-Fig1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.25: Part of Figure 1 from <span class="citation" data-cites="Lawrence:Nature:2013">Lawrence et al. (<a href="16-chap.html#ref-Lawrence:Nature:2013" role="doc-biblioref">2013</a>)</span>. Each dot corresponds to a tumour-normal pair, with vertical position indicating the total frequency of somatic mutations in the exome. The resulting curves are, in essence, ECDF plots, and conceptually this plot is similar to <a href="#fig-graphics-onedecdf" class="quarto-xref">Figure&nbsp;<span>3.24</span></a>, just that the graphs are rotated by 90 degrees (i.e., the roles of <span class="math inline">\(x\)</span>- and <span class="math inline">\(y\)</span>-axis are exchanged) and the curves for the individual tumor types are horizontally displaced to keep them better apart.
</figcaption>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Task
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>tibbles.</strong> In the above code we saw the <code>tibble</code> for the first time. Have a look at the vignette of the <strong><a href="https://cran.r-project.org/web/packages/tibble/">tibble</a></strong> package for what it does.</p>
</div>
</div>
</section>
<section id="the-effect-of-transformations-on-densities" class="level3 page-columns page-full" data-number="3.6.8">
<h3 data-number="3.6.8" class="anchored" data-anchor-id="the-effect-of-transformations-on-densities"><span class="header-section-number">3.6.8</span> The effect of transformations on densities</h3>
<p>It is tempting to look at histograms or density plots and inspect them for evidence of <strong>bimodality</strong> (or multimodality) as an indication of some underlying biological phenomenon. Before doing so, it is important to remember that the number of modes of a density depends on scale transformations of the data, via the <strong>chain rule</strong>. For instance, let’s look at the data from one of the arrays in the Hiiragi dataset (<a href="#fig-graphics-onedtrsf" class="quarto-xref">Figure&nbsp;<span>3.26</span></a>):</p>
<div class="cell page-columns page-full" data-layout-nrow="1" data-layout-align="center" data-warning.known="[&quot;rows containing non-finite outside&quot;,&quot;rows containing missing values&quot;]" data-fig-cap-location="margin">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dfx, <span class="fu">aes</span>(<span class="at">x =</span> <span class="st">`</span><span class="at">64 E4.5 (EPI)</span><span class="st">`</span>)) <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">100</span>)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dfx, <span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">2</span> <span class="sc">^</span> <span class="st">`</span><span class="at">64 E4.5 (EPI)</span><span class="st">`</span>)) <span class="sc">+</span> </span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">20</span>) <span class="sc">+</span> <span class="fu">xlim</span>(<span class="dv">0</span>, <span class="dv">1500</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-graphics-onedtrsf" class="quarto-layout-panel page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-graphics-onedtrsf-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-graphics-onedtrsf" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-graphics-onedtrsf-1" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center" width="280">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-graphics-onedtrsf-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="03-chap_files/figure-html/fig-graphics-onedtrsf-1.png" class="lightbox" data-gallery="fig-graphics-onedtrsf" title="Figure&nbsp;3.26&nbsp;(a): "><img src="03-chap_files/figure-html/fig-graphics-onedtrsf-1.png" id="fig-graphics-onedtrsf-1" class="img-fluid quarto-figure quarto-figure-center anchored figure-img" data-ref-parent="fig-graphics-onedtrsf" width="280"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-graphics-onedtrsf-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a)
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-graphics-onedtrsf" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-graphics-onedtrsf-2" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center" width="280">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-graphics-onedtrsf-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="03-chap_files/figure-html/fig-graphics-onedtrsf-2.png" class="lightbox" data-gallery="fig-graphics-onedtrsf" title="Figure&nbsp;3.26&nbsp;(b): "><img src="03-chap_files/figure-html/fig-graphics-onedtrsf-2.png" id="fig-graphics-onedtrsf-2" class="img-fluid quarto-figure quarto-figure-center anchored figure-img" data-ref-parent="fig-graphics-onedtrsf" width="280"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-graphics-onedtrsf-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b)
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-graphics-onedtrsf-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.26: Histograms of the same data, with and without logarithm transform. (a) The data are shown on the scale on which they are stored in the data object <code>x</code>, which resulted from logarithm (base 2) transformation of the microarray fluorescence intensities <span class="citation" data-cites="Irizarry:Biostat:2003">(<a href="16-chap.html#ref-Irizarry:Biostat:2003" role="doc-biblioref">Irizarry et al. 2003</a>)</span>; (b) after re-exponentiating them back to the fluorescence scale. For better use of space, we capped the <span class="math inline">\(x\)</span>-axis range at 1500.
</figcaption>
</figure>
</div>
</div>
<div id="wrn-graphics-trsfsmodes" class="callout callout-style-default callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Question&nbsp;3.5
</div>
</div>
<div class="callout-body-container callout-body">
<p>(Advanced:) Consider a random variable <span class="math inline">\(X\)</span> and a non-linear 1:1 transformation <span class="math inline">\(f: x \mapsto y\)</span> that defines the transformed random variable <span class="math inline">\(Y = f(X)\)</span>. Suppose the density function of <span class="math inline">\(Y\)</span> is <span class="math inline">\(p(y)\)</span>. What is the density of <span class="math inline">\(X\)</span>? How is the mode (or: the modes) of <span class="math inline">\(X\)</span> related to the mode(s) of <span class="math inline">\(Y\)</span>?<br>
Hint: note that a mode of a function <span class="math inline">\(p\)</span> is a root of its derivative <span class="math inline">\(p'=dp/dx\)</span>. Is it generally true that if <span class="math inline">\(x_0\)</span> is a mode of <span class="math inline">\(X\)</span>, then <span class="math inline">\(y_0=f(x_0)\)</span> is a mode of <span class="math inline">\(Y\)</span>?</p>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-9-contents" aria-controls="callout-9" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-9" class="callout-9-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>According to the chain rule, <span class="math inline">\(p(y)\, dy = p(f(x))\,f'(x)\,dx\)</span>, so the density of <span class="math inline">\(X\)</span> is <span class="math inline">\(\tilde{p}(x) = p(f(x))\,f'(x)\)</span>. The modes of <span class="math inline">\(\tilde{p}\)</span> are roots of its derivative <span class="math inline">\(d\tilde{p}/dx\)</span>, i.e., they obey <span class="math inline">\(p'(f(x))\,f'^2(x) + p(f(x))f"(x) = 0\)</span>. The second term in the sum vanishes if <span class="math inline">\(f\)</span> is affine linear (<span class="math inline">\(f"\equiv0\)</span>), but in general there is no simple relationship between the roots of the two densities, and therefore between the modes of <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>.</p>
</div>
</div>
</div>
</section>
</section>
<section id="sec-graphics-2d" class="level2 page-columns page-full" data-number="3.7">
<h2 data-number="3.7" class="anchored" data-anchor-id="sec-graphics-2d"><span class="header-section-number">3.7</span> Visualizing data in 2D: scatterplots</h2>
<p>Scatterplots are useful for visualizing treatment–response comparisons (as in <a href="#fig-graphics-basicplotting2" class="quarto-xref">Figure&nbsp;<span>3.3</span></a>), associations between variables (as in <a href="#fig-graphics-scp2layers2" class="quarto-xref">Figure&nbsp;<span>3.10</span></a>), or paired data (e.g., a disease biomarker in several patients before and after treatment). We use the two dimensions of our plotting paper, or screen, to represent the two variables. Let’s take a look at differential expression between a wildtype and an FGF4-KO sample.</p>
<div class="cell page-columns page-full" data-layout-align="center">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>scp <span class="ot">=</span> <span class="fu">ggplot</span>(dfx, <span class="fu">aes</span>(<span class="at">x =</span> <span class="st">`</span><span class="at">59 E4.5 (PE)</span><span class="st">`</span> ,</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">y =</span> <span class="st">`</span><span class="at">92 E4.5 (FGF4-KO)</span><span class="st">`</span>))</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>scp <span class="sc">+</span> <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

<div class="no-row-height column-margin column-container"><div class="cell-output-display">
<div id="fig-graphics-twodsp1" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-graphics-twodsp1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="03-chap_files/figure-html/fig-graphics-twodsp1-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-34" title="Figure&nbsp;3.27: Scatterplot of 45101 expression measurements for two of the samples."><img src="03-chap_files/figure-html/fig-graphics-twodsp1-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="300"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-graphics-twodsp1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.27: Scatterplot of 45101 expression measurements for two of the samples.
</figcaption>
</figure>
</div>
</div></div></div>
<p>The labels 59 E4.5 (PE) and 92 E4.5 (FGF4-KO) refer to column names (sample names) in the dataframe <code>dfx</code>, which we created above. Since they contain special characters (spaces, parentheses, hyphen) and start with numerals, we need to enclose them with the downward sloping quotes to make them syntactically digestible for R. The plot is shown in <a href="#fig-graphics-twodsp1" class="quarto-xref">Figure&nbsp;<span>3.27</span></a>. We get a dense point cloud that we can try and interpret on the outskirts of the cloud, but we really have no idea visually how the data are distributed within the denser regions of the plot.</p>
<p>One easy way to ameliorate the overplotting is to adjust the transparency (alpha value) of the points by modifying the <code>alpha</code> parameter of <code>geom_point</code> (<a href="#fig-graphics-twodsp2" class="quarto-xref">Figure&nbsp;<span>3.28</span></a>).</p>
<div class="cell page-columns page-full" data-layout-align="center">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>scp  <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

<div class="no-row-height column-margin column-container"><div class="cell-output-display">
<div id="fig-graphics-twodsp2" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-graphics-twodsp2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="03-chap_files/figure-html/fig-graphics-twodsp2-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-35" title="Figure&nbsp;3.28: As Figure&nbsp;fig-graphics-twodsp1, but with semi-transparent points to resolve some of the overplotting."><img src="03-chap_files/figure-html/fig-graphics-twodsp2-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="300"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-graphics-twodsp2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.28: As <a href="#fig-graphics-twodsp1" class="quarto-xref">Figure&nbsp;<span>3.27</span></a>, but with semi-transparent points to resolve some of the overplotting.
</figcaption>
</figure>
</div>
</div></div></div>
<p>This is already better than <a href="#fig-graphics-twodsp1" class="quarto-xref">Figure&nbsp;<span>3.27</span></a>, but in the more dense regions even the semi-transparent points quickly overplot to a featureless black mass, while the more isolated, outlying points are getting faint. An alternative is a contour plot of the 2D density, which has the added benefit of not rendering all of the points on the plot, as in <a href="#fig-graphics-twodsp3" class="quarto-xref">Figure&nbsp;<span>3.29</span></a>.</p>
<p>However, we see in <a href="#fig-graphics-twodsp3" class="quarto-xref">Figure&nbsp;<span>3.29</span></a> that the point cloud at the bottom right (which contains a relatively small number of points) is no longer represented. We can somewhat overcome this by tweaking the bandwidth and binning parameters of <code>geom_density2d</code> (<a href="#fig-graphics-twodsp4" class="quarto-xref">Figure&nbsp;<span>3.30</span></a>, left panel).</p>
<div class="cell page-columns page-full" data-layout-align="center">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>scp <span class="sc">+</span> <span class="fu">geom_density2d</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

<div class="no-row-height column-margin column-container"><div class="cell-output-display">
<div id="fig-graphics-twodsp3" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-graphics-twodsp3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="03-chap_files/figure-html/fig-graphics-twodsp3-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-36" title="Figure&nbsp;3.29: As Figure&nbsp;fig-graphics-twodsp1, but rendered as a contour plot of the 2D density estimate."><img src="03-chap_files/figure-html/fig-graphics-twodsp3-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="300"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-graphics-twodsp3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.29: As <a href="#fig-graphics-twodsp1" class="quarto-xref">Figure&nbsp;<span>3.27</span></a>, but rendered as a contour plot of the 2D density estimate.
</figcaption>
</figure>
</div>
</div></div></div>
<div class="cell" data-layout-nrow="1" data-layout-align="center">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>scp <span class="sc">+</span> <span class="fu">geom_density2d</span>(<span class="at">h =</span> <span class="fl">0.5</span>, <span class="at">bins =</span> <span class="dv">60</span>)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"RColorBrewer"</span>)</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>colorscale <span class="ot">=</span> <span class="fu">scale_fill_gradientn</span>(</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">colors =</span> <span class="fu">rev</span>(<span class="fu">brewer.pal</span>(<span class="dv">9</span>, <span class="st">"YlGnBu"</span>)),</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">exp</span>(<span class="fu">seq</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">0</span>, <span class="at">length.out =</span> <span class="dv">100</span>))))</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>scp <span class="sc">+</span> <span class="fu">stat_density2d</span>(<span class="at">h =</span> <span class="fl">0.5</span>, <span class="at">bins =</span> <span class="dv">60</span>,</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>          <span class="fu">aes</span>( <span class="at">fill =</span> <span class="fu">after_stat</span>(level)), <span class="at">geom =</span> <span class="st">"polygon"</span>) <span class="sc">+</span></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>  colorscale <span class="sc">+</span> <span class="fu">coord_fixed</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-graphics-twodsp4" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-graphics-twodsp4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-graphics-twodsp4" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-graphics-twodsp4-1" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center" width="280">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-graphics-twodsp4-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="03-chap_files/figure-html/fig-graphics-twodsp4-1.png" class="lightbox" data-gallery="fig-graphics-twodsp4" title="Figure&nbsp;3.30&nbsp;(a): "><img src="03-chap_files/figure-html/fig-graphics-twodsp4-1.png" id="fig-graphics-twodsp4-1" class="img-fluid quarto-figure quarto-figure-center anchored figure-img" data-ref-parent="fig-graphics-twodsp4" width="280"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-graphics-twodsp4-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a)
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-graphics-twodsp4" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-graphics-twodsp4-2" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center" width="280">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-graphics-twodsp4-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="03-chap_files/figure-html/fig-graphics-twodsp4-2.png" class="lightbox" data-gallery="fig-graphics-twodsp4" title="Figure&nbsp;3.30&nbsp;(b): "><img src="03-chap_files/figure-html/fig-graphics-twodsp4-2.png" id="fig-graphics-twodsp4-2" class="img-fluid quarto-figure quarto-figure-center anchored figure-img" data-ref-parent="fig-graphics-twodsp4" width="280"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-graphics-twodsp4-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b)
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-graphics-twodsp4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.30: 2D density plots. (a) As <a href="#fig-graphics-twodsp3" class="quarto-xref">Figure&nbsp;<span>3.29</span></a>, but with smaller smoothing bandwidth and tighter binning for the contour lines. (b) With color filling.
</figcaption>
</figure>
</div>
</div>
<p>We can fill in each space between the contour lines with the relative density of points by explicitly calling the function <code>stat_density2d</code> (for which <code>geom_density2d</code> is a wrapper) and using the geometric object <em>polygon</em>, as in the right panel of <a href="#fig-graphics-twodsp4" class="quarto-xref">Figure&nbsp;<span>3.30</span></a>.</p>
<p>We used the function <code>brewer.pal</code> from the package <strong><a href="https://cran.r-project.org/web/packages/RColorBrewer/">RColorBrewer</a></strong> to define the color scale, and we added a call to <code>coord_fixed</code> to fix the aspect ratio of the plot, to make sure that the mapping of data range to <span class="math inline">\(x\)</span>- and <span class="math inline">\(y\)</span>-coordinates is the same for the two variables. Both of these issues merit a deeper look, and we’ll talk more about plot shapes in <a href="#sec-graphics-banking" class="quarto-xref"><span>Section 3.7.1</span></a> and about colors in <a href="#sec-graphics-color" class="quarto-xref"><span>Section 3.9</span></a>.</p>
<p>The density based plotting methods in <a href="#fig-graphics-twodsp4" class="quarto-xref">Figure&nbsp;<span>3.30</span></a> are more visually appealing and interpretable than the overplotted point clouds of Figures <a href="#fig-graphics-twodsp1" class="quarto-xref"><span>3.27</span></a> and <a href="#fig-graphics-twodsp2" class="quarto-xref"><span>3.28</span></a>, though we have to be careful in using them as we lose much of the information on the outlier points in the sparser regions of the plot. One possibility is using <code>geom_point</code> to add such points back in.</p>
<p>But arguably the best alternative, which avoids the limitations of smoothing, is hexagonal binning <span class="citation" data-cites="Carr1987hexbin">(<a href="16-chap.html#ref-Carr1987hexbin" role="doc-biblioref">Carr et al. 1987</a>)</span>.</p>
<div class="cell page-columns page-full" data-layout-nrow="1" data-layout-align="center" data-fig-cap-location="margin">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>scp <span class="sc">+</span> <span class="fu">geom_hex</span>() <span class="sc">+</span> <span class="fu">coord_fixed</span>()</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>scp <span class="sc">+</span> <span class="fu">geom_hex</span>(<span class="at">binwidth =</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.2</span>)) <span class="sc">+</span> colorscale <span class="sc">+</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-graphics-twodsp6" class="quarto-layout-panel page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-graphics-twodsp6-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-graphics-twodsp6" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-graphics-twodsp6-1" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center" width="280">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-graphics-twodsp6-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="03-chap_files/figure-html/fig-graphics-twodsp6-1.png" class="lightbox" data-gallery="fig-graphics-twodsp6" title="Figure&nbsp;3.31&nbsp;(a): "><img src="03-chap_files/figure-html/fig-graphics-twodsp6-1.png" id="fig-graphics-twodsp6-1" class="img-fluid quarto-figure quarto-figure-center anchored figure-img" data-ref-parent="fig-graphics-twodsp6" width="280"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-graphics-twodsp6-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a)
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-graphics-twodsp6" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-graphics-twodsp6-2" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center" width="280">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-graphics-twodsp6-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="03-chap_files/figure-html/fig-graphics-twodsp6-2.png" class="lightbox" data-gallery="fig-graphics-twodsp6" title="Figure&nbsp;3.31&nbsp;(b): "><img src="03-chap_files/figure-html/fig-graphics-twodsp6-2.png" id="fig-graphics-twodsp6-2" class="img-fluid quarto-figure quarto-figure-center anchored figure-img" data-ref-parent="fig-graphics-twodsp6" width="280"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-graphics-twodsp6-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b)
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-graphics-twodsp6-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.31: Hexagonal binning. (a) Default parameters. (b) Finer bin sizes and customized color scale.
</figcaption>
</figure>
</div>
</div>
<section id="sec-graphics-banking" class="level3 page-columns page-full" data-number="3.7.1">
<h3 data-number="3.7.1" class="anchored" data-anchor-id="sec-graphics-banking"><span class="header-section-number">3.7.1</span> Plot shapes</h3>
<p>Choosing the proper shape for your plot is important to make sure the information is conveyed well. By default, the shape parameter, that is, the ratio between the height of the graph and its width, is chosen by <strong><a href="https://cran.r-project.org/web/packages/ggplot2/">ggplot2</a></strong> based on the available space in the current plotting device. The width and height of the device are specified when it is opened in R, either explicitly by you or through default parameters<a href="#fn10" class="footnote-ref" id="fnref10" role="doc-noteref"><sup>10</sup></a>. Moreover, the graph dimensions also depend on the presence or absence of additional decorations, like the color scale bars in <a href="#fig-graphics-twodsp6" class="quarto-xref">Figure&nbsp;<span>3.31</span></a>.</p>
<div class="no-row-height column-margin column-container"><div id="fn10"><p><sup>10</sup>&nbsp;See for example the manual pages of the <code>pdf</code> and <code>png</code> functions.</p></div></div><p>There are two simple rules that you can apply for scatterplots:</p>
<ul>
<li><p>If the variables on the two axes are measured in the same units, then make sure that the same mapping of data space to physical space is used – i.e., use <code>coord_fixed</code>. In the scatterplots above, both axes are the logarithm to base 2 of expression level measurements; that is, a change by one unit has the same meaning on both axes (a doubling of the expression level). Another case is principal component analysis (PCA), where the <span class="math inline">\(x\)</span>-axis typically represents component 1, and the <span class="math inline">\(y\)</span>-axis component 2. Since the axes arise from an orthonormal rotation of input data space, we want to make sure their scales match. Since the variance of the data is (by definition) smaller along the second component than along the first component (or at most, equal), well-made PCA plots usually have a width that’s larger than the height.</p></li>
<li><p>If the variables on the two axes are measured in different units, then we can still relate them to each other by comparing their dimensions. The default in many plotting routines in R, including <strong><a href="https://cran.r-project.org/web/packages/ggplot2/">ggplot2</a></strong>, is to look at the range of the data and map it to the available plotting region. However, in particular when the data more or less follow a line, looking at the typical slope of the line can be useful. This is called <strong>banking</strong> <span class="citation" data-cites="Cleveland:1988:Banking">(<a href="16-chap.html#ref-Cleveland:1988:Banking" role="doc-biblioref">William S. Cleveland, McGill, and McGill 1988</a>)</span>.</p></li>
</ul>
<p>To illustrate banking, let’s use the classic sunspot data from Cleveland’s paper.</p>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"ggthemes"</span>)</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>sunsp <span class="ot">=</span> <span class="fu">tibble</span>(<span class="at">year   =</span> <span class="fu">time</span>(sunspot.year),</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">number =</span> <span class="fu">as.numeric</span>(sunspot.year))</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>sp <span class="ot">=</span> <span class="fu">ggplot</span>(sunsp, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> number)) <span class="sc">+</span> <span class="fu">geom_line</span>()</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>sp</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>ratio <span class="ot">=</span> <span class="fu">with</span>(sunsp, <span class="fu">bank_slopes</span>(year, number))</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>sp <span class="sc">+</span> <span class="fu">coord_fixed</span>(<span class="at">ratio =</span> ratio)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-graphics-banking" class="quarto-layout-panel page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-graphics-banking-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<div class="quarto-layout-row page-full">

<div class="no-row-height column-margin column-container"><div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-graphics-banking" style="flex-basis: 100.0%;justify-content: center;">
<div id="fig-graphics-banking-1" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center" width="300">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-graphics-banking-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="03-chap_files/figure-html/fig-graphics-banking-1.png" class="lightbox" data-gallery="fig-graphics-banking" title="Figure&nbsp;3.32&nbsp;(a): "><img src="03-chap_files/figure-html/fig-graphics-banking-1.png" id="fig-graphics-banking-1" class="img-fluid quarto-figure quarto-figure-center anchored figure-img" data-ref-parent="fig-graphics-banking" width="300"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-graphics-banking-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a)
</figcaption>
</figure>
</div>
</div></div></div>
<div class="quarto-layout-row page-full">

<div class="no-row-height column-margin column-container"><div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-graphics-banking" style="flex-basis: 100.0%;justify-content: center;">
<div id="fig-graphics-banking-2" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center" width="300">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-graphics-banking-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="03-chap_files/figure-html/fig-graphics-banking-2.png" class="lightbox" data-gallery="fig-graphics-banking" title="Figure&nbsp;3.32&nbsp;(b): "><img src="03-chap_files/figure-html/fig-graphics-banking-2.png" id="fig-graphics-banking-2" class="img-fluid quarto-figure quarto-figure-center anchored figure-img" data-ref-parent="fig-graphics-banking" width="300"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-graphics-banking-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b)
</figcaption>
</figure>
</div>
</div></div></div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-graphics-banking-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.32: The sunspot data. In (a), the plot shape is roughly quadratic, a frequent default choice. In (b), a technique called <strong>banking</strong> was used to choose the plot shape. (Note: the placement of the tick labels is not great in this plot and would benefit from customization.)
</figcaption>
</figure>
</div>
<p>The resulting plot is shown in the upper panel of <a href="#fig-graphics-banking" class="quarto-xref">Figure&nbsp;<span>3.32</span></a>. We can clearly see long-term fluctuations in the amplitude of sunspot activity cycles, with particularly low maximum activities in the early 1700s, early 1800s, and around the turn of the 20<span class="math inline">\(^\text{th}\)</span> century. But now lets try out banking.</p>
<p>How does the algorithm work? It aims to make the slopes in the curve be around one. In particular, <code>bank_slopes</code> computes the median absolute slope, and then with the call to <code>coord_fixed</code> we set the aspect ratio of the plot such that this quantity becomes 1. The result is shown in the lower panel of <a href="#fig-graphics-banking" class="quarto-xref">Figure&nbsp;<span>3.32</span></a>. Quite counter-intuitively, even though the plot takes much smaller space, we see more on it! In particular, we can see the saw-tooth shape of the sunspot cycles, with sharp rises and more slow declines.</p>
</section>
</section>
<section id="sec-graphics-facets" class="level2 page-columns page-full" data-number="3.8">
<h2 data-number="3.8" class="anchored" data-anchor-id="sec-graphics-facets"><span class="header-section-number">3.8</span> Visualizing more than two dimensions</h2>
<p>Sometimes we want to show the relationships between more than two variables. Obvious choices for including additional dimensions are the plot symbol shapes and colors. The <code>geom_point</code> geometric object offers the following aesthetics (beyond <code>x</code> and <code>y</code>):</p>
<ul>
<li><p><code>fill</code></p></li>
<li><p><code>color</code></p></li>
<li><p><code>shape</code></p></li>
<li><p><code>size</code></p></li>
<li><p><code>alpha</code></p></li>
</ul>
<p>They are explored in the manual page of the <code>geom_point</code> function. <code>fill</code> and <code>color</code> refer to the fill and outline color of an object, and <code>alpha</code> to its transparency level. Above, in Figures <a href="#fig-graphics-twodsp2" class="quarto-xref"><span>3.28</span></a> and following, we have used color or transparency to reflect point density and avoid the obscuring effects of overplotting. We can also use these properties to show other dimensions of the data. In principle, we could use all five aesthetics listed above simultaneously to show up to seven-dimensional data; however, such a plot would be hard to decipher. Usually we are better off to limit ourselves to choosing only one or two of these aesthetics and varying them to show one or two additional dimensions in the data.</p>
<section id="faceting" class="level3 page-columns page-full" data-number="3.8.1">
<h3 data-number="3.8.1" class="anchored" data-anchor-id="faceting"><span class="header-section-number">3.8.1</span> Faceting</h3>
<div class="cell page-columns page-full" data-layout-align="center">

<div class="no-row-height column-margin column-container"><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="imgs/devil.png" class="lightbox" data-gallery="quarto-lightbox-gallery-43" title="Sometimes this is also called trellis or lattice graphics, in an allusion to how these arrays of plots look like. The first major R package to implement faceting was lattice. In this book, we’ll use the faceting functionalities provided through ggplot2."><img src="imgs/devil.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="123" alt="Sometimes this is also called trellis or lattice graphics, in an allusion to how these arrays of plots look like. The first major R package to implement faceting was lattice. In this book, we’ll use the faceting functionalities provided through ggplot2."></a></p>
</figure>
</div>
<figcaption>Sometimes this is also called <em>trellis</em> or <em>lattice</em> graphics, in an allusion to how these arrays of plots look like. The first major R package to implement faceting was <strong><a href="https://cran.r-project.org/web/packages/lattice/">lattice</a></strong>. In this book, we’ll use the faceting functionalities provided through <strong><a href="https://cran.r-project.org/web/packages/ggplot2/">ggplot2</a></strong>.</figcaption>
</figure>
</div>
</div></div></div>
<p>Another way to show additional dimensions of the data is to show multiple plots that result from repeatedly subsetting (or “slicing”) our data based on one (or more) of the variables, so that we can visualize each part separately. This is called <strong>faceting</strong> and it enables us to visualize data in up to four or five dimensions. So we can, for instance, investigate whether the observed patterns among the other variables are the same or different across the range of the faceting variable. Let’s look at an example:</p>
<!-- TODO: skipped to avoid overlap;
could put this as a comment in the code?


::: {.cell .column-margin layout-align="center"}
::: {.cell-output-display}
![The first three lines of this code chunk are not strictly necessary – they're just reformatting the `lineage` column of the `dftx` dataframe to make it more concise.](imgs/devil.png){fig-align='center' width=123}
:::
:::

-->
<div class="cell page-columns page-full" data-layout-align="center">
<div class="sourceCode cell-code" id="cb54" data-cap-location="margin"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"magrittr"</span>)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>dftx<span class="sc">$</span>lineage <span class="sc">%&lt;&gt;%</span> <span class="fu">sub</span>(<span class="st">"^$"</span>, <span class="st">"no"</span>, .)</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>dftx<span class="sc">$</span>lineage <span class="sc">%&lt;&gt;%</span> <span class="fu">factor</span>(<span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"no"</span>, <span class="st">"EPI"</span>, <span class="st">"PE"</span>, <span class="st">"FGF4-KO"</span>))</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dftx, <span class="fu">aes</span>(<span class="at">x =</span> X1426642_at, <span class="at">y =</span> X1418765_at)) <span class="sc">+</span></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">facet_grid</span>( . <span class="sc">~</span> lineage )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display page-columns page-full">
<div id="fig-graphics-facet1" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full" data-fig-align="center" data-cap-location="margin">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-graphics-facet1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="03-chap_files/figure-html/fig-graphics-facet1-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-44" title="Figure&nbsp;3.33: An example of faceting: the same data as in Figure&nbsp;fig-graphics-scp2layers1, but now split by the categorical variable lineage."><img src="03-chap_files/figure-html/fig-graphics-facet1-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="640"></a>
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-graphics-facet1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.33: An example of <strong>faceting</strong>: the same data as in <a href="#fig-graphics-scp2layers1" class="quarto-xref">Figure&nbsp;<span>3.9</span></a>, but now split by the categorical variable <code>lineage</code>.
</figcaption>
</figure>
</div>
</div>
</div>
<p>The result is shown in <a href="#fig-graphics-facet1" class="quarto-xref">Figure&nbsp;<span>3.33</span></a>. We have used R’s formula language to specify the variable by which we want to split the data, and that the separate panels should be in different columns: <code>facet_grid( . ~ lineage )</code>. In fact, we can specify two faceting variables, as follows; the result is shown in <a href="#fig-graphics-facet2" class="quarto-xref">Figure&nbsp;<span>3.34</span></a>.</p>
<div class="cell page-columns page-full" data-layout-align="center">
<div class="sourceCode cell-code" id="cb55" data-cap-location="margin"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dftx,</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> X1426642_at, <span class="at">y =</span> X1418765_at)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">facet_grid</span>( Embryonic.day <span class="sc">~</span> lineage )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display page-columns page-full">
<div id="fig-graphics-facet2" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full" data-fig-align="center" data-cap-location="margin">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-graphics-facet2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="03-chap_files/figure-html/fig-graphics-facet2-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-45" title="Figure&nbsp;3.34: Faceting: the same data as in Figure&nbsp;fig-graphics-scp2layers1, split by the categorical variables Embryonic.day (rows) and lineage (columns)."><img src="03-chap_files/figure-html/fig-graphics-facet2-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:75.0%"></a>
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-graphics-facet2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.34: <strong>Faceting</strong>: the same data as in <a href="#fig-graphics-scp2layers1" class="quarto-xref">Figure&nbsp;<span>3.9</span></a>, split by the categorical variables <code>Embryonic.day</code> (rows) and <code>lineage</code> (columns).
</figcaption>
</figure>
</div>
</div>
</div>
<p>Another useful function is <code>facet_wrap</code>: if the faceting variable has too many levels for all the plots to fit in one row or one column, then this function can be used to wrap them into a specified number of columns or rows. So far we have seen faceting by categorical variables, but we can also use it with continuous variables by discretizing them into levels. The function <code>cut</code> is useful for this purpose.</p>
<div class="cell page-columns page-full" data-layout-align="center">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">mutate</span>(dftx, <span class="at">Tdgf1 =</span> <span class="fu">cut</span>(X1450989_at, <span class="at">breaks =</span> <span class="dv">4</span>)),</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">aes</span>(<span class="at">x =</span> X1426642_at, <span class="at">y =</span> X1418765_at)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">facet_wrap</span>( <span class="sc">~</span> Tdgf1, <span class="at">ncol =</span> <span class="dv">2</span> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

<div class="no-row-height column-margin column-container"><div class="cell-output-display">
<div id="fig-graphics-facet3" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-graphics-facet3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="03-chap_files/figure-html/fig-graphics-facet3-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-46" title="Figure&nbsp;3.35: Faceting: the same data as in Figure&nbsp;fig-graphics-scp2layers1, split by the continuous variable X1450989_at and arranged by facet_wrap."><img src="03-chap_files/figure-html/fig-graphics-facet3-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="320"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-graphics-facet3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.35: <strong>Faceting</strong>: the same data as in <a href="#fig-graphics-scp2layers1" class="quarto-xref">Figure&nbsp;<span>3.9</span></a>, split by the continuous variable <code>X1450989_at</code> and arranged by <code>facet_wrap</code>.
</figcaption>
</figure>
</div>
</div></div></div>
<p>We see in <a href="#fig-graphics-facet3" class="quarto-xref">Figure&nbsp;<span>3.35</span></a> that the number of points in the four panels is different. This is because <code>cut</code> splits into bins of equal length, not equal number of points. If we want the latter, then we can use <code>quantile</code> in conjunction with <code>cut</code>, or cut on the ranks of the variable’s values.</p>
<section id="axes-scales" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="axes-scales">Axes scales</h4>
<p>In Figures <a href="#fig-graphics-facet1" class="quarto-xref"><span>3.33</span></a>—<a href="#fig-graphics-facet3" class="quarto-xref"><span>3.35</span></a>, the axes scales are the same for all panels. Alternatively, we could let them vary by setting the <code>scales</code> argument of the <code>facet_grid</code> and <code>facet_wrap</code> functions. This argument lets you control whether <span class="math inline">\(x\)</span>-axis and <span class="math inline">\(y\)</span>-axis in each panel have the same scale, or whether either of them or both adapt to each panel’s data range. There is a trade-off: adaptive axes scales might let us see more detail, on the other hand, the panels are then less comparable across the groupings.</p>
</section>
<section id="implicit-faceting" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="implicit-faceting">Implicit faceting</h4>
<p>You can also facet your plots (without explicit calls to <code>facet_grid</code> and <code>facet_wrap</code>) by specifying the aesthetics. A very simple version of implicit faceting is using a factor as your <span class="math inline">\(x\)</span>-axis, such as in Figures <a href="#fig-graphics-onedbp1" class="quarto-xref"><span>3.15</span></a>—<a href="#fig-graphics-oneddot" class="quarto-xref"><span>3.18</span></a>.</p>
</section>
</section>
<section id="interactive-graphics" class="level3 page-columns page-full" data-number="3.8.2">
<h3 data-number="3.8.2" class="anchored" data-anchor-id="interactive-graphics"><span class="header-section-number">3.8.2</span> Interactive graphics</h3>
<p>The plots generated thus far have been static images. You can add an enormous amount of information and expressivity by making your plots interactive. We do not try here to to convey interactive visualizations in any depth, but we provide pointers to a few important resources. This is a dynamic space, so readers should explore the R ecosystem for recent developments.</p>
<section id="shiny" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="shiny">shiny</h4>
<p>Rstudio’s <strong><a href="https://cran.r-project.org/web/packages/shiny/">shiny</a></strong> is a web application framework for R. It makes it easy to create interactive displays with sliders, selectors and other control elements that allow changing all aspects of the plot(s) shown – since the interactive elements call back directly into the R code that produces the plot(s). See the <a href="https://shiny.posit.co/r/gallery">shiny gallery</a> for some great examples.</p>
<p>As a graphics engine for <strong><a href="https://cran.r-project.org/web/packages/shiny/">shiny</a></strong>-based interactive visualizations you can use <strong><a href="https://cran.r-project.org/web/packages/ggplot2/">ggplot2</a></strong>, and indeed, base R graphics or any other graphics package. What may be a little awkward here is that the language used for describing the interactive options is separated from the production of the graphics via <strong><a href="https://cran.r-project.org/web/packages/ggplot2/">ggplot2</a></strong> and the grammar of graphics. The <strong><a href="https://cran.r-project.org/web/packages/ggvis/">ggvis</a></strong> package aims to overcome this limitation:</p>
</section>
<section id="ggvis" class="level4 unnumbered page-columns page-full">
<h4 class="unnumbered anchored" data-anchor-id="ggvis">ggvis</h4>
<p><strong><a href="https://cran.r-project.org/web/packages/ggvis/">ggvis</a></strong><a href="#fn11" class="footnote-ref" id="fnref11" role="doc-noteref"><sup>11</sup></a> is an attempt at extending the good features of <strong><a href="https://cran.r-project.org/web/packages/ggplot2/">ggplot2</a></strong> into the realm of interactive graphics. In contrast to <strong><a href="https://cran.r-project.org/web/packages/ggplot2/">ggplot2</a></strong>, which produces graphics into R’s traditional graphics devices (PDF, PNG, etc.), <strong><a href="https://cran.r-project.org/web/packages/ggvis/">ggvis</a></strong> builds upon a JavaScript infrastructure called <a href="https://github.com/trifacta/vega">Vega</a>, and its plots are intended to be viewed in an HTML browser. Like <strong><a href="https://cran.r-project.org/web/packages/ggplot2/">ggplot2</a></strong>, the <strong><a href="https://cran.r-project.org/web/packages/ggvis/">ggvis</a></strong> package is inspired by grammar of graphics concepts, but uses distinct syntax. It leverages <strong><a href="https://cran.r-project.org/web/packages/shiny/">shiny</a></strong>’s infrastructure to connect to R to perform the computations needed for the interactivity. As its author put it<a href="#fn12" class="footnote-ref" id="fnref12" role="doc-noteref"><sup>12</sup></a>, “The goal is to combine the best of R (e.g., every modeling function you can imagine) and the best of the web (everyone has a web browser). Data manipulation and transformation are done in R, and the graphics are rendered in a web browser, using Vega.”</p>
<div class="no-row-height column-margin column-container"><div id="fn11"><p><sup>11</sup>&nbsp;At the time of writing (summer 2017), it is not clear whether the initial momentum of <strong><a href="https://cran.r-project.org/web/packages/ggvis/">ggvis</a></strong> development will be maintained, and its current functionality and maturity do no yet match <strong><a href="https://cran.r-project.org/web/packages/ggplot2/">ggplot2</a></strong>.</p></div><div id="fn12"><p><sup>12</sup>&nbsp;https://ggvis.rstudio.com</p></div></div><p>As a consequence of the interactivity in <strong><a href="https://cran.r-project.org/web/packages/shiny/">shiny</a></strong> and <strong><a href="https://cran.r-project.org/web/packages/ggvis/">ggvis</a></strong>, there needs to be an R interpreter running with the underlying data and code to respond to the user’s actions while she views the graphic. This R interpreter can be on the local machine or on a server; in both cases, the viewing application is a web browser, and the interaction with R goes through web protocols (http or https). That is, of course, different from a graphic stored in a self-contained file, which is produced once by R and can then be viewed in a PDF or HTML viewer without any connection to a running instance of R.</p>
</section>
<section id="plotly" class="level4 unnumbered page-columns page-full">
<h4 class="unnumbered anchored" data-anchor-id="plotly">plotly</h4>
<p>A great web-based tool for interactive graphic generation is <strong>plotly</strong>. You can view some examples of interactive graphics online at <a href="https://plot.ly/r" class="uri">https://plot.ly/r</a>. To create your own interactive plots in R, you can use code such as</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"plotly"</span>)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ly</span>(economics, <span class="at">x =</span> <span class="sc">~</span> date, <span class="at">y =</span> <span class="sc">~</span> unemploy <span class="sc">/</span> pop)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As with <strong><a href="https://cran.r-project.org/web/packages/shiny/">shiny</a></strong> and <strong><a href="https://cran.r-project.org/web/packages/ggvis/">ggvis</a></strong>, the graphics are viewed in an HTML browser; however, no running R session is required. The graphics are self-contained HTML documents whose “logic” is coded in JavaScript, or more precisely, in the D3.js system.</p>
<div class="cell page-columns page-full" data-layout-align="center">

<div class="no-row-height column-margin column-container"><div class="cell-output-display">
<div id="fig-graphics-rglvolcano" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-graphics-rglvolcano-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="imgs/chap3-rglvolcano.png" class="lightbox" data-gallery="quarto-lightbox-gallery-47" title="Figure&nbsp;3.36: rgl rendering of the volcano data, the topographic information for Maunga Whau (Mt Eden), one of about 50 volcanos in the Auckland volcanic field."><img src="imgs/chap3-rglvolcano.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-graphics-rglvolcano-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.36: <strong><a href="https://cran.r-project.org/web/packages/rgl/">rgl</a></strong> rendering of the <code>volcano</code> data, the topographic information for Maunga Whau (Mt Eden), one of about 50 volcanos in the Auckland volcanic field.
</figcaption>
</figure>
</div>
</div></div></div>
</section>
<section id="rgl-webgl" class="level4 unnumbered page-columns page-full">
<h4 class="unnumbered anchored" data-anchor-id="rgl-webgl">rgl, webgl</h4>
<p>For visualizing 3D objects (say, a geometrical structure), there is the package <strong><a href="https://cran.r-project.org/web/packages/rgl/">rgl</a></strong>. It produces interactive viewer windows (either in specialized graphics device on your screen or through a web browser) in which you can rotate the scene, zoom and in out, etc. A screenshot of the scene produced by the code below is shown in <a href="#fig-graphics-rglvolcano" class="quarto-xref">Figure&nbsp;<span>3.36</span></a>; such screenshots can be produced using the function <code>snapshot3d</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"volcano"</span>)</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>volcanoData <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="dv">10</span> <span class="sc">*</span> <span class="fu">seq_len</span>(<span class="fu">nrow</span>(volcano)),</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="dv">10</span> <span class="sc">*</span> <span class="fu">seq_len</span>(<span class="fu">ncol</span>(volcano)),</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">z =</span> volcano,</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">col =</span> <span class="fu">terrain.colors</span>(<span class="dv">500</span>)[<span class="fu">cut</span>(volcano, <span class="at">breaks =</span> <span class="dv">500</span>)]</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"rgl"</span>)</span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(volcanoData, <span class="fu">persp3d</span>(x, y, z, <span class="at">color =</span> col))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In the code above, the base R function <code>cut</code> computes a mapping from the value range of the <code>volcano</code> data to the integers between 1 and 500<a href="#fn13" class="footnote-ref" id="fnref13" role="doc-noteref"><sup>13</sup></a>, which we use to index the color scale, <code>terrain.colors(500)</code>. For more information, consult the package’s excellent vignette.</p>
<div class="no-row-height column-margin column-container"><div id="fn13"><p><sup>13</sup>&nbsp;More precisely, it returns a factor with as many levels, which we let R autoconvert to integers.</p></div></div></section>
</section>
</section>
<section id="sec-graphics-color" class="level2 page-columns page-full" data-number="3.9">
<h2 data-number="3.9" class="anchored" data-anchor-id="sec-graphics-color"><span class="header-section-number">3.9</span> Color</h2>
<p>An important consideration when making plots is the coloring that we use in them. Most R users are likely familiar with the built-in R color scheme, used by base R graphics, as shown in <a href="#fig-graphics-simplecolorpie" class="quarto-xref">Figure&nbsp;<span>3.37</span></a>.</p>
<div class="cell page-columns page-full" data-layout-align="center">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pie</span>(<span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">8</span>), <span class="at">col=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

<div class="no-row-height column-margin column-container"><div class="cell-output-display">
<div id="fig-graphics-simplecolorpie" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-graphics-simplecolorpie-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="03-chap_files/figure-html/fig-graphics-simplecolorpie-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-48" title="Figure&nbsp;3.37: The first eight colors in the base R color palette."><img src="03-chap_files/figure-html/fig-graphics-simplecolorpie-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="240"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-graphics-simplecolorpie-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.37: The first eight colors in the base R color palette.
</figcaption>
</figure>
</div>
</div></div></div>
<p>The origins of this color palette date back to 1980s hardware, where graphics cards handled colors by letting each pixel either use or not use each of the three basic color channels of a cathode-ray tube: red, green and blue (RGB). This led to <span class="math inline">\(2^3=8\)</span> combinations at the eight corners of an RGB color cube<a href="#fn14" class="footnote-ref" id="fnref14" role="doc-noteref"><sup>14</sup></a>.</p>
<div class="no-row-height column-margin column-container"><div id="fn14"><p><sup>14</sup>&nbsp;Thus, the <span class="math inline">\(8^\text{th}\)</span> color in <a href="#fig-graphics-simplecolorpie" class="quarto-xref">Figure&nbsp;<span>3.37</span></a> should be white, instead it is grey.</p></div></div><p>The first eight colors for a categorical variable in <strong><a href="https://cran.r-project.org/web/packages/ggplot2/">ggplot2</a></strong> are shown in <a href="#fig-graphics-ggplot2colorpie" class="quarto-xref">Figure&nbsp;<span>3.38</span></a>:</p>
<div class="cell page-columns page-full" data-layout-align="center">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">tibble</span>(<span class="at">u =</span> <span class="fu">factor</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>), <span class="at">v =</span> <span class="dv">1</span>), </span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> <span class="st">""</span>,  <span class="at">y =</span> v, <span class="at">fill =</span> u)) <span class="sc">+</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">width =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_polar</span>(<span class="st">"y"</span>, <span class="at">start =</span> <span class="dv">0</span>) <span class="sc">+</span> <span class="fu">theme_void</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

<div class="no-row-height column-margin column-container"><div class="cell-output-display">
<div id="fig-graphics-ggplot2colorpie" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-graphics-ggplot2colorpie-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="03-chap_files/figure-html/fig-graphics-ggplot2colorpie-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-49" title="Figure&nbsp;3.38: The first eight colors in the ggplot2 color palette."><img src="03-chap_files/figure-html/fig-graphics-ggplot2colorpie-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="320"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-graphics-ggplot2colorpie-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.38: The first eight colors in the <strong><a href="https://cran.r-project.org/web/packages/ggplot2/">ggplot2</a></strong> color palette.
</figcaption>
</figure>
</div>
</div></div></div>
<p>These defaults are appropriate for simple use cases, but often we will want to make our own choices. In <a href="#sec-graphics-2d" class="quarto-xref"><span>Section 3.7</span></a> we already saw the function <code>scale_fill_gradientn</code>, with which we created the smooth-looking color gradient used in Figures <a href="#fig-graphics-twodsp4" class="quarto-xref"><span>3.30</span></a> and <a href="#fig-graphics-twodsp6" class="quarto-xref"><span>3.31</span></a> by interpolating a set of color steps provided by the function <code>brewer.pal</code> in the <strong><a href="https://cran.r-project.org/web/packages/RColorBrewer/">RColorBrewer</a></strong> package. This package defines a set of purpose-designed color palettes. We can see all of them at a glance with the function <code>display.brewer.all</code> (<a href="#fig-graphics-RColorBrewer" class="quarto-xref">Figure&nbsp;<span>3.39</span></a>).</p>
<div class="cell page-columns page-full" data-layout-align="center">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">display.brewer.all</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

<div class="no-row-height column-margin column-container"><div class="cell-output-display">
<div id="fig-graphics-RColorBrewer" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-graphics-RColorBrewer-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="03-chap_files/figure-html/fig-graphics-RColorBrewer-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-50" title="Figure&nbsp;3.39: RColorBrewer palettes."><img src="03-chap_files/figure-html/fig-graphics-RColorBrewer-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="480"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-graphics-RColorBrewer-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.39: RColorBrewer palettes.
</figcaption>
</figure>
</div>
</div></div></div>
<p>We can get information about the available color palettes from <code>brewer.pal.info</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(brewer.pal.info)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     maxcolors category colorblind
BrBG        11      div       TRUE
PiYG        11      div       TRUE
PRGn        11      div       TRUE
PuOr        11      div       TRUE
RdBu        11      div       TRUE
RdGy        11      div      FALSE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(brewer.pal.info<span class="sc">$</span>category)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 div qual  seq 
   9    8   18 </code></pre>
</div>
</div>
<p>The palettes are divided into three categories:</p>
<ul>
<li><p>qualitative: for categorical properties that have no intrinsic ordering. The <code>Paired</code> palette supports up to 6 categories that each fall into two subcategories - such as <em>before</em> and <em>after</em>, <em>with</em> and <em>without</em> treatment, etc.</p></li>
<li><p>sequential: for quantitative properties that go from <em>low</em> to <em>high</em></p></li>
<li><p>diverging: for quantitative properties for which there is a natural midpoint or neutral value, and whose value can deviate both up- and down; we’ll see an example in <a href="#fig-graphics-heatmap" class="quarto-xref">Figure&nbsp;<span>3.41</span></a>.</p></li>
</ul>
<p>To obtain the colors from a particular palette we use the function <code>brewer.pal</code>. Its first argument is the number of colors we want (which can be less than the available maximum number in <code>brewer.pal.info</code>).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">brewer.pal</span>(<span class="dv">4</span>, <span class="st">"RdYlGn"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "#D7191C" "#FDAE61" "#A6D96A" "#1A9641"</code></pre>
</div>
</div>
<p>If we want more than the available number of preset colors (for example so we can plot a heatmap with continuous colors) we can interpolate using the <code>colorRampPalette</code> function<a href="#fn15" class="footnote-ref" id="fnref15" role="doc-noteref"><sup>15</sup></a>.</p>
<div class="no-row-height column-margin column-container"><div id="fn15"><p><sup>15</sup>&nbsp;<code>colorRampPalette</code> returns a function of one parameter, an integer. In the code shown, we call that function with the argument <code>100</code>.</p></div></div><div class="cell page-columns page-full" data-layout-align="center">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>mypalette  <span class="ot">=</span> <span class="fu">colorRampPalette</span>(</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">"darkorange3"</span>, <span class="st">"white"</span>,<span class="st">"darkblue"</span>)</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>  )(<span class="dv">100</span>)</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(mypalette)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "#CD6600" "#CE6905" "#CF6C0A" "#D06F0F" "#D17214" "#D27519"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">image</span>(<span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>, <span class="at">nrow =</span> <span class="dv">100</span>, <span class="at">ncol =</span> <span class="dv">10</span>), <span class="at">col =</span> mypalette,</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">xaxt =</span> <span class="st">"n"</span>, <span class="at">yaxt =</span> <span class="st">"n"</span>, <span class="at">useRaster =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

<div class="no-row-height column-margin column-container"><div class="cell-output-display">
<div id="fig-graphics-colorRampPalette" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-graphics-colorRampPalette-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="03-chap_files/figure-html/fig-graphics-colorRampPalette-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-51" title="Figure&nbsp;3.40: A quasi-continuous color palette derived by interpolating between the colors darkorange3, white and darkblue."><img src="03-chap_files/figure-html/fig-graphics-colorRampPalette-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="240"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-graphics-colorRampPalette-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.40: A quasi-continuous color palette derived by interpolating between the colors <code>darkorange3</code>, <code>white</code> and <code>darkblue</code>.
</figcaption>
</figure>
</div>
</div></div></div>
</section>
<section id="heatmaps" class="level2 page-columns page-full" data-number="3.10">
<h2 data-number="3.10" class="anchored" data-anchor-id="heatmaps"><span class="header-section-number">3.10</span> Heatmaps</h2>
<p>Heatmaps are a powerful way of visualizing large, matrix-like datasets and providing a quick overview of the patterns that might be in the data. There are a number of heatmap drawing functions in R; one that is convenient and produces a good-looking output is the function <code>pheatmap</code> from the eponymous package<a href="#fn16" class="footnote-ref" id="fnref16" role="doc-noteref"><sup>16</sup></a>. In the code below, we first select the top 500 most variable genes in the dataset <code>x</code> and define a function <code>rowCenter</code> that centers each gene (row) by subtracting the mean across columns. By default, <code>pheatmap</code> uses the <em>RdYlBu</em> color palette from <strong><a href="https://cran.r-project.org/web/packages/RcolorBrewer/">RcolorBrewer</a></strong> in conjuction with the <code>colorRampPalette</code> function to interpolate the 11 colors into a smooth-looking palette (<a href="#fig-graphics-heatmap" class="quarto-xref">Figure&nbsp;<span>3.41</span></a>).</p>
<div class="no-row-height column-margin column-container"><div id="fn16"><p><sup>16</sup>&nbsp;A very versatile and modular alternative is the <strong><a href="https://bioconductor.org/packages/ComplexHeatmap/">ComplexHeatmap</a></strong> package.</p></div></div><div class="cell page-columns page-full" data-layout-align="center">
<div class="sourceCode cell-code" id="cb71" data-cap-location="margin"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"pheatmap"</span>)</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>topGenes <span class="ot">=</span> <span class="fu">order</span>(<span class="fu">rowVars</span>(Biobase<span class="sc">::</span><span class="fu">exprs</span>(x)), <span class="at">decreasing =</span> <span class="cn">TRUE</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">500</span>]</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>rowCenter <span class="ot">=</span> <span class="cf">function</span>(x) { x <span class="sc">-</span> <span class="fu">rowMeans</span>(x) }</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a><span class="fu">pheatmap</span>(<span class="fu">rowCenter</span>(dfx[topGenes, ]), </span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">show_rownames =</span> <span class="cn">FALSE</span>, </span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">show_colnames =</span> <span class="cn">FALSE</span>, </span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="sc">+</span><span class="dv">5</span>, <span class="at">length =</span> <span class="dv">101</span>),</span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">annotation_col =</span> <span class="fu">pData</span>(x)[, <span class="fu">c</span>(<span class="st">"sampleGroup"</span>, <span class="st">"Embryonic.day"</span>, <span class="st">"ScanDate"</span>, <span class="st">"genotype"</span>) ],</span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">annotation_colors =</span> <span class="fu">list</span>(</span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">sampleGroup =</span> groupColor,</span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">genotype =</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">FGF4-KO</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"chocolate1"</span>, <span class="st">`</span><span class="at">WT</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"azure2"</span>),</span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">Embryonic.day =</span> <span class="fu">setNames</span>(<span class="fu">brewer.pal</span>(<span class="dv">9</span>, <span class="st">"Blues"</span>)[<span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">9</span>)], <span class="fu">c</span>(<span class="st">"E3.25"</span>, <span class="st">"E3.5"</span>, <span class="st">"E4.5"</span>)),</span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">ScanDate =</span> <span class="fu">setNames</span>(<span class="fu">brewer.pal</span>(<span class="fu">nlevels</span>(x<span class="sc">$</span>ScanDate), <span class="st">"YlGn"</span>), <span class="fu">levels</span>(x<span class="sc">$</span>ScanDate))</span>
<span id="cb71-14"><a href="#cb71-14" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb71-15"><a href="#cb71-15" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display page-columns page-full">
<div id="fig-graphics-heatmap" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full" data-fig-align="center" data-cap-location="margin">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-graphics-heatmap-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="03-chap_files/figure-html/fig-graphics-heatmap-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-52" title="Figure&nbsp;3.41: A heatmap of relative expression values, i.e., logarithmic fold change compared to the average expression of that gene (row) across all samples (columns). The color scale uses a diverging palette whose midpoint is at 0."><img src="03-chap_files/figure-html/fig-graphics-heatmap-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="560"></a>
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-graphics-heatmap-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.41: A heatmap of relative expression values, i.e., logarithmic fold change compared to the average expression of that gene (row) across all samples (columns). The color scale uses a diverging palette whose midpoint is at 0.
</figcaption>
</figure>
</div>
</div>
</div>
<p>Let’s take a minute to deconstruct this rather massive-looking call to <code>pheatmap</code>. The options <code>show_rownames</code> and <code>show_colnames</code> control whether the row and column names are printed at the sides of the matrix. Because our matrix is large in relation to the available plotting space, the labels would not be readable, so we might as well suppress them. The <code>annotation_col</code> argument takes a data frame that carries additional information about the samples. The information is shown in the colored bars on top of the heatmap. There is also a similar <code>annotation_row</code> argument, which we haven’t used here, to annotate the rows (genes) with colored bars at the side. The argument <code>annotation_colors</code> is a list of named vectors by which we can override the default choice of colors for the annotation bars. The <code>pheatmap</code> function has many further options, and if you want to use it for your own data visualizations, it’s worth studying them.</p>
<section id="dendrogram-ordering" class="level3 page-columns page-full" data-number="3.10.1">
<h3 data-number="3.10.1" class="anchored" data-anchor-id="dendrogram-ordering"><span class="header-section-number">3.10.1</span> Dendrogram ordering</h3>
<p>In <a href="#fig-graphics-heatmap" class="quarto-xref">Figure&nbsp;<span>3.41</span></a>, the trees at the left and the top represent the result of a hierarchical clustering algorithm and are also called <strong>dendrograms</strong>. The ordering of the rows and columns is based on the dendrograms. It has an enormous effect on the visual impact of the heatmap. However, it can be difficult to decide which of the apparent patterns are real and which are consequences of arbitrary tree layout decisions<a href="#fn17" class="footnote-ref" id="fnref17" role="doc-noteref"><sup>17</sup></a>. Let’s keep in mind that:</p>
<div class="no-row-height column-margin column-container"><div id="fn17"><p><sup>17</sup>&nbsp;We will learn about clustering and methods for evaluating cluster significance in <a href="05-chap.html" class="quarto-xref"><span>Chapter 5</span></a>.</p></div></div><ul>
<li><p>Ordering the rows and columns by cluster dendrogram (as in <a href="#fig-graphics-heatmap" class="quarto-xref">Figure&nbsp;<span>3.41</span></a>) is an arbitrary choice, and you could just as well make others.</p></li>
<li><p>Even if you settle on dendrogram ordering, there is an essentially arbitrary choice at each internal branch, as each branch could be flipped without changing the topology of the tree (see also <a href="05-chap.html#fig-mobile" class="quarto-xref">Figure&nbsp;<span>5.21</span></a>).</p></li>
</ul>
<div id="wrn-graphics-pheatmapbranches" class="callout callout-style-default callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Question&nbsp;3.6
</div>
</div>
<div class="callout-body-container callout-body">
<p>How does the <code>pheatmap</code> function deal with the decision of how to pick which branches of the subtree go left and right?</p>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-11-contents" aria-controls="callout-11" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-11" class="callout-11-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>This is described in the manual page of the <code>hclust</code> function in the <strong><a href="https://cran.r-project.org/web/packages/stats/">stats</a></strong> package, which, by default, is used by <code>pheatmap</code>.</p>
</div>
</div>
</div>
<div id="wrn-graphics-pheatmaporder" class="callout callout-style-default callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Question&nbsp;3.7
</div>
</div>
<div class="callout-body-container callout-body">
<p>What other ordering methods can you think of?</p>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-13-contents" aria-controls="callout-13" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-13" class="callout-13-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Among the methods proposed is the travelling salesman problem <span class="citation" data-cites="McCormick:1972:MatrixClustering">(<a href="16-chap.html#ref-McCormick:1972:MatrixClustering" role="doc-biblioref">McCormick Jr, Schweitzer, and White 1972</a>)</span> or projection on the first principal component (for instance, see the examples in the manual page of <code>pheatmap</code>).</p>
</div>
</div>
</div>
<div id="wrn-graphics-pheatmapcallback" class="callout callout-style-default callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Question&nbsp;3.8
</div>
</div>
<div class="callout-body-container callout-body">
<p>Check the argument <code>clustering_callback</code> of the <code>pheatmap</code> function.</p>
</div>
</div>
</section>
<section id="sec-graphics-colorspaces" class="level3 page-columns page-full" data-number="3.10.2">
<h3 data-number="3.10.2" class="anchored" data-anchor-id="sec-graphics-colorspaces"><span class="header-section-number">3.10.2</span> Color spaces</h3>
<p>Color perception in humans <span class="citation" data-cites="Helmholtz:1867">(<a href="16-chap.html#ref-Helmholtz:1867" role="doc-biblioref">Helmholtz 1867</a>)</span> is three-dimensional<a href="#fn18" class="footnote-ref" id="fnref18" role="doc-noteref"><sup>18</sup></a>. There are different ways of parameterizing this space. Above we already encountered the RGB color model, which uses three values in [0,1], for instance at the beginning of <a href="#sec-graphics-ggplot" class="quarto-xref"><span>Section 3.4</span></a>, where we printed out the contents of <code>groupColor</code>:</p>
<div class="no-row-height column-margin column-container"><div id="fn18"><p><sup>18</sup>&nbsp;Physically, there is an infinite number of wave-lengths of light and an infinite number of ways of mixing them, so for other species, or robots, color space can have fewer or more dimensions.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>groupColor[<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    E3.25 
"#CAB2D6" </code></pre>
</div>
</div>
<p>Here, CA is the hexadecimal representation for the strength of the red color channel, B2 of the green and D6 of the blue color channel. In decimal, these numbers are 202, 178 and 214. The range of these values goes from to 0 to 255, so by dividing by this maximum value, an RGB triplet can also be thought of as a point in the three-dimensional unit cube.</p>
<div class="cell page-columns page-full" data-layout-nrow="1" data-layout-align="center" data-fig-cap-location="margin">
<div id="fig-graphics-hcl" class="quarto-layout-panel page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-graphics-hcl-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-graphics-hcl" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-graphics-hcl-1" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center" width="320">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-graphics-hcl-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="03-chap_files/figure-html/fig-graphics-hcl-1.png" class="lightbox" data-gallery="fig-graphics-hcl" title="Figure&nbsp;3.42&nbsp;(a): "><img src="03-chap_files/figure-html/fig-graphics-hcl-1.png" id="fig-graphics-hcl-1" class="img-fluid quarto-figure quarto-figure-center anchored figure-img" data-ref-parent="fig-graphics-hcl" width="320"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-graphics-hcl-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a)
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-graphics-hcl" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-graphics-hcl-2" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center" width="320">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-graphics-hcl-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="03-chap_files/figure-html/fig-graphics-hcl-2.png" class="lightbox" data-gallery="fig-graphics-hcl" title="Figure&nbsp;3.42&nbsp;(b): "><img src="03-chap_files/figure-html/fig-graphics-hcl-2.png" id="fig-graphics-hcl-2" class="img-fluid quarto-figure quarto-figure-center anchored figure-img" data-ref-parent="fig-graphics-hcl" width="320"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-graphics-hcl-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b)
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-graphics-hcl-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.42: Circles in HCL colorspace. (a) Luminance <span class="math inline">\(L\)</span> fixed at <span class="math inline">\(75\)</span>, while the angular coordinate <span class="math inline">\(H\)</span> (hue) varies from 0 to 360 and the radial coordinate <span class="math inline">\(C\)</span> takes the values <span class="math inline">\(0, 10, ..., 60\)</span>. (b) Constant chroma <span class="math inline">\(C\)</span> at <span class="math inline">\(50\)</span>, <span class="math inline">\(H\)</span> as above, and the radial coordinate is luminance <span class="math inline">\(L\)</span> at values <span class="math inline">\(10, 20, ..., 90\)</span>.
</figcaption>
</figure>
</div>
</div>
<p>The function <code>hcl</code> uses a different coordinate system. Again this consists of three coordinates: hue <span class="math inline">\(H\)</span>, an angle in the range <span class="math inline">\([0, 360]\)</span>, chroma <span class="math inline">\(C\)</span>, a positive number, and luminance <span class="math inline">\(L\)</span>, a value in <span class="math inline">\([0, 100]\)</span>. The upper bound for <span class="math inline">\(C\)</span> depends on on hue and luminance.</p>
<p>The <code>hcl</code> function corresponds to polar coordinates in the CIE-LUV<a href="#fn19" class="footnote-ref" id="fnref19" role="doc-noteref"><sup>19</sup></a> and is designed for area fills. By keeping chroma and luminance coordinates constant and only varying hue, it is easy to produce color palettes that are harmonious and avoid irradiation illusions that make light colored areas look bigger than dark ones. Our attention also tends to get drawn to loud colors, and fixing the value of chroma makes the colors equally attractive to our eyes.</p>
<div class="no-row-height column-margin column-container"><div id="fn19"><p><sup>19</sup>&nbsp;CIE: Commission Internationale de l’Éclairage – see e.g.&nbsp;Wikipedia for more on this.</p></div></div><p>There are many ways of choosing colors from a color wheel. <em>Triads</em> are three colors chosen equally spaced around the color wheel; for example, <span class="math inline">\(H=0,120,240\)</span> gives red, green, and blue. <em>Tetrads</em> are four equally spaced colors around the color wheel, and some graphic artists describe the effect as “dynamic”. <em>Warm colors</em> are a set of equally spaced colors close to yellow, <em>cool colors</em> a set of equally spaced colors close to blue. <em>Analogous color</em> sets contain colors from a small segment of the color wheel, for example, yellow, orange and red, or green, cyan and blue. <em>Complementary colors</em> are colors diametrically opposite each other on the color wheel. A tetrad is two pairs of complementaries. <em>Split complementaries</em> are three colors consisting of a pair of complementaries, with one partner split equally to each side, for example, <span class="math inline">\(H=60,\,240-30,\,240+30\)</span>. This is useful to emphasize the difference between a pair of similar categories and a third different one. A more thorough discussion is provided in the references <span class="citation" data-cites="Mollon:1995 IhakaColorPres">(<a href="16-chap.html#ref-Mollon:1995" role="doc-biblioref">Mollon 1995</a>; <a href="16-chap.html#ref-IhakaColorPres" role="doc-biblioref">Ihaka 2003</a>)</span>.</p>
<section id="lines-versus-areas" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="lines-versus-areas">Lines versus areas</h4>
<p>For lines and points, we want a strong contrast to the background, so on a white background, we want them to be relatively dark (low luminance <span class="math inline">\(L\)</span>). For area fills, lighter, more pastel-type colors with low to moderate chromatic content are usually more pleasant.</p>
</section>
</section>
</section>
<section id="data-transformations" class="level2 page-columns page-full" data-number="3.11">
<h2 data-number="3.11" class="anchored" data-anchor-id="data-transformations"><span class="header-section-number">3.11</span> Data transformations</h2>
<p>Plots in which most points are huddled up in one area, with much of the available space sparsely populated, are difficult to read. If the histogram of the marginal distribution of a variable has a sharp peak and then long tails to one or both sides, transforming the data can be helpful. These considerations apply both to <code>x</code> and <code>y</code> aesthetics, and to color scales. In the plots of this chapter that involved the microarray data, we used the logarithmic transformation<a href="#fn20" class="footnote-ref" id="fnref20" role="doc-noteref"><sup>20</sup></a> – not only in scatterplots like <a href="#fig-graphics-twodsp1" class="quarto-xref">Figure&nbsp;<span>3.27</span></a> for the <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span>-coordinates, but also in <a href="#fig-graphics-heatmap" class="quarto-xref">Figure&nbsp;<span>3.41</span></a> for the color scale that represents the expression fold changes. The logarithm transformation is attractive because it has a definitive meaning - a move up or down by the same amount on a log-transformed scale corresponds to the same multiplicative change on the original scale: <span class="math inline">\(\log(ax)=\log a+\log x\)</span>.</p>
<div class="no-row-height column-margin column-container"><div id="fn20"><p><sup>20</sup>&nbsp;We used it implicitly since the data in the <em>ExpressionSet</em> object <code>x</code> already come log-transformed.</p></div></div><p>Sometimes the logarithm however is not good enough, for instance when the data include zero or negative values, or when even on the logarithmic scale the data distribution is highly uneven. From the upper panel of <a href="#fig-graphics-MA" class="quarto-xref">Figure&nbsp;<span>3.43</span></a>, it is easy to take away the impression that the distribution of <code>M</code> depends on <code>A</code>, with higher variances for lower <code>A</code>. However, this is entirely a visual artefact, as the lower panel confirms: the distribution of <code>M</code> is independent of <code>A</code>, and the apparent trend we saw in the upper panel was caused by the higher point density at smaller <code>A</code>.</p>
<div class="cell page-columns page-full" data-layout-nrow="1" data-layout-align="center" data-fig-cap-location="margin">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>gg <span class="ot">=</span> <span class="fu">ggplot</span>(<span class="fu">tibble</span>(<span class="at">A =</span> Biobase<span class="sc">::</span><span class="fu">exprs</span>(x)[, <span class="dv">1</span>], <span class="at">M =</span> <span class="fu">rnorm</span>(<span class="fu">length</span>(A))),</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">y =</span> M))</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>gg <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> A), <span class="at">size =</span> <span class="fl">0.2</span>)</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>gg <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">rank</span>(A)), <span class="at">size =</span> <span class="fl">0.2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-graphics-MA" class="quarto-layout-panel page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-graphics-MA-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-graphics-MA" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-graphics-MA-1" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center" width="240">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-graphics-MA-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="03-chap_files/figure-html/fig-graphics-MA-1.png" class="lightbox" data-gallery="fig-graphics-MA" title="Figure&nbsp;3.43&nbsp;(a): "><img src="03-chap_files/figure-html/fig-graphics-MA-1.png" id="fig-graphics-MA-1" class="img-fluid quarto-figure quarto-figure-center anchored figure-img" data-ref-parent="fig-graphics-MA" width="240"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-graphics-MA-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a)
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-graphics-MA" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-graphics-MA-2" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center" width="240">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-graphics-MA-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="03-chap_files/figure-html/fig-graphics-MA-2.png" class="lightbox" data-gallery="fig-graphics-MA" title="Figure&nbsp;3.43&nbsp;(b): "><img src="03-chap_files/figure-html/fig-graphics-MA-2.png" id="fig-graphics-MA-2" class="img-fluid quarto-figure quarto-figure-center anchored figure-img" data-ref-parent="fig-graphics-MA" width="240"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-graphics-MA-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b)
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-graphics-MA-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.43: The effect of rank transformation on the visual perception of dependency.
</figcaption>
</figure>
</div>
</div>
<div id="wrn-graphics-datatrsf" class="callout callout-style-default callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Question&nbsp;3.9
</div>
</div>
<div class="callout-body-container callout-body">
<p>Can the visual artefact be avoided by using a density- or binning-based plotting method, as in <a href="#fig-graphics-twodsp6" class="quarto-xref">Figure&nbsp;<span>3.31</span></a>?</p>
</div>
</div>
<div id="wrn-graphics-histequ" class="callout callout-style-default callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Question&nbsp;3.10
</div>
</div>
<div class="callout-body-container callout-body">
<p>Can the rank transformation also be applied when choosing color scales e.g.&nbsp;for heatmaps? What does <em>histogram equalization</em> in image processing do?</p>
</div>
</div>
</section>
<section id="mathematical-symbols-and-other-fonts" class="level2 page-columns page-full" data-number="3.12">
<h2 data-number="3.12" class="anchored" data-anchor-id="mathematical-symbols-and-other-fonts"><span class="header-section-number">3.12</span> Mathematical symbols and other fonts</h2>
<p>We can use mathematical notation in plot labels, using a notation that is a mix of R syntax and LaTeX-like notation (see <code>help("plotmath")</code> for details):</p>
<div class="cell page-columns page-full" data-layout-align="center">

<div class="no-row-height column-margin column-container"><div class="cell-output-display">
<div id="fig-graphics-otherfont" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-graphics-otherfont-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="imgs/chap3-ecdfs-bauhaus93font.png" class="lightbox" data-gallery="quarto-lightbox-gallery-57" title="Figure&nbsp;3.44: As Figure&nbsp;fig-graphics-onedecdf, with font “Bauhaus 93”."><img src="imgs/chap3-ecdfs-bauhaus93font.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-graphics-otherfont-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.44: As <a href="#fig-graphics-onedecdf" class="quarto-xref">Figure&nbsp;<span>3.24</span></a>, with font “Bauhaus 93”.
</figcaption>
</figure>
</div>
</div></div></div>
<div class="cell page-columns page-full" data-layout-align="center">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>volume <span class="ot">=</span> <span class="cf">function</span>(rho, nu)</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>            pi<span class="sc">^</span>(nu<span class="sc">/</span><span class="dv">2</span>) <span class="sc">*</span> rho<span class="sc">^</span>nu <span class="sc">/</span> <span class="fu">gamma</span>(nu<span class="sc">/</span><span class="dv">2</span><span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">tibble</span>(<span class="at">nu    =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">15</span>,</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Omega =</span> <span class="fu">volume</span>(<span class="dv">1</span>, nu)), <span class="fu">aes</span>(<span class="at">x =</span> nu, <span class="at">y =</span> Omega)) <span class="sc">+</span></span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a><span class="fu">xlab</span>(<span class="fu">expression</span>(nu)) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="fu">expression</span>(Omega)) <span class="sc">+</span></span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_text</span>(<span class="at">label =</span></span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a><span class="st">"Omega(rho,nu)==frac(pi^frac(nu,2)~rho^nu, Gamma(frac(nu,2)+1))"</span>,</span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">parse =</span> <span class="cn">TRUE</span>, <span class="at">x =</span> <span class="dv">6</span>, <span class="at">y =</span> <span class="fl">1.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

<div class="no-row-height column-margin column-container"><div class="cell-output-display">
<div id="fig-graphics-mathnot" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-graphics-mathnot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="03-chap_files/figure-html/fig-graphics-mathnot-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-58" title="Figure&nbsp;3.45: Volume \Omega of the \nu-dimensional sphere with radius \rho=1, for \nu=1,...,15."><img src="03-chap_files/figure-html/fig-graphics-mathnot-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="320"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-graphics-mathnot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.45: Volume <span class="math inline">\(\Omega\)</span> of the <span class="math inline">\(\nu\)</span>-dimensional sphere with radius <span class="math inline">\(\rho=1\)</span>, for <span class="math inline">\(\nu=1,...,15\)</span>.
</figcaption>
</figure>
</div>
</div></div></div>
<p>The result is shown in <a href="#fig-graphics-mathnot" class="quarto-xref">Figure&nbsp;<span>3.45</span></a>. It’s also easy to switch to other fonts, for instance the serif font Times (<a href="#fig-graphics-timesfont" class="quarto-xref">Figure&nbsp;<span>3.46</span></a>).</p>
<div class="cell page-columns page-full" data-layout-align="center">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(genes, <span class="fu">aes</span>( <span class="at">x =</span> value, <span class="at">color =</span> gene)) <span class="sc">+</span> <span class="fu">stat_ecdf</span>() <span class="sc">+</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">"Times"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

<div class="no-row-height column-margin column-container"><div class="cell-output-display">
<div id="fig-graphics-timesfont" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-graphics-timesfont-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="03-chap_files/figure-html/fig-graphics-timesfont-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-59" title="Figure&nbsp;3.46: As Figure&nbsp;fig-graphics-onedecdf, with a different font."><img src="03-chap_files/figure-html/fig-graphics-timesfont-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="320"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-graphics-timesfont-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.46: As <a href="#fig-graphics-onedecdf" class="quarto-xref">Figure&nbsp;<span>3.24</span></a>, with a different font.
</figcaption>
</figure>
</div>
</div></div></div>
<p>In fact, the set of fonts that can be used with a standard R installation are limited, but luckily there is the package <strong><a href="https://cran.r-project.org/web/packages/extrafont/">extrafont</a></strong>, which facilitates using fonts other than R’s standard set of PostScript fonts. There’s some extra work needed before we can use it, since fonts external to R first need to be made known to it. They could come shipped with your operating system, with a word processor or with another graphics application. The set of fonts available and their physical location is therefore not standardized, but will depend on your operating system and further configurations. In the first session after attaching the <strong><a href="https://cran.r-project.org/web/packages/extrafont/">extrafont</a></strong> package, you will need to run the function <code>font_import</code> to import fonts and make them known to the package. Then in each session in which you want to use them, you need to call the <code>loadfonts</code> function to register them with one or more of R’s graphics devices. Finally you can use the <code>fonttable</code> function to list the available fonts. You will need to refer to the documentation of the <strong><a href="https://cran.r-project.org/web/packages/extrafonts/">extrafonts</a></strong> package to see how to make this work on your machine.</p>
<div class="callout callout-style-default callout-tip no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Task
</div>
</div>
<div class="callout-body-container callout-body">
<p>Use the package <strong><a href="https://cran.r-project.org/web/packages/extrafont/">extrafont</a></strong> to produce a version of <a href="#fig-graphics-timesfont" class="quarto-xref">Figure&nbsp;<span>3.46</span></a> with the font “Bauhaus 93” (or another one available on your system).</p>
</div>
</div>
</section>
<section id="genomic-data" class="level2 page-columns page-full" data-number="3.13">
<h2 data-number="3.13" class="anchored" data-anchor-id="genomic-data"><span class="header-section-number">3.13</span> Genomic data</h2>
<div class="cell page-columns page-full" data-layout-align="center">

<div class="no-row-height column-margin column-container"><div class="cell-output-display">
<div id="fig-graphics-EBI-genomebrowser-rnaseq" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-graphics-EBI-genomebrowser-rnaseq-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="imgs/EBI-genomebrowser-rnaseq.png" class="lightbox" data-gallery="quarto-lightbox-gallery-60" title="Figure&nbsp;3.47: Screenshot from Ensembl genome browser, showing gene annotation of a genomic region as well as a read pile-up visualization of an RNA-Seq experiment."><img src="imgs/EBI-genomebrowser-rnaseq.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-graphics-EBI-genomebrowser-rnaseq-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.47: Screenshot from Ensembl genome browser, showing gene annotation of a genomic region as well as a read pile-up visualization of an RNA-Seq experiment.
</figcaption>
</figure>
</div>
</div></div></div>
<p>To visualize genomic data, in addition to the general principles we have discussed in this chapter, there are some specific considerations. The data are usually associated with genomic coordinates. In fact genomic coordinates offer a great organizing principle for the integration of genomic data. You will probably have seen genome browser displays such as in <a href="#fig-graphics-EBI-genomebrowser-rnaseq" class="quarto-xref">Figure&nbsp;<span>3.47</span></a>. Here we will briefly show how to produce such plots programmatically, using your data as well as public annotation. It will be a short glimpse, and we refer to resources such as <a href="https://www.bioconductor.org">Bioconductor</a> for a fuller picture.</p>
<p>The main challenge of genomic data visualization is the size of genomes. We need visualizations at multiple scales, from whole genome down to the nucleotide level. It should be easy to zoom in and and out, and we may need different visualization strategies for the different size scales. It can be convenient to visualize biological molecules (genomes, genes, transcripts, proteins) in a linear manner, although their embedding in the 3D physical world can matter (a great deal).</p>
<p>Let’s start with some fun examples, an ideogram plot of human chromosome 1 (<a href="#fig-graphics-ideogram-1" class="quarto-xref">Figure&nbsp;<span>3.48</span></a>) and a plot of the genome-wide distribution of RNA editing sites (<a href="#fig-graphics-darned1" class="quarto-xref">Figure&nbsp;<span>3.49</span></a>).</p>
<div class="cell page-columns page-full" data-layout-align="center">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"ggbio"</span>)</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"hg19IdeogramCyto"</span>, <span class="at">package =</span> <span class="st">"biovizBase"</span>)</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plotIdeogram</span>(hg19IdeogramCyto, <span class="at">subchr =</span> <span class="st">"chr1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

<div class="no-row-height column-margin column-container"><div class="cell-output-display">
<div id="fig-graphics-ideogram-1" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-graphics-ideogram-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="03-chap_files/figure-html/fig-graphics-ideogram-1-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-61" title="Figure&nbsp;3.48: Chromosome 1 of the human genome: ideogram plot."><img src="03-chap_files/figure-html/fig-graphics-ideogram-1-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="320"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-graphics-ideogram-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.48: Chromosome 1 of the human genome: ideogram plot.
</figcaption>
</figure>
</div>
</div></div></div>
<p>The <code>darned_hg19_subset500</code> lists a selection of 500 RNA editing sites in the human genome. It was obtained from the <em>Database of RNA editing in Flies, Mice and Humans</em> (DARNED, <a href="https://darned.ucc.ie/" class="uri">https://darned.ucc.ie/</a>). The result is shown in <a href="#fig-graphics-darned1" class="quarto-xref">Figure&nbsp;<span>3.49</span></a>.</p>
<div class="cell page-columns page-full" data-layout-align="center" data-warning.known="need valid seqlengths information for accurate mapping">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"GenomicRanges"</span>)</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"darned_hg19_subset500"</span>, <span class="at">package =</span> <span class="st">"biovizBase"</span>)</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(darned_hg19_subset500, <span class="at">layout =</span> <span class="st">"karyogram"</span>,</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>         <span class="fu">aes</span>(<span class="at">color =</span> exReg, <span class="at">fill =</span> exReg))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

<div class="no-row-height column-margin column-container"><div class="cell-output-display">
<div id="fig-graphics-darned1" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-graphics-darned1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="03-chap_files/figure-html/fig-graphics-darned1-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-62" title="Figure&nbsp;3.49: Karyogram with RNA editing sites. exReg indicates whether a site is in the coding region (C), 3’- or 5’-UTR."><img src="03-chap_files/figure-html/fig-graphics-darned1-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="320"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-graphics-darned1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.49: Karyogram with RNA editing sites. <code>exReg</code> indicates whether a site is in the coding region (C), 3’- or 5’-UTR.
</figcaption>
</figure>
</div>
</div></div></div>
<div id="wrn-graphics-chroder" class="callout callout-style-default callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Question&nbsp;3.11
</div>
</div>
<div class="callout-body-container callout-body">
<p>How do you fix the ordering of the chromosomes in <a href="#fig-graphics-darned1" class="quarto-xref">Figure&nbsp;<span>3.49</span></a> and get rid of the warning about chromosome lengths?</p>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-19-contents" aria-controls="callout-19" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-19" class="callout-19-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The information on chromosome lengths in the hg19 assembly of the human genome is (for instance) stored in the <code>ideoCyto</code> dataset. We use the function <code>keepSeqlevels</code> to reorder the chromosomes. See <a href="#fig-graphics-darned2" class="quarto-xref">Figure&nbsp;<span>3.50</span></a>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"ideoCyto"</span>, <span class="at">package =</span> <span class="st">"biovizBase"</span>)</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>dn <span class="ot">=</span> darned_hg19_subset500</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a><span class="fu">seqlengths</span>(dn) <span class="ot">=</span> <span class="fu">seqlengths</span>(ideoCyto<span class="sc">$</span>hg19)[<span class="fu">names</span>(<span class="fu">seqlengths</span>(dn))]</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>dn <span class="ot">=</span> <span class="fu">keepSeqlevels</span>(dn, <span class="fu">paste0</span>(<span class="st">"chr"</span>, <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">22</span>, <span class="st">"X"</span>)))</span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(dn, <span class="at">layout =</span> <span class="st">"karyogram"</span>, <span class="fu">aes</span>(<span class="at">color =</span> exReg, <span class="at">fill =</span> exReg))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-graphics-darned2" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-graphics-darned2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="03-chap_files/figure-html/fig-graphics-darned2-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-63" title="Figure&nbsp;3.50: Improved version of Figure&nbsp;fig-graphics-darned1."><img src="03-chap_files/figure-html/fig-graphics-darned2-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:50.0%"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-graphics-darned2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.50: Improved version of <a href="#fig-graphics-darned1" class="quarto-xref">Figure&nbsp;<span>3.49</span></a>.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="wrn-graphics-darned" class="callout callout-style-default callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Question&nbsp;3.12
</div>
</div>
<div class="callout-body-container callout-body">
<p>What type of object is <code>darned_hg19_subset500</code>?</p>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-21-contents" aria-controls="callout-21" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-21" class="callout-21-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>darned_hg19_subset500[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>GRanges object with 2 ranges and 10 metadata columns:
      seqnames    ranges strand |       inchr       inrna         snp
         &lt;Rle&gt; &lt;IRanges&gt;  &lt;Rle&gt; | &lt;character&gt; &lt;character&gt; &lt;character&gt;
  [1]     chr5  86618225      - |           A           I        &lt;NA&gt;
  [2]     chr7  99792382      - |           A           I        &lt;NA&gt;
             gene      seqReg       exReg      source      ests      esta
      &lt;character&gt; &lt;character&gt; &lt;character&gt; &lt;character&gt; &lt;integer&gt; &lt;integer&gt;
  [1]        &lt;NA&gt;           O        &lt;NA&gt;    amygdala         0         0
  [2]        &lt;NA&gt;           O        &lt;NA&gt;        &lt;NA&gt;         0         0
           author
      &lt;character&gt;
  [1]    15342557
  [2]    15342557
  -------
  seqinfo: 23 sequences from an unspecified genome; no seqlengths</code></pre>
</div>
</div>
<p>It is a <em>GRanges</em> object, that is, a specialized class from the Bioconductor project for storing data that are associated with genomic coordinates. The first three columns are obligatory: <code>seqnames</code>, the name of the containing biopolymer (in our case, these are names of human chromosomes), <code>ranges</code>, the genomic coordinates of the intervals (in this case, the intervals all have length 1, as they each refer to a single nucleotide), and the DNA <code>strand</code> from which the RNA is transcribed. You can find out more on how to use this class and its associated infrastructure in the documentation, e.g., the vignette of the <strong><a href="https://bioconductor.org/packages/GenomicRanges/">GenomicRanges</a></strong> package. Learning it is worth the effort if you want to work with genome-associated datasets, as it allows for convenient, efficient and safe manipulation of these data and provides many powerful utilities.</p>
</div>
</div>
</div>
</section>
<section id="summary-of-this-chapter" class="level2" data-number="3.14">
<h2 data-number="3.14" class="anchored" data-anchor-id="summary-of-this-chapter"><span class="header-section-number">3.14</span> Summary of this chapter</h2>
<p>Visualizing data, either “raw” or along the various steps of processing, summarization and inference, is one of the most important activities in applied statistics, and indeed, in science. It sometimes gets short shrift in textbooks since there is not much deductive theory. However, there is a large number of good (and bad) practices, and once you pay attention to it, you will quickly see whether a certain graphic is effective in conveying its message, or what choices you could make to create powerful and aesthetically attrative data visualizations. Among the important options are the plot type (what is called a <code>geom</code> in <strong><a href="https://cran.r-project.org/web/packages/ggplot2/">ggplot2</a></strong>), proportions (incl.&nbsp;aspect ratios) and colors. The <em>grammar of graphics</em> is a powerful set of concepts to reason about graphics and to communicate our intentions for a data visualization to a computer.</p>
<p>Avoid <em>laziness</em>—just using the software’s defaults without thinking about the options—, and avoid <em>getting carried away</em>—adding lots of visual candy that just clutters up the plot but has no real message. Creating your own visualizations is in many ways like good writing. It is extremely important to get your message across (in talks, in papers), but there is no simple recipe for it. Look carefully at lots of visualizations made by others, experiment with making your own visualizations to learn the ropes, and then decide what is your style.</p>
</section>
<section id="further-reading" class="level2" data-number="3.15">
<h2 data-number="3.15" class="anchored" data-anchor-id="further-reading"><span class="header-section-number">3.15</span> Further reading</h2>
<p>The most useful resources about <strong><a href="https://cran.r-project.org/web/packages/ggplot2/">ggplot2</a></strong> are the second edition of <span class="citation" data-cites="ggplot2">Wickham (<a href="16-chap.html#ref-ggplot2" role="doc-biblioref">2016</a>)</span> and the <a href="https://ggplot2.tidyverse.org">ggplot2</a> website. There are many <strong><a href="https://cran.r-project.org/web/packages/ggplot2/">ggplot2</a></strong> code snippets online, which you will find through search engines after some practice. But be critical and check your sources: sometimes, code examples you find online refer to outdated versions of the package, and sometimes they are of poor quality.</p>
<p>The foundation of the system is based on <span class="citation" data-cites="GrofGrbook">Wilkinson (<a href="16-chap.html#ref-GrofGrbook" role="doc-biblioref">2005</a>)</span> and the ideas by <span class="citation" data-cites="Tukey77 Tukey:1988">Tukey (<a href="16-chap.html#ref-Tukey77" role="doc-biblioref">1977</a>; <a href="16-chap.html#ref-Tukey:1988" role="doc-biblioref">William S. Cleveland 1988</a>)</span>.</p>
</section>
<section id="exercises" class="level2 page-columns page-full" data-number="3.16">
<h2 data-number="3.16" class="anchored" data-anchor-id="exercises"><span class="header-section-number">3.16</span> Exercises</h2>
<div id="imp-graphics-themes" class="callout callout-style-default callout-important no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise&nbsp;3.1
</div>
</div>
<div class="callout-body-container callout-body">
<p>Use <em>themes</em> to change the visual appearance of your plots. Start by running the following example:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>ggcars <span class="ot">=</span> <span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(<span class="at">x =</span> hp, <span class="at">y =</span> mpg)) <span class="sc">+</span> <span class="fu">geom_point</span>()</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>ggcars</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>ggcars <span class="sc">+</span> <span class="fu">theme_bw</span>()</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>ggcars <span class="sc">+</span> <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>What other themes are there? (Hint: have a look at the section for themes in the <a href="https://ggplot2.tidyverse.org/reference">online documentation of ggplot2</a>.) Are these all the themes? (Hint: have a look at the <strong><a href="https://cran.r-project.org/web/packages/ggthemes/">ggthemes</a></strong> package.) Make a version of the above plot in the style of the <em>Economist</em> magazine. Add a smoothing line</p>
</div>
</div>
<div id="imp-graphics-colornames" class="callout callout-style-default callout-important no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise&nbsp;3.2
</div>
</div>
<div class="callout-body-container callout-body">
<p>What are admissible <em>color names</em> in base R? Have a look at the manual page of the <code>colors</code> function. Ryun the examples and the demo.</p>
<p>Use an internet search engine to search for “R color names” and explore some of the resources that come up, e.g., cheat sheets with all the colors diplayed.</p>
<p>Produce a version of the heatmap in <a href="#fig-graphics-heatmap" class="quarto-xref">Figure&nbsp;<span>3.41</span></a> that uses a color palette from the <a href="https://github.com/dill/beyonce">R package <strong>beyonce</strong></a>.</p>
</div>
</div>
<div id="imp-graphics-xkcd" class="callout callout-style-default callout-important no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise&nbsp;3.3
</div>
</div>
<div class="callout-body-container callout-body">
<p>Create plots in the style of the <a href="https://xkcd.com">xkcd</a> webcomic. Have a look at</p>
<div class="cell" data-layout-align="center">

</div>
<ul>
<li><p>a thread on Stackoverflow titled <a href="https://stackoverflow.com/questions/12675147/how-can-we-make-xkcd-style-graphs">How can we make xkcd style graphs?</a></p></li>
<li><p>the R source code of this book for the code that produces the chapter’s opening figure,</p></li>
<li><p>the vignette of the <strong><a href="https://cran.r-project.org/web/packages/xkcd/">xkcd</a></strong> package.</p></li>
</ul>
</div>
</div>
<div class="no-row-height column-margin column-container"><div class="cell-output-display callout-margin-content">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="imgs/xkcdgraph.png" class="lightbox" data-gallery="quarto-lightbox-gallery-64"><img src="imgs/xkcdgraph.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></a></p>
</figure>
</div>
</div></div><div id="imp-graphics-shiny" class="callout callout-style-default callout-important no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise&nbsp;3.4
</div>
</div>
<div class="callout-body-container callout-body">
<p>Check out the <strong><a href="https://cran.r-project.org/web/packages/shiny/">shiny</a></strong> tutorials on the RStudio website. Write a <em>shiny app</em> that displays one of the plots from this chapter, but with interactive elements to control, e.g., which genes are displayed (Figures <a href="#fig-graphics-facet1" class="quarto-xref"><span>3.33</span></a>—<a href="#fig-graphics-facet3" class="quarto-xref"><span>3.35</span></a>).</p>
</div>
</div>
<div id="imp-graphics-serialization" class="callout callout-style-default callout-important no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise&nbsp;3.5
</div>
</div>
<div class="callout-body-container callout-body">
<p>What options are there for <em>serializing</em> a graphic, i.e., for storing a graphic in a file that you can save for later use, or load up in another software? How can you serialize interactive graphics?</p>
</div>
</div>
<div id="imp-graphics-comirnaty" class="callout callout-style-default callout-important no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise&nbsp;3.6
</div>
</div>
<div class="callout-body-container callout-body">
<p>Important and well done graphics do not have to be complex. For instance, check out Figure 9 (page 82) of the <a href="extras/comirnaty-epar-public-assessment-report_en.pdf">public assessment report by the European Medicines Agency on Comirnaty</a><a href="#fn21" class="footnote-ref" id="fnref21" role="doc-noteref"><sup>21</sup></a> and <a href="https://xkcd.com/2400/">XKCD 2400</a>.</p>
</div>
</div>


<div class="no-row-height column-margin column-container"><div id="fn21"><p><sup>21</sup>&nbsp;You can also get this from <a href="https://www.ema.europa.eu/en/medicines/human/EPAR/comirnaty" class="uri">https://www.ema.europa.eu/en/medicines/human/EPAR/comirnaty</a>.</p></div></div><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-Carr1987hexbin" class="csl-entry" role="listitem">
Carr, Daniel B, Richard J Littlefield, WL Nicholson, and JS Littlefield. 1987. <span>“Scatterplot Matrix Techniques for Large <span>N</span>.”</span> <em>Journal of the American Statistical Association</em> 82 (398): 424–36.
</div>
<div id="ref-Tukey:1988" class="csl-entry" role="listitem">
Cleveland, William S. 1988. <em>The Collected Works of John w. Tukey: Graphics 1965-1985</em>. Vol. 5. CRC Press.
</div>
<div id="ref-Cleveland:1988:Banking" class="csl-entry" role="listitem">
Cleveland, William S., Marylyn E. McGill, and Robert McGill. 1988. <span>“The Shape Parameter of a Two-Variable Graph.”</span> <em>Journal of the American Statistical Association</em> 83: 289–300.
</div>
<div id="ref-Helmholtz:1867" class="csl-entry" role="listitem">
Helmholtz, H. von. 1867. <em>Handbuch Der Physiologischen Optik</em>. Leipzig: Leopold Voss.
</div>
<div id="ref-IhakaColorPres" class="csl-entry" role="listitem">
Ihaka, Ross. 2003. <span>“Color for Presentation Graphics.”</span> In <em>Proceedings of the 3rd International Workshop on Distributed Statistical Computing</em>, edited by Kurt Hornik and Friedrich Leisch. Vienna, Austria: http://www.r-project.org/conferences/DSC-2003/Proceedings/; ISSN 1609-395X.
</div>
<div id="ref-Irizarry:Biostat:2003" class="csl-entry" role="listitem">
Irizarry, R. A., B. Hobbs, F. Collin, Y. D. Beazer-Barclay, K. J. Antonellis, U. Scherf, and T. P. Speed. 2003. <span>“Exploration, Normalization, and Summaries of High Density Oligonucleotide Array Probe Level Data.”</span> <em>Biostatistics</em> 4 (2): 249–64.
</div>
<div id="ref-Lawrence:Nature:2013" class="csl-entry" role="listitem">
Lawrence, Michael S., Petar Stojanov, Paz Polak, Gregory V. Kryukov, Kristian Cibulskis, Andrey Sivachenko, Scott L. Carter, et al. 2013. <span>“Mutational Heterogeneity in Cancer and the Search for New Cancer-Associated Genes.”</span> <em>Nature</em> 499 (7457): 214–18. <a href="https://doi.org/10.1038/nature12213">https://doi.org/10.1038/nature12213</a>.
</div>
<div id="ref-McCormick:1972:MatrixClustering" class="csl-entry" role="listitem">
McCormick Jr, William T, Paul J Schweitzer, and Thomas W White. 1972. <span>“Problem Decomposition and Data Reorganization by a Clustering Technique.”</span> <em>Operations Research</em> 20 (5): 993–1009.
</div>
<div id="ref-Mollon:1995" class="csl-entry" role="listitem">
Mollon, John. 1995. <span>“Seeing Colour.”</span> In <em>Colour: Art and Science</em>, edited by T. Lamb and J. Bourriau. Cambridge Unversity Press.
</div>
<div id="ref-Ohnishi2014" class="csl-entry" role="listitem">
Ohnishi, Y., W. Huber, A. Tsumura, M. Kang, P. Xenopoulos, K. Kurimoto, A. K. Oles, et al. 2014. <span>“Cell-to-Cell Expression Variability Followed by Signal Reinforcement Progressively Segregates Early Mouse Lineages.”</span> <em>Nature Cell Biology</em> 16 (1): 27–37.
</div>
<div id="ref-Tukey77" class="csl-entry" role="listitem">
Tukey, John W. 1977. <span>“Exploratory Data Analysis.”</span> <em>Massachusetts: Addison-Wesley</em>.
</div>
<div id="ref-Wickham:LayeredGrammar" class="csl-entry" role="listitem">
Wickham, Hadley. 2010. <span>“A Layered Grammar of Graphics.”</span> <em>Journal of Computational and Graphical Statistics</em> 19 (1): 3–28.
</div>
<div id="ref-ggplot2" class="csl-entry" role="listitem">
———. 2016. <em>Ggplot2: Elegant Graphics for Data Analysis</em>. Springer New York. <a href="http://had.co.nz/ggplot2/book">http://had.co.nz/ggplot2/book</a>.
</div>
<div id="ref-Wilkinson:DotPlots:1999" class="csl-entry" role="listitem">
Wilkinson, Leland. 1999. <span>“Dot Plots.”</span> <em>The American Statistician</em> 53 (3): 276.
</div>
<div id="ref-GrofGrbook" class="csl-entry" role="listitem">
———. 2005. <em>The Grammar of Graphics</em>. Springer.
</div>
</div>
</section>


<p>Page built at 01:33 on 2025-09-01 using R version 4.5.1 (2025-06-13)</p></main> <!-- /main --></p><p class="build-date">
Support for maintaining the online version of this book is provided by <a href="http://www.denbi.de">de.NBI</a>
  <img src="imgs/denbi.png" style="vertical-align: text-top;height: 16px"><br>
For website support please contact msmith@embl.de
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
  const anchorJS_eq = new window.AnchorJS();
  anchorJS_eq.options = {
    placement: 'left',
    class: 'eq-link',
    icon: icon
  };
  anchorJS_eq.add('.anchored-eq');
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/www\.huber\.embl\.de\/msmb");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->
<script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","descPosition":"bottom","loop":false,"openEffect":"zoom","selector":".lightbox"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script>




</body></html>
