<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.31">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>7&nbsp; Multivariate Analysis – Modern Statistics for Modern Biology</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./imgs/msmb-favicon.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-af5ec82acda093b5ee751184164e9432.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-d63985d606c7f07261ad561a6cfde940.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="msmb.css">
<meta property="og:title" content="7&nbsp; Multivariate Analysis – Modern Statistics for Modern Biology">
<meta property="og:description" content="If you are a biologist and want to get the best out of the powerful methods of modern computational statistics, this is your book.">
<meta property="og:image" content="https://www.huber.embl.de/msmb/imgs/MSFMB-Cover2-cropped.jpg">
<meta property="og:site_name" content="Modern Statistics for Modern Biology">
<meta name="twitter:title" content="7&nbsp; Multivariate Analysis – Modern Statistics for Modern Biology">
<meta name="twitter:description" content="If you are a biologist and want to get the best out of the powerful methods of modern computational statistics, this is your book.">
<meta name="twitter:image" content="https://www.huber.embl.de/msmb/imgs/MSFMB-Cover2-cropped.jpg">
<meta name="twitter:card" content="summary">
<script type="text/javascript">
  var _paq = _paq || [];
  
  // Call disableCookies before calling trackPageView 
  _paq.push(['disableCookies']);
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u='//tr-denbi.embl.de/heimdall/';
    _paq.push(['setTrackerUrl', u+'p.php']);
    _paq.push(['setSiteId', '26']);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'p.js'; s.parentNode.insertBefore(g,s);
  })();
</script>

</head>

<body class="floating nav-fixed slimcontent quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Modern Statistics for Modern Biology</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-chapters" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Chapters</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-chapters">    
        <li>
    <a class="dropdown-item" href="./index.html">
 <span class="dropdown-text">Home</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./00-chap.html">
 <span class="dropdown-text">Introduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./01-chap.html">
 <span class="dropdown-text">Generative Models for Discrete Data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./02-chap.html">
 <span class="dropdown-text">Statistical Modeling</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03-chap.html">
 <span class="dropdown-text">Data visualization</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./04-chap.html">
 <span class="dropdown-text">Mixture Models</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./05-chap.html">
 <span class="dropdown-text">Clustering</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./06-chap.html">
 <span class="dropdown-text">Testing</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./07-chap.html">
 <span class="dropdown-text">Multivariate Analysis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./08-chap.html">
 <span class="dropdown-text">High-Throughput Count Data &amp; Generalized Linear Models</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./09-chap.html">
 <span class="dropdown-text">Multivariate methods for heterogeneous data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./10-chap.html">
 <span class="dropdown-text">Networks and Trees</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./11-chap.html">
 <span class="dropdown-text">Image data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./12-chap.html">
 <span class="dropdown-text">Supervised Learning</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./13-chap.html">
 <span class="dropdown-text">Design of High Throughput Experiments and their Analyses</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./14-chap.html">
 <span class="dropdown-text">Statistical Concordance</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./15-chap.html">
 <span class="dropdown-text">Acknowledgements</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./16-chap.html">
 <span class="dropdown-text">References</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Sections</h2>
   
  <ul class="collapse">
  <li><a href="#goals-for-this-chapter" id="toc-goals-for-this-chapter" class="nav-link active" data-scroll-target="#goals-for-this-chapter"><span class="header-section-number">7.1</span> Goals for this chapter</a></li>
  <li><a href="#what-are-the-data-matrices-and-their-motivation" id="toc-what-are-the-data-matrices-and-their-motivation" class="nav-link" data-scroll-target="#what-are-the-data-matrices-and-their-motivation"><span class="header-section-number">7.2</span> What are the data? Matrices and their motivation</a></li>
  <li><a href="#dimension-reduction" id="toc-dimension-reduction" class="nav-link" data-scroll-target="#dimension-reduction"><span class="header-section-number">7.3</span> Dimension reduction</a></li>
  <li><a href="#the-new-linear-combinations" id="toc-the-new-linear-combinations" class="nav-link" data-scroll-target="#the-new-linear-combinations"><span class="header-section-number">7.4</span> The new linear combinations</a></li>
  <li><a href="#the-pca-workflow" id="toc-the-pca-workflow" class="nav-link" data-scroll-target="#the-pca-workflow"><span class="header-section-number">7.5</span> The PCA workflow</a></li>
  <li><a href="#the-inner-workings-of-pca-rank-reduction" id="toc-the-inner-workings-of-pca-rank-reduction" class="nav-link" data-scroll-target="#the-inner-workings-of-pca-rank-reduction"><span class="header-section-number">7.6</span> The inner workings of PCA: rank reduction</a></li>
  <li><a href="#plotting-the-observations-in-the-principal-plane" id="toc-plotting-the-observations-in-the-principal-plane" class="nav-link" data-scroll-target="#plotting-the-observations-in-the-principal-plane"><span class="header-section-number">7.7</span> Plotting the observations in the principal plane</a></li>
  <li><a href="#pca-as-an-exploratory-tool-using-extra-information" id="toc-pca-as-an-exploratory-tool-using-extra-information" class="nav-link" data-scroll-target="#pca-as-an-exploratory-tool-using-extra-information"><span class="header-section-number">7.8</span> PCA as an exploratory tool: using extra information</a></li>
  <li><a href="#summary-of-this-chapter" id="toc-summary-of-this-chapter" class="nav-link" data-scroll-target="#summary-of-this-chapter"><span class="header-section-number">7.9</span> Summary of this chapter</a></li>
  <li><a href="#further-reading" id="toc-further-reading" class="nav-link" data-scroll-target="#further-reading"><span class="header-section-number">7.10</span> Further reading</a></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises"><span class="header-section-number">7.11</span> Exercises</a></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-multivariate" class="quarto-section-identifier"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Multivariate Analysis</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="cell page-columns page-full" data-layout-align="center">

<div class="no-row-height column-margin column-container"><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="imgs/TheMatrix.jpg" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img src="imgs/TheMatrix.jpg" class="img-fluid quarto-figure quarto-figure-center figure-img"></a></p>
</figure>
</div>
</div></div></div>
<p>Many datasets consist of several variables measured on the same set of subjects: patients, samples, or organisms. For instance, we may have biometric characteristics such as height, weight, age as well as clinical variables such as blood pressure, blood sugar, heart rate, and genetic data for, say, a thousand patients. The <em>raison d’être</em> for multivariate analysis is the investigation of connections or associations between the different variables measured. Usually the data are reported in a tabular data structure with one row for each subject and one column for each variable. In the following, we will focus on the special case where each of the variables is numeric, so we can represent the data structure as a <em>matrix</em> in R.</p>
<p>If the columns of the matrix are all independent of each other (unrelated), we can simply study each column separately and do standard “univariate” statistics on them one by one; there would be no benefit in studying them as a matrix.</p>
<p>More often, there will be patterns and dependencies. For instance, in the biology of cells, we know that the proliferation rate will influence the expression of many genes simultaneously. Studying the expression of 25,000 gene (columns) on many samples (rows) of patient-derived cells, we notice that many of the genes act together, either that they are positively correlated or that they are anti-correlated. We would miss a lot of important information if we were to only study each gene separately. Important connections between genes are detectable only if we consider the data as a whole: each row representing the many measurements made on the same observational unit. However, having 25,000 dimensions of variation to consider at once is daunting; we will show how to reduce our data to a smaller number of most important dimensions<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> without losing too much information.</p>
<div class="no-row-height column-margin column-container"><div id="fn1"><p><sup>1</sup>&nbsp;We will elaborate this idea of dimension reduction in much more detail below. For the time being, remember we live in a four-dimensional world.</p></div></div><p>This chapter presents many examples of multivariate data matrices that we encounter in high-throughput experiments, as well as some more elementary examples that we hope will enhance your intuition. We will focus in this chapter on <strong>P</strong>rincipal <strong>C</strong>omponent <strong>A</strong>nalysis, abbreviated as <strong>PCA</strong>, a <strong>dimension reduction</strong> method. We will provide geometric explanations of the algorithm as well as visualizations that help interprete the output of PCA analyses.</p>
<section id="goals-for-this-chapter" class="level2" data-number="7.1">
<h2 data-number="7.1" class="anchored" data-anchor-id="goals-for-this-chapter"><span class="header-section-number">7.1</span> Goals for this chapter</h2>
<p>In this chapter we will:</p>
<ul>
<li><p>See examples of matrices that come up in the study of biological data.</p></li>
<li><p>Perform dimension reduction to understand correlations between variables.</p></li>
<li><p>Preprocess, rescale and center the data before starting a multivariate analysis.</p></li>
<li><p>Build new variables, called principal components (PC), that are more useful than the original measurements.</p></li>
<li><p>See what is “under the hood” of PCA: the singular value decomposition of a matrix.</p></li>
<li><p>Visualize what this decomposition achieves and learn how to choose the number of principal components.</p></li>
<li><p>Run through a complete PCA analysis from start to finish.</p></li>
<li><p>Project factor covariates onto the PCA map to enable a more useful interpretation of the results.</p></li>
</ul>
</section>
<section id="what-are-the-data-matrices-and-their-motivation" class="level2 page-columns page-full" data-number="7.2">
<h2 data-number="7.2" class="anchored" data-anchor-id="what-are-the-data-matrices-and-their-motivation"><span class="header-section-number">7.2</span> What are the data? Matrices and their motivation</h2>
<p>First, let’s look at a set of examples of rectangular <strong>matrices</strong> used to represent tables of measurements. In each matrix, the rows and columns represent specific entities.</p>
<p><strong>Turtles:</strong> A simple data set that will help us understand the basic principles is a matrix of three dimensions of biometric measurements on painted turtles <span class="citation" data-cites="Jolicoeur1960">(<a href="16-chap.html#ref-Jolicoeur1960" role="doc-biblioref">Jolicoeur and Mosimann 1960</a>)</span>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>turtles <span class="ot">=</span> <span class="fu">read.table</span>(<span class="st">"../data/PaintedTurtles.txt"</span>, <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>turtles[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  sex length width height
1   f     98    81     38
2   f    103    84     38
3   f    103    86     42
4   f    105    86     40</code></pre>
</div>
</div>
<p>The last three columns are length measurements (in millimetres), whereas the first column is a factor variable that tells us the sex of each animal.</p>
<p><strong>Athletes:</strong> This matrix is an interesting example from the sports world. It reports the performances for 33 athletes in the ten disciplines of the decathlon: <code>m100</code>, <code>m400</code> and <code>m1500</code> are times in seconds for the 100 meters, 400 meters, and 1500 meters respectively; <code>m110</code> is the time to finish the 110 meters hurdles; <code>pole</code> is the pole-vault height, and <code>high</code> and <code>long</code> are the results of the high and long jumps, all in meters; <code>weight</code>, <code>disc</code>, and <code>javel</code> are the lengths in meters the athletes were able to throw the weight, discus and javelin. Here are these variables for the first three athletes:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"olympic"</span>, <span class="at">package =</span> <span class="st">"ade4"</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>athletes <span class="ot">=</span> <span class="fu">setNames</span>(olympic<span class="sc">$</span>tab, </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"m100"</span>, <span class="st">"long"</span>, <span class="st">"weight"</span>, <span class="st">"high"</span>, <span class="st">"m400"</span>, <span class="st">"m110"</span>, <span class="st">"disc"</span>, <span class="st">"pole"</span>, <span class="st">"javel"</span>, <span class="st">"m1500"</span>))</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>athletes[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   m100 long weight high  m400  m110  disc pole javel  m1500
1 11.25 7.43  15.48 2.27 48.90 15.13 49.28  4.7 61.32 268.95
2 10.87 7.45  14.97 1.97 47.71 14.46 44.36  5.1 61.76 273.02
3 11.18 7.44  14.20 1.97 48.29 14.81 43.66  5.2 64.16 263.20</code></pre>
</div>
</div>
<p><strong>Cell Types:</strong> <span class="citation" data-cites="holmes2005memory">Holmes et al. (<a href="16-chap.html#ref-holmes2005memory" role="doc-biblioref">2005</a>)</span> studied gene expression profiles of sorted T-cell populations from different subjects. The columns are a subset of gene expression measurements, they correspond to 156 genes that show differential expression between cell types.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"../data/Msig3transp.RData"</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(Msig3transp,<span class="dv">2</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             X3968 X14831 X13492 X5108 X16348  X585
HEA26_EFFE_1 -2.61  -1.19  -0.06 -0.15   0.52 -0.02
HEA26_MEM_1  -2.26  -0.47   0.28  0.54  -0.37  0.11
HEA26_NAI_1  -0.27   0.82   0.81  0.72  -0.90  0.75
MEL36_EFFE_1 -2.24  -1.08  -0.24 -0.18   0.64  0.01
MEL36_MEM_1  -2.68  -0.15   0.25  0.95  -0.20  0.17</code></pre>
</div>
</div>
<p><strong>Bacterial Species Abundances:</strong> Matrices of counts are used in microbial ecology studies (as we saw in <a href="04-chap.html" class="quarto-xref"><span>Chapter 4</span></a>). Here the columns represent different species (or operational taxonomic units, OTUs) of bacteria, which are identified by numerical tags. The rows are labeled according to the samples in which they were measured, and the (integer) numbers represent the number of times of each of the OTUs was observed in each of the samples.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"GlobalPatterns"</span>, <span class="at">package =</span> <span class="st">"phyloseq"</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>GPOTUs <span class="ot">=</span> <span class="fu">as.matrix</span>(<span class="fu">t</span>(phyloseq<span class="sc">::</span><span class="fu">otu_table</span>(GlobalPatterns)))</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>GPOTUs[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="dv">6</span><span class="sc">:</span><span class="dv">13</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>OTU Table:          [4 taxa and 8 samples]
                     taxa are rows
        246140 143239 244960 255340 144887 141782 215972 31759
CL3          0      7      0    153      3      9      0     0
CC1          0      1      0    194      5     35      3     1
SV1          0      0      0      0      0      0      0     0
M31Fcsw      0      0      0      0      0      0      0     0</code></pre>
</div>
</div>
<div class="cell page-columns page-full" data-layout-align="center">

<div class="no-row-height column-margin column-container"><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="imgs/devil.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2" title="Notice the propensity of the matrix entries to be zero; we call such data sparse."><img src="imgs/devil.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="123" alt="Notice the propensity of the matrix entries to be zero; we call such data sparse."></a></p>
</figure>
</div>
<figcaption>Notice the propensity of the matrix entries to be zero; we call such data <strong>sparse</strong>.</figcaption>
</figure>
</div>
</div></div></div>
<p><strong>mRNA reads:</strong> RNA-Seq transcriptome data report the number of sequence reads matching each gene<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> in each of several biological samples. We will study this type of data in detail in <a href="08-chap.html" class="quarto-xref"><span>Chapter 8</span></a></p>
<div class="no-row-height column-margin column-container"><div id="fn2"><p><sup>2</sup>&nbsp;Or sub-gene structures, such as exons.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"SummarizedExperiment"</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"airway"</span>, <span class="at">package =</span> <span class="st">"airway"</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">assay</span>(airway)[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                SRR1039508 SRR1039509 SRR1039512 SRR1039513
ENSG00000000003        679        448        873        408
ENSG00000000005          0          0          0          0
ENSG00000000419        467        515        621        365</code></pre>
</div>
</div>
<p>It is customary in the RNA-Seq field—and so it is for the <code>airway</code> data above—to report the genes in the rows and the samples in the columns. Compared to the other matrices we look at here, this is <em>transposed</em>: rows and columns are swapped. Such different conventions easily lead to errors, so they are worthwhile paying attention to<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>. <strong>Proteomic profiles:</strong> Here, the columns are aligned <strong>mass spectroscopy</strong> peaks or molecules identified through their <span class="math inline">\(m/z\)</span>-ratios; the entries in the matrix are the measured intensities<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a>.</p>
<div class="no-row-height column-margin column-container"><div id="fn3"><p><sup>3</sup>&nbsp;The Bioconductor project tries to help users and developers to avoid such ambiguities by defining data containers in which such conventions are explicitly fixed. In <a href="08-chap.html" class="quarto-xref"><span>Chapter 8</span></a>, we will see the example of the <em>SummarizedExperiment</em> class.</p></div><div id="fn4"><p><sup>4</sup>&nbsp;More details can be found, e.g., on <a href="https://en.wikipedia.org/wiki/Mass_spectrum">Wikipedia</a>.</p></div></div><div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>metab <span class="ot">=</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(<span class="fu">read.csv</span>(<span class="st">"../data/metabolites.csv"</span>, <span class="at">row.names =</span> <span class="dv">1</span>)))</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>metab[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         146.0985388 148.7053275 310.1505057 132.4512963
KOGCHUM1    29932.36    17055.70     1132.82    785.5129
KOGCHUM2    94067.61    74631.69    28240.85   5232.0499
KOGCHUM3   146411.33   147788.71    64950.49  10283.0037
WTGCHUM1   229912.57   384932.56   220730.39  26115.2007</code></pre>
</div>
</div>
<div class="cell page-columns page-full" data-layout-align="center">

<div class="no-row-height column-margin column-container"><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="imgs/devil.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3" title="In many of the matrices we have seen here, important information about the samples (subjects) and the measured features is stored in the row or column names, often through some ad hoc string concatenation. This is not the best place to store all available information, and quickly becomes limiting and error-prone. A much better approach is the Bioconductor SummarizedExperiment class."><img src="imgs/devil.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="123" alt="In many of the matrices we have seen here, important information about the samples (subjects) and the measured features is stored in the row or column names, often through some ad hoc string concatenation. This is not the best place to store all available information, and quickly becomes limiting and error-prone. A much better approach is the Bioconductor SummarizedExperiment class."></a></p>
</figure>
</div>
<figcaption>In many of the matrices we have seen here, important information about the samples (subjects) and the measured features is stored in the row or column names, often through some ad hoc string concatenation. This is not the best place to store all available information, and quickly becomes limiting and error-prone. A much better approach is the Bioconductor <em>SummarizedExperiment</em> class.</figcaption>
</figure>
</div>
</div></div></div>
<div class="callout callout-style-default callout-tip no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Task
</div>
</div>
<div class="callout-body-container callout-body">
<p>When a peak was not detected for a particular <span class="math inline">\(m/z\)</span> score in the mass spectrometry run, a zero was recorded in <code>metab</code>. Similarly, zeros in <code>GPOTUs</code> or in the <code>airway</code> object occur when there were no matching sequence reads detected. Tabulate the frequencies of zeros in these data matrices.</p>
</div>
</div>
<div id="wrn-multivariate-namesvariables" class="callout callout-style-default callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Question&nbsp;7.1
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="a">
<li><p>What are the columns of these data matrices usually called?</p></li>
<li><p>In each of these examples, what are the rows of the matrix?</p></li>
<li><p>What does a cell in a matrix represent?</p></li>
<li><p>If the data matrix is called <code>athletes</code> and you want to see the value of the third variable for the fifth athlete, what do you type into R?</p></li>
</ol>
</div>
</div>
<section id="low-dimensional-data-summaries-and-preparation" class="level3 page-columns page-full" data-number="7.2.1">
<h3 data-number="7.2.1" class="anchored" data-anchor-id="low-dimensional-data-summaries-and-preparation"><span class="header-section-number">7.2.1</span> Low-dimensional data summaries and preparation</h3>
<div class="cell page-columns page-full" data-layout-align="center">
<div class="cell-output-display page-columns page-full">
<div id="fig-flatland" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full" data-cap-location="margin" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-flatland-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="imgs/flatland.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4" title="Figure&nbsp;7.1: xkcd: What do we mean by low-dimensional? We live in 3 dimensions, or 4 if you count time, a plane has 2 dimensions, a line has one dimension. A point is said to be zero-dimensional. For the amusing novel referenced in the cartoon see @Abbott:1884."><img src="imgs/flatland.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></a>
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-flatland-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7.1: xkcd: What do we mean by low-dimensional? We live in 3 dimensions, or 4 if you count time, a plane has 2 dimensions, a line has one dimension. A point is said to be zero-dimensional. For the amusing novel referenced in the cartoon see <span class="citation" data-cites="Abbott:1884">Abbott (<a href="16-chap.html#ref-Abbott:1884" role="doc-biblioref">1884</a>)</span>.
</figcaption>
</figure>
</div>
</div>
</div>
<p>If we are studying only one variable, i.e., just the third column of the turtles matrix<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a>, we say we are looking at one-dimensional data. Such a vector, say all the turtle weights, can be visualized by plots such as those that we saw in <a href="03-chap.html#sec-graphics-univar" class="quarto-xref"><span>Section 3.6</span></a>, e.g., a histogram. If we compute a one number summary, say mean or median, we have made a zero-dimensional summary of our one-dimensional data. This is already an example of dimension reduction.</p>
<div class="no-row-height column-margin column-container"><div id="fn5"><p><sup>5</sup>&nbsp;The third column of a matrix <span class="math inline">\(X\)</span> is denoted mathematically by <span class="math inline">\({\mathbf x}_{\cdot 3}\)</span> or accessed in R using <code>X[, 3]</code>.</p></div></div><p>In <a href="03-chap.html" class="quarto-xref"><span>Chapter 3</span></a> we studied two-dimensional scatterplots. We saw that if there are too many observations, it can be beneficial to group the data into (hexagonal) bins: these are <em>two-dimensional</em> histograms. When considering two variables (<span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span>) measured together on a set of observations, the <strong>correlation coefficient</strong> measures how the variables co-vary. This is a single number summary of two-dimensional data. Its formula involves the summaries <span class="math inline">\(\bar{x}\)</span> and <span class="math inline">\(\bar{y}\)</span>:</p>
<p><span class="anchored-eq" data-anchor-id="eq-corrcoeff" id="eq-corrcoeff"><span class="math display">\[
\hat{\rho}=
\frac{\sum_{i=1}^n (x_i-\bar{x})(y_i-\bar{y})}
{\sqrt{\sum_{i=1}^n (x_i-\bar{x})^2}
\sqrt{\sum_{j=1}^n (y_j-\bar{y})^2}}
\tag{7.1}\]</span></span></p>
<p>In R, we use the <code>cor</code> function to calculate its value. Applied to a matrix this function computes all the two way correlations between continuous variables. In <a href="09-chap.html" class="quarto-xref"><span>Chapter 9</span></a> we will see how to analyse multivariate categorical data.</p>
<div id="wrn-multivariate-corrturtles" class="callout callout-style-default callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Question&nbsp;7.2
</div>
</div>
<div class="callout-body-container callout-body">
<p>Compute the matrix of all correlations between the measurements from the turtles data. What do you notice ?</p>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>We take out the categorical variable and compute the matrix.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(turtles[, <span class="sc">-</span><span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          length     width    height
length 1.0000000 0.9783116 0.9646946
width  0.9783116 1.0000000 0.9605705
height 0.9646946 0.9605705 1.0000000</code></pre>
</div>
</div>
<p>We see that this square matrix is symmetric and the values are all close to 1. The diagonal values are always 1.</p>
</div>
</div>
</div>
<p>It is always beneficial to start a multidimensional analysis by checking these simple one-dimensional and two-dimensional summary statistics using visual displays such as those we look at in the next two questions.</p>
<div id="wrn-multivariate-ggallypairs" class="callout callout-style-default callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Question&nbsp;7.3
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="a">
<li>Produce all pairwise scatterplots, as well as the one-dimensional histograms on the diagonal, for the turtles data. Use the package <strong><a href="https://cran.r-project.org/web/packages/GGally/">GGally</a></strong>.<br>
</li>
<li>Guess the underlying or “true dimension” of these data?</li>
</ol>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-6-contents" aria-controls="callout-6" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-6" class="callout-6-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"ggplot2"</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"dplyr"</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"GGally"</span>)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggpairs</span>(turtles[, <span class="sc">-</span><span class="dv">1</span>], <span class="at">axisLabels =</span> <span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-turtlespairs" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-turtlespairs-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="07-chap_files/figure-html/fig-turtlespairs-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5" title="Figure&nbsp;7.2: All pairs of bivariate scatterplots for the three biometric measurements on painted turtles."><img src="07-chap_files/figure-html/fig-turtlespairs-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:50.0%"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-turtlespairs-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7.2: All pairs of bivariate scatterplots for the three biometric measurements on painted turtles.
</figcaption>
</figure>
</div>
</div>
</div>
<p>From <a href="#fig-turtlespairs" class="quarto-xref">Figure&nbsp;<span>7.2</span></a>, it looks like all three of the variables are highly correlated and mostly reflect the same “underlying” variable, which we might interpret as <em>the size</em> of the turtle.</p>
</div>
</div>
</div>
<div id="wrn-multivariate-pairsathletes" class="callout callout-style-default callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Question&nbsp;7.4
</div>
</div>
<div class="callout-body-container callout-body">
<p>Compute all pairwise correlations of the variables in the <code>athletes</code> data and display the matrix in a heatmap. What do you notice?</p>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-8-contents" aria-controls="callout-8" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-8" class="callout-8-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"pheatmap"</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pheatmap</span>(<span class="fu">cor</span>(athletes), <span class="at">cell.width =</span> <span class="dv">10</span>, <span class="at">cell.height =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-heatmapathletes" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-heatmapathletes-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="07-chap_files/figure-html/fig-heatmapathletes-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-6" title="Figure&nbsp;7.3: Heatmap of correlations between variables in the athletes data. Higher values are color coded red-orange. The hierarchical clustering shows a grouping of related disciplines."><img src="07-chap_files/figure-html/fig-heatmapathletes-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-heatmapathletes-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7.3: Heatmap of correlations between variables in the <code>athletes</code> data. Higher values are color coded red-orange. The hierarchical clustering shows a grouping of related disciplines.
</figcaption>
</figure>
</div>
</div>
</div>
<p><a href="#fig-heatmapathletes" class="quarto-xref">Figure&nbsp;<span>7.3</span></a> shows how the 10 variables cluster into groups: running, throwing and jumping.</p>
</div>
</div>
</div>
</section>
<section id="preprocessing-the-data" class="level3 page-columns page-full" data-number="7.2.2">
<h3 data-number="7.2.2" class="anchored" data-anchor-id="preprocessing-the-data"><span class="header-section-number">7.2.2</span> Preprocessing the data</h3>
<p>In many cases, different variables are measured in different units, so they have different baselines and different scales<a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a>. These are not directly comparable in their original form.</p>
<div class="no-row-height column-margin column-container"><div id="fn6"><p><sup>6</sup>&nbsp;Common measures of scale are the range and the standard deviation. For instance, the times for the 110 metres vary between 14.18 and 16.2, with a standard deviation of 0.51, whereas the times to complete the 1500 metres vary between 256.64 and 303.17, with a standard deviation of 13.66; more than an order of magnitude larger. Moreover, the <code>athletes</code> data also contain measurements in different units (seconds, metres), whose choice is arbitrary (lengths could also be recorded in centimetres or feet, times in milliseconds).</p></div></div><p>For PCA and many other methods, we therefore need to transform the numeric values to some common scale in order to make comparisons meaningful. <strong>Centering</strong> means subtracting the mean, so that the mean of the centered data is at the origin. <strong>Scaling</strong> or <strong>standardizing</strong> then means dividing by the standard deviation, so that the new standard deviation is <span class="anchored-eq" data-anchor-id="eq-corrcoeff" class="math inline">\(1\)</span>. In fact, we have already encountered these operations when computing the correlation coefficient (<a href="#eq-corrcoeff" class="quarto-xref">Equation&nbsp;<span>7.1</span></a>): the correlation coefficient is simply the vector product of the centered and scaled variables. To perform these operations, there is the R function <code>scale</code>, whose default behavior when given a matrix or a data frame is to make every column have a mean of zero and a standard deviation of <span class="math inline">\(1\)</span>.</p>
<div id="wrn-multivariate-onedims" class="callout callout-style-default callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Question&nbsp;7.5
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="a">
<li>Compute the means and standard deviations of the <code>turtle</code> data, then use the <code>scale</code> function to center and standardize the continuous variables. Call this <code>scaledTurtles</code>, then verify the new values for mean and standard deviation of <code>scaledTurtles</code>.<br>
</li>
<li>Make a scatterplot of the scaled and centered width and height variables of the turtle data and color the points by their sex.</li>
</ol>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-10-contents" aria-controls="callout-10" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-10" class="callout-10-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(turtles[,<span class="sc">-</span><span class="dv">1</span>], <span class="dv">2</span>, sd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   length     width    height 
20.481602 12.675838  8.392837 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(turtles[,<span class="sc">-</span><span class="dv">1</span>], <span class="dv">2</span>, mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   length     width    height 
124.68750  95.43750  46.33333 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>scaledTurtles <span class="ot">=</span> <span class="fu">scale</span>(turtles[, <span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(scaledTurtles, <span class="dv">2</span>, mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       length         width        height 
-1.432050e-18  1.940383e-17 -2.870967e-16 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(scaledTurtles, <span class="dv">2</span>, sd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>length  width height 
     1      1      1 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(scaledTurtles, <span class="at">sex =</span> turtles[, <span class="dv">1</span>]) <span class="sc">%&gt;%</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> width, <span class="at">y =</span> height, <span class="at">group =</span> sex)) <span class="sc">+</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> sex)) <span class="sc">+</span> <span class="fu">coord_fixed</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-turtlesDim12" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-turtlesDim12-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="07-chap_files/figure-html/fig-turtlesDim12-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-7" title="Figure&nbsp;7.4: Turtles data projected onto the plane defined by the width and height variables: each point colored according to sex."><img src="07-chap_files/figure-html/fig-turtlesDim12-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:50.0%"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-turtlesDim12-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7.4: Turtles data projected onto the plane defined by the <code>width</code> and <code>height</code> variables: each point colored according to <code>sex</code>.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
<p>We have already encountered other data transformation choices in Chapters <a href="04-chap.html" class="quarto-xref"><span>4</span></a> and <a href="05-chap.html" class="quarto-xref"><span>5</span></a>, where we used the <code>log</code> and <code>asinh</code> functions. The aim of these transformations is (usually) variance stabilization, i.e., to make the variances of replicate measurements of <em>one and the same variable</em> in different parts of its dynamic range more similar. In contrast, the standardizing transformation described above aims to make the scale (as measured by mean and standard deviation) of <em>different variables</em> the same.</p>
<p>Sometimes it is preferable to leave variables at different scales because they are truly of different importance. If their original scale is relevant, then we can (should) leave the data as is. In other cases, the variables have different precisions known a priori. We will see in <a href="09-chap.html" class="quarto-xref"><span>Chapter 9</span></a> that there are several ways of weighting such variables.</p>
<p>After preprocessing the data, we are ready to undertake data <em>simplification</em> through <strong>dimension reduction</strong>.</p>
<div class="cell page-columns page-full" data-layout-align="center">

<div class="no-row-height column-margin column-container"><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="imgs/book_icon.png" class="lightbox" data-gallery="quarto-lightbox-gallery-8"><img src="imgs/book_icon.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="126"></a></p>
</figure>
</div>
</div></div></div>
<div class="page-columns page-full"><p></p><div class="no-row-height column-margin column-container"><span class="margin-aside">Useful books with relevant chapters are <span class="citation" data-cites="Flury">Flury (<a href="16-chap.html#ref-Flury" role="doc-biblioref">1997</a>)</span> for an introductory account and <span class="citation" data-cites="Mardia">Mardia, Kent, and Bibby (<a href="16-chap.html#ref-Mardia" role="doc-biblioref">1979</a>)</span> for a detailed mathematical approach.</span></div></div>
</section>
</section>
<section id="dimension-reduction" class="level2 page-columns page-full" data-number="7.3">
<h2 data-number="7.3" class="anchored" data-anchor-id="dimension-reduction"><span class="header-section-number">7.3</span> Dimension reduction</h2>
<p>We will explain dimension reduction from several different perspectives. It was invented in 1901 by Karl Pearson <span class="citation" data-cites="Pearson1901">(<a href="16-chap.html#ref-Pearson1901" role="doc-biblioref">Pearson 1901</a>)</span> as a way to reduce a two-variable scatterplot to a single coordinate. It was used by statisticians in the 1930s to summarize a battery of psychological tests run on the same subjects <span class="citation" data-cites="Hotelling:1933ki">(<a href="16-chap.html#ref-Hotelling:1933ki" role="doc-biblioref">Hotelling 1933</a>)</span>; thus providing overall scores that summarize many tested variables at once.</p>
<div class="cell page-columns page-full" data-layout-align="center">

<div class="no-row-height column-margin column-container"><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="imgs/devil.png" class="lightbox" data-gallery="quarto-lightbox-gallery-9" title="Principal and principle are two different words, which have different meanings. So please do not confuse them. With PCA, it is always principal."><img src="imgs/devil.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="123" alt="Principal and principle are two different words, which have different meanings. So please do not confuse them. With PCA, it is always principal."></a></p>
</figure>
</div>
<figcaption><em>Principal</em> and <em>principle</em> are two different words, which have different meanings. So please do not confuse them. With PCA, it is always <em>principal</em>.</figcaption>
</figure>
</div>
</div></div></div>
<p>This idea of <strong>principal</strong> scores inspired the name Principal Component Analysis (abbreviated PCA). PCA is called an <strong>unsupervised learning</strong> technique because, as in clustering, it treats all variables as having the same <strong>status</strong>. We are not trying to predict or explain one particular variable’s value from the others; rather, we are trying to find a mathematical model for an underlying structure for all the variables. PCA is primarily an exploratory technique that produces maps that show the relations between variables and between observations in a useful way.</p>
<p>We first provide a flavor of what this multivariate analysis does to the data. There is an elegant mathematical formulation of these methods through linear algebra, although here we will try to minimize its use and focus on visualization and data examples.</p>
<p>We use geometrical <strong>projections</strong> that take points in higher-dimensional spaces and projects them down onto lower dimensions. <a href="#fig-projectv" class="quarto-xref">Figure&nbsp;<span>7.5</span></a> shows the projection of the point <span class="math inline">\(A\)</span> onto the line generated by the vector <span class="math inline">\({\mathbf v}\)</span>.</p>
<div class="cell page-columns page-full" data-layout-align="center">

<div class="no-row-height column-margin column-container"><div class="cell-output-display">
<div id="fig-projectv" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-projectv-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="07-chap_files/figure-html/fig-projectv-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-10" title="Figure&nbsp;7.5: Point A is projected onto the red line generated by the vector v. The dashed projection line is perpendicular (or orthogonal) to the red line. The intersection point of the projection line and the red line is called the orthogonal projection of A onto the red line generated by the vector v."><img src="07-chap_files/figure-html/fig-projectv-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="240"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-projectv-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7.5: Point <span class="math inline">\(A\)</span> is projected onto the red line generated by the vector <span class="math inline">\(v\)</span>. The dashed projection line is perpendicular (or <strong>orthogonal</strong>) to the red line. The intersection point of the projection line and the red line is called the orthogonal projection of A onto the red line generated by the vector <span class="math inline">\(v\)</span>.
</figcaption>
</figure>
</div>
</div></div></div>
<p>PCA is a <strong>linear</strong> technique, meaning that we look for linear relations between variables and that we will use new variables that are linear functions of the original ones (<span class="math inline">\(f(ax+by)=af(x)+b(y)\)</span>). The linearity constraints makes computations particularly easy. We will see non-linear techniques in <a href="09-chap.html" class="quarto-xref"><span>Chapter 9</span></a>.</p>
<section id="lower-dimensional-projections" class="level3 page-columns page-full" data-number="7.3.1">
<h3 data-number="7.3.1" class="anchored" data-anchor-id="lower-dimensional-projections"><span class="header-section-number">7.3.1</span> Lower-dimensional projections</h3>
<p>Here we show one way of projecting two-dimensional data onto a line using the <code>athletes</code> data. The code below provides the preprocessing and plotting steps that were used to generate <a href="#fig-SimpleScatter" class="quarto-xref">Figure&nbsp;<span>7.6</span></a>:</p>
<div class="cell page-columns page-full" data-layout-align="center">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>athletes <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="fu">scale</span>(athletes))</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>ath_gg <span class="ot">=</span> <span class="fu">ggplot</span>(athletes, <span class="fu">aes</span>(<span class="at">x =</span> weight, <span class="at">y =</span> disc)) <span class="sc">+</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>, <span class="at">shape =</span> <span class="dv">21</span>)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>ath_gg <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="dv">0</span>), <span class="at">colour =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">xend =</span> weight, <span class="at">yend =</span> <span class="dv">0</span>), <span class="at">linetype =</span> <span class="st">"dashed"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

<div class="no-row-height column-margin column-container"><div class="cell-output-display">
<div id="fig-SimpleScatter" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-SimpleScatter-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="07-chap_files/figure-html/fig-SimpleScatter-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-11" title="Figure&nbsp;7.6: Scatterplot of two variables showing the projection on the horizontal x axis (defined by y=0) in red and the lines of projection appear as dashed."><img src="07-chap_files/figure-html/fig-SimpleScatter-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="240"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-SimpleScatter-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7.6: Scatterplot of two variables showing the projection on the horizontal x axis (defined by <span class="math inline">\(y=0\)</span>) in red and the lines of projection appear as dashed.
</figcaption>
</figure>
</div>
</div></div></div>
<div class="callout callout-style-default callout-tip no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Task
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="a">
<li>Calculate the variance of the red points in <a href="#fig-SimpleScatter" class="quarto-xref">Figure&nbsp;<span>7.6</span></a>.<br>
</li>
<li>Make a plot showing projection lines onto the <span class="math inline">\(y\)</span> axis and projected points.<br>
</li>
<li>Compute the variance of the points projected onto the vertical <span class="math inline">\(y\)</span> axis.</li>
</ol>
</div>
</div>
</section>
<section id="sec-multivariate-pcaline" class="level3 page-columns page-full" data-number="7.3.2">
<h3 data-number="7.3.2" class="anchored" data-anchor-id="sec-multivariate-pcaline"><span class="header-section-number">7.3.2</span> How do we summarize two-dimensional data by a line?</h3>
<p>In general, we lose information about the points when we project from two dimensions (a plane) to one (a line). If we do it just by using the original coordinates, as we did on the <code>weight</code> variable in <a href="#fig-SimpleScatter" class="quarto-xref">Figure&nbsp;<span>7.6</span></a>, we lose all the information about the <code>disc</code> variable. Our goal is to keep as much information as we can about <em>both</em> variables. There are actually many ways of projecting the point cloud onto a line. One is to use what are known as <strong>regression lines</strong>. Let’s look at these lines and how they are constructed in R.</p>
<section id="regressing-one-variable-on-the-other" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="regressing-one-variable-on-the-other">Regressing one variable on the other</h4>
<p>If you have seen linear regression, you already know how to compute lines that summarize scatterplots; <strong>linear regression</strong> is a <strong>supervised</strong> method that gives preference minimizing the residual sum of squares in one direction: that of the response variable.</p>
</section>
<section id="regression-of-the-disc-variable-on-weight." class="level4 unnumbered page-columns page-full">
<h4 class="unnumbered anchored" data-anchor-id="regression-of-the-disc-variable-on-weight.">Regression of the <code>disc</code> variable on <code>weight</code>.</h4>
<p>In <a href="#fig-Reg1" class="quarto-xref">Figure&nbsp;<span>7.7</span></a>, we use the <code>lm</code> (linear model) function to find the regression line. Its slope and intercept are given by the values in the <code>coefficients</code> slot of the resulting object <code>reg1</code>.</p>
<div class="cell page-columns page-full" data-layout-align="center">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>reg1 <span class="ot">=</span> <span class="fu">lm</span>(disc <span class="sc">~</span> weight, <span class="at">data =</span> athletes)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>a1 <span class="ot">=</span> reg1<span class="sc">$</span>coefficients[<span class="dv">1</span>] <span class="co"># intercept</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>b1 <span class="ot">=</span> reg1<span class="sc">$</span>coefficients[<span class="dv">2</span>] <span class="co"># slope</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>pline1 <span class="ot">=</span> ath_gg <span class="sc">+</span> <span class="fu">geom_abline</span>(<span class="at">intercept =</span> a1, <span class="at">slope =</span> b1,</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">linewidth =</span> <span class="fl">1.5</span>)</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>pline1 <span class="sc">+</span> <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">xend =</span> weight, <span class="at">yend =</span> reg1<span class="sc">$</span>fitted),</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">colour =</span> <span class="st">"red"</span>, <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.15</span>, <span class="st">"cm"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

<div class="no-row-height column-margin column-container"><div class="cell-output-display">
<div id="fig-Reg1" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-Reg1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="07-chap_files/figure-html/fig-Reg1-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-12" title="Figure&nbsp;7.7: The blue line minimizes the sum of squares of the vertical residuals (in red)."><img src="07-chap_files/figure-html/fig-Reg1-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="240"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-Reg1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7.7: The blue line minimizes the sum of squares of the vertical residuals (in red).
</figcaption>
</figure>
</div>
</div></div></div>
</section>
<section id="regression-of-weight-on-discus." class="level4 unnumbered page-columns page-full">
<h4 class="unnumbered anchored" data-anchor-id="regression-of-weight-on-discus.">Regression of <code>weight</code> on <code>discus</code>.</h4>
<p><a href="#fig-Reg2" class="quarto-xref">Figure&nbsp;<span>7.8</span></a> shows the line produced when reversing the roles of the two variables; <code>weight</code> becomes the response variable.</p>
<div class="cell page-columns page-full" data-layout-align="center">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>reg2 <span class="ot">=</span> <span class="fu">lm</span>(weight <span class="sc">~</span> disc, <span class="at">data =</span> athletes)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>a2 <span class="ot">=</span> reg2<span class="sc">$</span>coefficients[<span class="dv">1</span>] <span class="co"># intercept</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>b2 <span class="ot">=</span> reg2<span class="sc">$</span>coefficients[<span class="dv">2</span>] <span class="co"># slope</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>pline2 <span class="ot">=</span> ath_gg <span class="sc">+</span> <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="sc">-</span>a2<span class="sc">/</span>b2, <span class="at">slope =</span> <span class="dv">1</span><span class="sc">/</span>b2,</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> <span class="st">"darkgreen"</span>, <span class="at">linewidth =</span> <span class="fl">1.5</span>)</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>pline2 <span class="sc">+</span> <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">xend=</span>reg2<span class="sc">$</span>fitted, <span class="at">yend=</span>disc),</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">colour =</span> <span class="st">"orange"</span>, <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.15</span>, <span class="st">"cm"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

<div class="no-row-height column-margin column-container"><div class="cell-output-display">
<div id="fig-Reg2" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-Reg2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="07-chap_files/figure-html/fig-Reg2-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-13" title="Figure&nbsp;7.8: The green line minimizes the sum of squares of the horizontal residuals (in orange)."><img src="07-chap_files/figure-html/fig-Reg2-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="240"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-Reg2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7.8: The green line minimizes the sum of squares of the horizontal residuals (in orange).
</figcaption>
</figure>
</div>
</div></div></div>
<p>Each of the regression lines in Figures <a href="#fig-Reg1" class="quarto-xref"><span>7.7</span></a> and <a href="#fig-Reg2" class="quarto-xref"><span>7.8</span></a> gives us an approximate linear relationship between <code>disc</code> and <code>weight</code>. However, the relationship differs depending on which of the variables we choose to be the predictor and which the response.</p>
<div id="wrn-multivariate-pointsonline" class="callout callout-style-default callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Question&nbsp;7.6
</div>
</div>
<div class="callout-body-container callout-body">
<p>How large is the variance of the projected points that lie on the blue regression line of <a href="#fig-Reg1" class="quarto-xref">Figure&nbsp;<span>7.7</span></a>? Compare this to the variance of the data when projected on the original axes, <code>weight</code> and <code>disc</code>.</p>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-13-contents" aria-controls="callout-13" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-13" class="callout-13-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Pythagoras’ theorem tells us that the squared length of the hypotenuse of a right-angled triangle is equal to the sum of the squared lengths of the other two sides, which we apply as follows:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">var</span>(athletes<span class="sc">$</span>weight) <span class="sc">+</span> <span class="fu">var</span>(reg1<span class="sc">$</span>fitted)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.650204</code></pre>
</div>
</div>
<p>The variances of the points along the original axes <code>weight</code> and <code>disc</code> are 1, since we scaled the variables.</p>
</div>
</div>
</div>
</section>
<section id="a-line-that-minimizes-distances-in-both-directions" class="level4 unnumbered page-columns page-full">
<h4 class="unnumbered anchored" data-anchor-id="a-line-that-minimizes-distances-in-both-directions">A line that minimizes distances in both directions</h4>
<p><a href="#fig-PCAmin" class="quarto-xref">Figure&nbsp;<span>7.9</span></a> shows the line chosen to minimize the sum of squares of the orthogonal (perpendicular) projections of data points onto it; we call this the <strong>principal component</strong> line. All our three ways of fitting a line (Figures <a href="#fig-Reg1" class="quarto-xref"><span>7.7</span></a>–<a href="#fig-PCAmin" class="quarto-xref"><span>7.9</span></a>) together in one plot are shown in <a href="#fig-PCAR1R2-1" class="quarto-xref">Figure&nbsp;<span>7.10</span></a>.</p>
<div class="cell page-columns page-full" data-layout-align="center">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>xy <span class="ot">=</span> <span class="fu">cbind</span>(athletes<span class="sc">$</span>disc, athletes<span class="sc">$</span>weight)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>svda <span class="ot">=</span> <span class="fu">svd</span>(xy)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>pc <span class="ot">=</span> xy <span class="sc">%*%</span> svda<span class="sc">$</span>v[, <span class="dv">1</span>] <span class="sc">%*%</span> <span class="fu">t</span>(svda<span class="sc">$</span>v[, <span class="dv">1</span>])</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>bp <span class="ot">=</span> svda<span class="sc">$</span>v[<span class="dv">2</span>, <span class="dv">1</span>] <span class="sc">/</span> svda<span class="sc">$</span>v[<span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>ap <span class="ot">=</span> <span class="fu">mean</span>(pc[, <span class="dv">2</span>]) <span class="sc">-</span> bp <span class="sc">*</span> <span class="fu">mean</span>(pc[, <span class="dv">1</span>])</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>ath_gg <span class="sc">+</span> <span class="fu">geom_segment</span>(<span class="at">xend =</span> pc[, <span class="dv">1</span>], <span class="at">yend =</span> pc[, <span class="dv">2</span>]) <span class="sc">+</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> ap, <span class="at">slope =</span> bp, <span class="at">col =</span> <span class="st">"purple"</span>, <span class="at">linewidth =</span> <span class="fl">1.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

<div class="no-row-height column-margin column-container"><div class="cell-output-display">
<div id="fig-PCAmin" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-PCAmin-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="07-chap_files/figure-html/fig-PCAmin-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-14" title="Figure&nbsp;7.9: The purple principal component line minimizes the sums of squares of the orthogonal projections."><img src="07-chap_files/figure-html/fig-PCAmin-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="240"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-PCAmin-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7.9: The purple <strong>principal component</strong> line minimizes the sums of squares of the orthogonal projections.
</figcaption>
</figure>
</div>
</div></div></div>
<div class="cell page-columns page-full" data-layout-align="center">

<div class="no-row-height column-margin column-container"><div class="cell-output-display">
<div id="fig-PCAR1R2-1" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-PCAR1R2-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="07-chap_files/figure-html/fig-PCAR1R2-1-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-15" title="Figure&nbsp;7.10: The blue line minimizes the sum of squares of the vertical residuals, the green line minimizes the horizontal residuals, the purple line, called the principal component, minimizes the orthogonal projections. Notice the ordering of the slopes of the three lines."><img src="07-chap_files/figure-html/fig-PCAR1R2-1-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="240"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-PCAR1R2-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7.10: The blue line minimizes the sum of squares of the vertical residuals, the green line minimizes the horizontal residuals, the purple line, called the <strong>principal component</strong>, minimizes the orthogonal projections. Notice the ordering of the slopes of the three lines.
</figcaption>
</figure>
</div>
</div></div></div>
<div id="wrn-multivariate-PCAline" class="callout callout-style-default callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Question&nbsp;7.7
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="a">
<li>What is particular about the slope of the purple line?<br>
</li>
<li>Redo the plots on the original (unscaled) variables. What happens?</li>
</ol>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-15-contents" aria-controls="callout-15" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-15" class="callout-15-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The lines computed here depend on the choice of units. Because we have made the standard deviations equal to one for both variables, the PCA line is the diagonal that cuts exactly in the middle of both regression lines. Since the data were centered by subtracting their means, the line passes through the origin <span class="math inline">\((0,0)\)</span>.</p>
</div>
</div>
</div>
<div id="wrn-multivariate-PCAvariance" class="callout callout-style-default callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Question&nbsp;7.8
</div>
</div>
<div class="callout-body-container callout-body">
<p>Compute the variance of the points on the purple line.</p>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-17-contents" aria-controls="callout-17" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-17" class="callout-17-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>We have computed the coordinates of the points when we made the plot, these are in the <code>pc</code> vector:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(pc, <span class="dv">2</span>, var)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.9031761 0.9031761</code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">apply</span>(pc, <span class="dv">2</span>, var))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.806352</code></pre>
</div>
</div>
<p>We see that the variance along this axis is larger than the other variances we calculated in <a href="#wrn-multivariate-pointsonline" class="quarto-xref">Question&nbsp;<span>7.6</span></a>.</p>
</div>
</div>
</div>
<p>Pythagoras’ theorem tells us two interesting things here:</p>
<ul>
<li><p>If we are minimizing in both horizontal and vertical directions we are in fact minimizing the orthogonal projections onto the line from each point.</p></li>
<li><p>The total variability of the points is measured by the sum of squares of the projection of the points onto the center of gravity, which is the origin (0,0) if the data are centered. This is called the <em>total variance</em> or the <strong>inertia</strong> of the point cloud. This inertia can be decomposed into the sum of the squares of the projections onto the line plus the variances along that line. For a fixed variance, minimizing the projection distances also maximizes the variance along that line. Often we define the first principal component as the line with maximum variance.</p></li>
</ul>
</section>
</section>
</section>
<section id="the-new-linear-combinations" class="level2 page-columns page-full" data-number="7.4">
<h2 data-number="7.4" class="anchored" data-anchor-id="the-new-linear-combinations"><span class="header-section-number">7.4</span> The new linear combinations</h2>
<div class="cell page-columns page-full" data-layout-align="center">

<div class="no-row-height column-margin column-container"><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="imgs/Vegetables_small.jpg" class="lightbox" data-gallery="quarto-lightbox-gallery-16"><img src="imgs/Vegetables_small.jpg" class="img-fluid quarto-figure quarto-figure-center figure-img"></a></p>
</figure>
</div>
</div></div></div>
<!-- TODO: '\small' is currently ignored -->
<div class="page-columns page-full"><p> The PC line we found in the previous section could be written</p><div class="no-row-height column-margin column-container"><span class="margin-aside">Image credit: Sara Holmes</span></div></div>
<p><span class="anchored-eq" data-anchor-id="eq-eoytpgqvcauf" id="eq-eoytpgqvcauf"><span class="math display">\[
PC = \frac{1}{2} \mbox{disc} + \frac{1}{2} \mbox{weight}.
\tag{7.2}\]</span></span></p>
<p>Principal components are <em>linear combinations</em> of the variables that were originally measured, they provide a <em>new coordinate system</em>. To understand what a <strong>linear combination</strong> really is, we can take an analogy. When making a healthy juice mix, you will follow a recipe like</p>
<p><span class="math display">\[
\begin{align}
V &amp;= 2 \times \text{Beet} + 1 \times \text{Carrot} \\
  &amp;+ \tfrac{1}{2} \text{Gala} + \tfrac{1}{2} \text{GrannySmith} \\
  &amp;+ 0.02 \times \text{Ginger} + 0.25 \times \text{Lemon}.
\end{align}
\]</span></p>
<p>This recipe is a linear combination of individual juice types (the original variables). The result is a new variable, <span class="math inline">\(V\)</span>, and the coefficients <span class="math inline">\((2,1,\frac{1}{2},\frac{1}{2},0.02,0.25)\)</span> are called the <strong>loadings</strong>.</p>
<div id="wrn-multivariate-PCAjuice" class="callout callout-style-default callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Question&nbsp;7.9
</div>
</div>
<div class="callout-body-container callout-body">
<p>How would you compute the calories in a glass of juice?</p>
</div>
</div>
<section id="optimal-lines" class="level3 page-columns page-full" data-number="7.4.1">
<h3 data-number="7.4.1" class="anchored" data-anchor-id="optimal-lines"><span class="header-section-number">7.4.1</span> Optimal lines</h3>
<p>A linear combination of variables defines a line in higher dimensions in the same way we constructed lines in the scatterplot plane of two dimensions. As we saw in that case, there are many ways to choose lines onto which we project the data, there is however a `best’ line for our purpose.</p>
<p>The total variance of all the points in all the variables can de decomposed. In PCA, we use the fact that the total sums of squares of the distances between the points and any line can be decomposed into the distance to the line and the variance along the line.</p>
<p>We saw that the principal component minimizes the distance to the line, and it also maximizes the variance of the projections along the line.</p>
<p>Why is maximizing the variance along a line a good idea? Let’s look at another example of a projection from three dimensions into two. In fact, human vision depends on such dimension reduction:</p>
<div class="cell page-columns page-full" data-layout-align="center">

<div class="no-row-height column-margin column-container"><div class="cell-output-display">
<div id="fig-cam1" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-cam1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="imgs/CAM3.png" class="lightbox" data-gallery="quarto-lightbox-gallery-17" title="Figure&nbsp;7.11: A mystery silhouette."><img src="imgs/CAM3.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-cam1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7.11: A mystery silhouette.
</figcaption>
</figure>
</div>
</div></div></div>
<div id="wrn-multivariate-PCAtwodthreed" class="callout callout-style-default callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Question&nbsp;7.10
</div>
</div>
<div class="callout-body-container callout-body">
<p>In <a href="#fig-cam1" class="quarto-xref">Figure&nbsp;<span>7.11</span></a>, there is a two-dimensional projection of a three-dimensional object. What is the object?</p>
</div>
</div>
<div id="wrn-multivariate-camel" class="callout callout-style-default callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Question&nbsp;7.11
</div>
</div>
<div class="callout-body-container callout-body">
<p>Which of the two projections, <a href="#fig-cam1" class="quarto-xref">Figure&nbsp;<span>7.11</span></a> or <a href="#fig-cam2" class="quarto-xref"><span>7.13</span></a>, do you find more informative, and why?</p>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-21-contents" aria-controls="callout-21" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-21" class="callout-21-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>One can argue that the projection that maximizes the area of the shadow shows more `information’.</p>
</div>
</div>
</div>
</section>
</section>
<section id="the-pca-workflow" class="level2 page-columns page-full" data-number="7.5">
<h2 data-number="7.5" class="anchored" data-anchor-id="the-pca-workflow"><span class="header-section-number">7.5</span> The PCA workflow</h2>
<div class="cell page-columns page-full" data-layout-align="center">

<div class="no-row-height column-margin column-container"><div class="cell-output-display">
<div id="fig-pca" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-pca-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="imgs/orgacp1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-18" title="Figure&nbsp;7.12: Many choices have to be made during PCA processing."><img src="imgs/orgacp1.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-pca-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7.12: Many choices have to be made during PCA processing.
</figcaption>
</figure>
</div>
</div></div></div>
<p>PCA is based on the principle of finding the axis showing the largest inertia/variability, removing the variability in that direction and then iterating to find the next best orthogonal axis, and so on. In fact, we do not have to run iterations, all the axes can be found in one linear algebra operation called the <strong>S</strong>ingular <strong>V</strong>alue <strong>D</strong>ecomposition (we will delve more deeply into the details below).</p>
<p>In the diagram in <a href="#fig-pca" class="quarto-xref">Figure&nbsp;<span>7.12</span></a>, we see that first the means and variances are computed and the choice of whether to work directly with the covariance matrix or with the correlation matrix has to be made. The next step is the choice of <span class="math inline">\(k\)</span>, the number of components we deem relevant to the data. We say that <span class="math inline">\(k\)</span> is the rank of the approximation. The best choice of <span class="math inline">\(k\)</span> is a difficult question, and we discuss on how to approach it below. The choice of <span class="math inline">\(k\)</span> requires looking at a plot of the variances explained by the successive principal components. Once we have chosen <span class="math inline">\(k\)</span>, we can proceed to the projections of the data in the new <span class="math inline">\(k\)</span>-dimensional subspace.</p>
<p>The end results of the PCA workflow are useful maps of both the variables and the samples. Understanding how these maps are constructed will maximize the information we can gather from them.</p>
</section>
<section id="the-inner-workings-of-pca-rank-reduction" class="level2 page-columns page-full" data-number="7.6">
<h2 data-number="7.6" class="anchored" data-anchor-id="the-inner-workings-of-pca-rank-reduction"><span class="header-section-number">7.6</span> The inner workings of PCA: rank reduction</h2>
<p>This is a small section for those whose background in linear algebra is but a faint memory. It tries to give some intuition to the singular value decomposition method underlying PCA, without too much notation.</p>
<div class="cell page-columns page-full" data-layout-align="center">

<div class="no-row-height column-margin column-container"><div class="cell-output-display">
<div id="fig-cam2" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-cam2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="imgs/CAM4.png" class="lightbox" data-gallery="quarto-lightbox-gallery-19" title="Figure&nbsp;7.13: Another two-dimensional projection of the same object shown in Figure&nbsp;fig-cam1. Here, the perspective is more informative. Generally, choosing the perspective such that the spread (in other words, the variance) of the points is maximal generally provides most information. We want to see as much of the variation as possible, that’s what PCA does."><img src="imgs/CAM4.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-cam2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7.13: Another two-dimensional projection of the same object shown in <a href="#fig-cam1" class="quarto-xref">Figure&nbsp;<span>7.11</span></a>. Here, the perspective is more informative. Generally, choosing the perspective such that the spread (in other words, the variance) of the points is maximal generally provides most information. We want to see as much of the variation as possible, that’s what PCA does.
</figcaption>
</figure>
</div>
</div></div></div>
<p>The singular value decomposition of a matrix finds horizontal and vertical vectors (called the singular vectors) and normalizing values (called singular values). As before, we start by giving the forward-generative explanation before doing the actual reverse engineering that is used in creating the decomposition. To calibrate the meaning of each step, we will start with an artificial example before moving to the complexity of real data.</p>
<section id="rank-one-matrices" class="level3 page-columns page-full" data-number="7.6.1">
<h3 data-number="7.6.1" class="anchored" data-anchor-id="rank-one-matrices"><span class="header-section-number">7.6.1</span> Rank-one matrices</h3>
<p>A simple generative model demonstrates the meaning of the <strong>rank of a matrix</strong> and explains how we find it in practice. Suppose we have two vectors, <span class="math inline">\(u\)</span> (a one-column matrix), and <span class="math inline">\(v^t=t(v)\)</span> (a one-row matrix–the transpose of a one-column matrix <span class="math inline">\(v\)</span>). For instance, <span class="math inline">\(u =\left(
  \begin{smallmatrix}
1\\2\\3\\4
  \end{smallmatrix}
\right)\)</span> and <span class="math inline">\(v =\left(
  \begin{smallmatrix}
2\\4\\8
\end{smallmatrix}
\right)\)</span>. The transpose of <span class="math inline">\(v\)</span> is written <span class="math inline">\(v^t = t(v) = (2\; 4\; 8)\)</span>. We multiply a copy of <span class="math inline">\(u\)</span> by each of the elements of <span class="math inline">\(v^t\)</span> in turn as follows:</p>
<!-- TODO: prettify these -->
<p>Step 0:<br>
</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: center;">X</th>
<th style="text-align: center;">2</th>
<th style="text-align: center;">4</th>
<th style="text-align: center;">8</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">1</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td style="text-align: center;">2</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="odd">
<td style="text-align: center;">3</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td style="text-align: center;">4</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
</tbody>
</table>
<p>Step 1:<br>
</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: center;">X</th>
<th style="text-align: center;">2</th>
<th style="text-align: center;">4</th>
<th style="text-align: center;">8</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">1</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td style="text-align: center;">2</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="odd">
<td style="text-align: center;">3</td>
<td style="text-align: center;">6</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td style="text-align: center;">4</td>
<td style="text-align: center;">8</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
</tbody>
</table>
<p>Step 2:<br>
</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: center;">X</th>
<th style="text-align: center;">2</th>
<th style="text-align: center;">4</th>
<th style="text-align: center;">8</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">1</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td style="text-align: center;">2</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;">8</td>
<td style="text-align: center;"></td>
</tr>
<tr class="odd">
<td style="text-align: center;">3</td>
<td style="text-align: center;">6</td>
<td style="text-align: center;">12</td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td style="text-align: center;">4</td>
<td style="text-align: center;">8</td>
<td style="text-align: center;">16</td>
<td style="text-align: center;"></td>
</tr>
</tbody>
</table>
<p>Step 3:<br>
</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: center;">X</th>
<th style="text-align: center;">2</th>
<th style="text-align: center;">4</th>
<th style="text-align: center;">8</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">1</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;">8</td>
</tr>
<tr class="even">
<td style="text-align: center;">2</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;">8</td>
<td style="text-align: center;">16</td>
</tr>
<tr class="odd">
<td style="text-align: center;">3</td>
<td style="text-align: center;">6</td>
<td style="text-align: center;">12</td>
<td style="text-align: center;">24</td>
</tr>
<tr class="even">
<td style="text-align: center;">4</td>
<td style="text-align: center;">8</td>
<td style="text-align: center;">16</td>
<td style="text-align: center;">32</td>
</tr>
</tbody>
</table>
<p>Thus, the <span class="math inline">\((2,3)\)</span> entry of the matrix <span class="math inline">\(X\)</span>, written <span class="math inline">\(x_{2,3}\)</span>, is obtained by multiplying <span class="math inline">\(u_2\)</span> by <span class="math inline">\(v_3\)</span>. We can write this</p>
<p><span class="anchored-eq" data-anchor-id="eq-riyzhwnmovjg" id="eq-riyzhwnmovjg"><span class="math display">\[
X=\begin{pmatrix}
2&amp;4&amp;8\\ 4&amp;8&amp;16\\
6 &amp;12&amp;24\\
8&amp;16&amp;32\\
\end{pmatrix}
= u * t(v)= u * v^t
\tag{7.3}\]</span></span></p>
<p>The matrix <span class="math inline">\(X\)</span> we obtain here is said to be of rank 1, because both <span class="math inline">\(u\)</span> and <span class="math inline">\(v\)</span> have one column.</p>
<div id="wrn-multivariate-PCAeconomical" class="callout callout-style-default callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Question&nbsp;7.12
</div>
</div>
<div class="callout-body-container callout-body">
<p>Why can we say that writing <span class="math inline">\(X = u*v^t\)</span> is more economical than spelling out the full matrix <span class="math inline">\(X\)</span>?</p>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-23-contents" aria-controls="callout-23" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-23" class="callout-23-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><span class="math inline">\(X\)</span> has <span class="math inline">\(4\times3=12\)</span> elements, while in terms of <span class="math inline">\(u\)</span> and <span class="math inline">\(v\)</span> it can be expressed by only <span class="math inline">\(4+3=7\)</span> numbers. The compression is even more impressive when <span class="math inline">\(u\)</span> or <span class="math inline">\(v\)</span> are longer.</p>
</div>
</div>
</div>
<p>On the other hand, suppose that we want to reverse the process and simplify another matrix <span class="anchored-eq" data-anchor-id="eq-DecomposeX" class="math inline">\(X\)</span> given below with 3 rows and 4 columns (12 numbers). Can we always express it in a similar way as a product of vectors without loss of information? In the diagrams shown in Figures <a href="#fig-mosaic0" class="quarto-xref"><span>7.14</span></a> and <a href="#fig-mosaic123" class="quarto-xref"><span>7.15</span></a>, the colored boxes have areas proportional to the numbers in the cells of the matrix (<a href="#eq-DecomposeX" class="quarto-xref"><span>7.4</span></a>).</p>
<div class="cell page-columns page-full" data-layout-align="center">

<div class="no-row-height column-margin column-container"><div class="cell-output-display">
<div id="fig-mosaic0" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-mosaic0-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="imgs/SVD-mosaicXplot0.png" class="lightbox" data-gallery="quarto-lightbox-gallery-20" title="Figure&nbsp;7.14: Some special matrices have numbers in them that make them easy to decompose. Each colored rectangle in this diagram has an area that corresponds to the number in it."><img src="imgs/SVD-mosaicXplot0.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-mosaic0-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7.14: Some special matrices have numbers in them that make them easy to decompose. Each colored rectangle in this diagram has an area that corresponds to the number in it.
</figcaption>
</figure>
</div>
</div></div></div>
<div id="wrn-multivariate-rectangularmatrix" class="callout callout-style-default callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Question&nbsp;7.13
</div>
</div>
<div class="callout-body-container callout-body">
<p>Here is a matrix <span class="math inline">\(X\)</span> we want to decompose.</p>
<p><span class="anchored-eq" data-anchor-id="eq-DecomposeX" id="eq-DecomposeX"><span class="math display">\[
\begin{array}{rrrrr}
\hline
{\large X} &amp; x_{.1} &amp;  x_{.2} &amp;  x_{.3} &amp;  x_{.4} \\
\hline
x_{1.} &amp; 780 &amp; 936 &amp; 1300 &amp; 728\\
x_{2.} &amp;  75 &amp;  90 &amp;  125 &amp;  70\\
x_{3.} &amp; 540 &amp; 648 &amp;  900 &amp; 504\\
\hline
\end{array}
\tag{7.4}\]</span></span></p>
<p><span class="math inline">\(X\)</span> has been redrawn as series of rectangles in <a href="#fig-mosaic0" class="quarto-xref">Figure&nbsp;<span>7.14</span></a>. What numbers could we put in the white <span class="math inline">\(u\)</span> and <span class="math inline">\(v\)</span> boxes so that the values of the sides of the rectangle give the numbers as their product?</p>
</div>
</div>
<p>A matrix with the special property of being perfectly “rectangular” like <span class="math inline">\(X\)</span> is said to be of rank 1. We can represent the numbers in <span class="math inline">\(X\)</span> by the areas of rectangles, where the sides of rectangles are given by the values in the side vectors (<span class="math inline">\(u\)</span> and <span class="math inline">\(v\)</span>).</p>
<div class="cell page-columns page-full" data-layout-nrow="1" data-layout-align="center" data-fig-cap-location="margin">
<div id="fig-mosaic123" class="quarto-layout-panel page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-mosaic123-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-mosaic123" style="flex-basis: 33.3%;justify-content: center;">
<div id="fig-mosaic123-1" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-mosaic123-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="imgs/SVD-mosaicXplot1.png" class="lightbox" data-gallery="fig-mosaic123" title="Figure&nbsp;7.15&nbsp;(a): "><img src="imgs/SVD-mosaicXplot1.png" id="fig-mosaic123-1" class="img-fluid quarto-figure quarto-figure-center anchored figure-img" data-ref-parent="fig-mosaic123"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-mosaic123-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a)
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-mosaic123" style="flex-basis: 33.3%;justify-content: center;">
<div id="fig-mosaic123-2" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-mosaic123-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="imgs/SVD-mosaicXplot2.png" class="lightbox" data-gallery="fig-mosaic123" title="Figure&nbsp;7.15&nbsp;(b): "><img src="imgs/SVD-mosaicXplot2.png" id="fig-mosaic123-2" class="img-fluid quarto-figure quarto-figure-center anchored figure-img" data-ref-parent="fig-mosaic123"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-mosaic123-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b)
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-mosaic123" style="flex-basis: 33.3%;justify-content: center;">
<div id="fig-mosaic123-3" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-mosaic123-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="imgs/SVD-mosaicXplot3.png" class="lightbox" data-gallery="fig-mosaic123" title="Figure&nbsp;7.15&nbsp;(c): "><img src="imgs/SVD-mosaicXplot3.png" id="fig-mosaic123-3" class="img-fluid quarto-figure quarto-figure-center anchored figure-img" data-ref-parent="fig-mosaic123"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-mosaic123-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(c)
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-mosaic123-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7.15: The numbers in the cells are equal to the product of the corresponding margins in (a), (b) and (c). We could make the cells from products in several ways. In (c), we force the margins to have norm <span class="math inline">\(1\)</span>.
</figcaption>
</figure>
</div>
</div>
<p>We see in <a href="#fig-mosaic123" class="quarto-xref">Figure&nbsp;<span>7.15</span></a> that the decomposition of <span class="math inline">\(X\)</span> is not unique: there are several candidate choices for the vectors <span class="math inline">\(u\)</span> and <span class="math inline">\(v\)</span>. We will make the choice unique by requiring that the sum of the squares of each vector’s elements add to 1 (we say the vectors <span class="math inline">\(v\)</span> and <span class="math inline">\(u\)</span> have norm 1). Then we have to keep track of one extra number by which to multiply each of the products, and which represents the “overall scale” of <span class="math inline">\(X\)</span>. This is the value we have put in the upper left hand corner. It is called the singular value <span class="math inline">\(s_1\)</span>. In the R code below, we start by supposing we know the values in <code>u</code>, <code>v</code> and <code>s1</code>; later we will see a function that finds them for us. Let’s check the multiplication and norm properties in R:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>X <span class="ot">=</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">780</span>,  <span class="dv">75</span>, <span class="dv">540</span>,</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>             <span class="dv">936</span>,  <span class="dv">90</span>, <span class="dv">648</span>,</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>            <span class="dv">1300</span>, <span class="dv">125</span>, <span class="dv">900</span>,</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>             <span class="dv">728</span>,  <span class="dv">70</span>, <span class="dv">504</span>), <span class="at">nrow =</span> <span class="dv">3</span>)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>u <span class="ot">=</span> <span class="fu">c</span>(<span class="fl">0.8196</span>, <span class="fl">0.0788</span>, <span class="fl">0.5674</span>)</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>v <span class="ot">=</span> <span class="fu">c</span>(<span class="fl">0.4053</span>, <span class="fl">0.4863</span>, <span class="fl">0.6754</span>, <span class="fl">0.3782</span>)</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>s1 <span class="ot">=</span> <span class="fl">2348.2</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(u<span class="sc">^</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(v<span class="sc">^</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>s1 <span class="sc">*</span> u <span class="sc">%*%</span> <span class="fu">t</span>(v)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3] [,4]
[1,]  780  936 1300  728
[2,]   75   90  125   70
[3,]  540  648  900  504</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>X <span class="sc">-</span> s1 <span class="sc">*</span> u <span class="sc">%*%</span> <span class="fu">t</span>(v)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         [,1]   [,2]   [,3]   [,4]
[1,] -0.03419 0.0745 0.1355 0.1221
[2,]  0.00403 0.0159 0.0252 0.0186
[3,] -0.00903 0.0691 0.1182 0.0982</code></pre>
</div>
</div>
<div id="wrn-multivariate-svdnumbers" class="callout callout-style-default callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Question&nbsp;7.14
</div>
</div>
<div class="callout-body-container callout-body">
<p>Try <code>svd(X)</code> in R. Look at the components of the output of the <code>svd</code> function carefully. Check the norm of the columns of the matrices that result from this call. Where did the above value of <code>s1</code> = 2348.2 come from?</p>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-26-contents" aria-controls="callout-26" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-26" class="callout-26-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">svd</span>(X)<span class="sc">$</span>u[, <span class="dv">1</span>]</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="fu">svd</span>(X)<span class="sc">$</span>v[, <span class="dv">1</span>]</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">svd</span>(X)<span class="sc">$</span>u[, <span class="dv">1</span>]<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">svd</span>(X)<span class="sc">$</span>v[, <span class="dv">1</span>]<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="fu">svd</span>(X)<span class="sc">$</span>d</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p>In fact, in this particular case we were lucky: we see that the second and third singular values are 0 (up to the numeric precision we care about). That is why we say that <span class="math inline">\(X\)</span> is of <strong>rank</strong> 1. For a more general matrix <span class="math inline">\(X\)</span>, it is rare to be able to write <span class="math inline">\(X\)</span> exactly as this type of two-vector product. The next subsection shows how we can decompose <span class="math inline">\(X\)</span> when it is not of rank 1: we will just need more pieces.</p>
</section>
<section id="how-do-we-find-such-a-decomposition-in-a-unique-way" class="level3 page-columns page-full" data-number="7.6.2">
<h3 data-number="7.6.2" class="anchored" data-anchor-id="how-do-we-find-such-a-decomposition-in-a-unique-way"><span class="header-section-number">7.6.2</span> How do we find such a decomposition in a unique way?</h3>
<p>In the above decomposition, there were three elements: the horizontal and vertical singular vectors, and the diagonal corner, called the singular value. These can be found using the singular value decomposition function (<code>svd</code>). For instance:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>Xtwo <span class="ot">=</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="fl">12.5</span>, <span class="fl">35.0</span>, <span class="fl">25.0</span>, <span class="dv">25</span>, <span class="dv">9</span>, <span class="dv">14</span>, <span class="dv">26</span>, <span class="dv">18</span>, <span class="dv">16</span>, <span class="dv">21</span>, <span class="dv">49</span>, <span class="dv">32</span>,</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>       <span class="dv">18</span>, <span class="dv">28</span>, <span class="dv">52</span>, <span class="dv">36</span>, <span class="dv">18</span>, <span class="fl">10.5</span>, <span class="fl">64.5</span>, <span class="dv">36</span>), <span class="at">ncol =</span> <span class="dv">4</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>USV <span class="ot">=</span> <span class="fu">svd</span>(Xtwo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="wrn-multivariate-USVobject" class="callout callout-style-default callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Question&nbsp;7.15
</div>
</div>
<div class="callout-body-container callout-body">
<p>Look at the <code>USV</code> object, the result of calling the <code>svd</code> function. What are its components?</p>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-28-contents" aria-controls="callout-28" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-28" class="callout-28-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(USV)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "d" "u" "v"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>USV<span class="sc">$</span>d</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.350624e+02 2.805191e+01 3.111680e-15 2.290270e-15</code></pre>
</div>
</div>
<p>So 135.1 is the first singular value <code>USV$d[1]</code>.</p>
</div>
</div>
</div>
<div id="wrn-multivariate-svdapprox" class="callout callout-style-default callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Question&nbsp;7.16
</div>
</div>
<div class="callout-body-container callout-body">
<p>Check how each successive pair of singular vectors improves our approximation to <code>Xtwo</code>. What do you notice about the third and fourth singular values?</p>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-30-contents" aria-controls="callout-30" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-30" class="callout-30-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>Xtwo <span class="sc">-</span> USV<span class="sc">$</span>d[<span class="dv">1</span>] <span class="sc">*</span> USV<span class="sc">$</span>u[, <span class="dv">1</span>] <span class="sc">%*%</span> <span class="fu">t</span>(USV<span class="sc">$</span>v[, <span class="dv">1</span>])</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>Xtwo <span class="sc">-</span> USV<span class="sc">$</span>d[<span class="dv">1</span>] <span class="sc">*</span> USV<span class="sc">$</span>u[, <span class="dv">1</span>] <span class="sc">%*%</span> <span class="fu">t</span>(USV<span class="sc">$</span>v[, <span class="dv">1</span>]) <span class="sc">-</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>       USV<span class="sc">$</span>d[<span class="dv">2</span>] <span class="sc">*</span> USV<span class="sc">$</span>u[, <span class="dv">2</span>] <span class="sc">%*%</span> <span class="fu">t</span>(USV<span class="sc">$</span>v[, <span class="dv">2</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The third and fourth singular values are so small that they do not improve the approximation (within rounding errors), so we can conclude that <code>Xtwo</code> is of rank 2.</p>
</div>
</div>
</div>
<p>Again, there are many ways to write a rank two matrix such as <code>Xtwo</code> as a sum of rank one matrices: in order to ensure uniqueness, we impose yet another<a href="#fn7" class="footnote-ref" id="fnref7" role="doc-noteref"><sup>7</sup></a> condition on the singular vectors. The output vectors of the singular decomposition do not only have their norms equal to 1, each column vector in the <span class="math inline">\(U\)</span> matrix is orthogonal to all the previous ones. We write <span class="math inline">\(u_{\cdot 1} \perp u_{\cdot 2}\)</span>, this means that the sum of the products of the values in the same positions is <span class="math inline">\(0\)</span>: <span class="math inline">\(\sum_i u_{i1} u_{i2} = 0\)</span>. Ditto for the <span class="math inline">\(V\)</span> matrix.</p>
<div class="no-row-height column-margin column-container"><div id="fn7"><p><sup>7</sup>&nbsp;Above, we had chosen the norm of the vectors to be 1.</p></div></div><div class="callout callout-style-default callout-tip no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Task
</div>
</div>
<div class="callout-body-container callout-body">
<p>Check the orthonormality by computing the cross product of the <span class="math inline">\(U\)</span> and <span class="math inline">\(V\)</span> matrices:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t</span>(USV<span class="sc">$</span>u) <span class="sc">%*%</span> USV<span class="sc">$</span>u</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="fu">t</span>(USV<span class="sc">$</span>v) <span class="sc">%*%</span> USV<span class="sc">$</span>v</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<p>Let’s submit our <code>scaledTurtles</code> matrix to a singular value decomposition.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>turtles.svd <span class="ot">=</span> <span class="fu">svd</span>(scaledTurtles)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>turtles.svd<span class="sc">$</span>d</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 11.746475  1.419035  1.003329</code></pre>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>turtles.svd<span class="sc">$</span>v</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          [,1]       [,2]        [,3]
[1,] 0.5787981  0.3250273  0.74789704
[2,] 0.5779840  0.4834699 -0.65741263
[3,] 0.5752628 -0.8127817 -0.09197088</code></pre>
</div>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(turtles.svd<span class="sc">$</span>u)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 48  3</code></pre>
</div>
</div>
<div id="wrn-multivariate-turtleSVD" class="callout callout-style-default callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Question&nbsp;7.17
</div>
</div>
<div class="callout-body-container callout-body">
<p>What can you conclude about the turtles matrix from the <code>svd</code> output?</p>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-33-contents" aria-controls="callout-33" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-33" class="callout-33-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The first column of <code>turtles.svd$v</code> shows that the coefficients for the three variables are practically equal. Other noticeable “coincidences” include:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(turtles.svd<span class="sc">$</span>v[,<span class="dv">1</span>]<span class="sc">^</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(turtles.svd<span class="sc">$</span>d<span class="sc">^</span><span class="dv">2</span>) <span class="sc">/</span> <span class="dv">47</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3</code></pre>
</div>
</div>
<p>We see that the coefficients are in fact <span class="math inline">\(\sqrt{1/3}\)</span> and the sum of squares of the singular values is equal to <span class="math inline">\((n-1)\times p\)</span>.</p>
</div>
</div>
</div>
</section>
<section id="singular-value-decomposition" class="level3 page-columns page-full" data-number="7.6.3">
<h3 data-number="7.6.3" class="anchored" data-anchor-id="singular-value-decomposition"><span class="header-section-number">7.6.3</span> Singular value decomposition</h3>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="imgs/SumRankOneD.png" class="lightbox" data-gallery="quarto-lightbox-gallery-24"><img src="imgs/SumRankOneD.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></a></p>
</figure>
</div>
</div>
</div>
<p><span class="math inline">\(X\)</span> is decomposed additively into rank-one pieces. Each of the <span class="math inline">\(u\)</span> vectors is combined into the <span class="math inline">\(U\)</span> matrix, and each of <span class="math inline">\(v\)</span> vectors into <span class="math inline">\(V\)</span>. The <em>Singular Value Decomposition</em> is</p>
<p><span class="anchored-eq" data-anchor-id="eq-usv" id="eq-usv"><span class="math display">\[
{\mathbf X} = U S V^t, V^t V={\mathbb I}, U^t U={\mathbb I},
\tag{7.5}\]</span></span></p>
<p>where <span class="anchored-eq" data-anchor-id="eq-usv" class="math inline">\(S\)</span> is the diagonal matrix of singular values, <span class="math inline">\(V^t\)</span> is the transpose of <span class="math inline">\(V\)</span>, and <span class="math inline">\({\mathbb I}\)</span> is the Identity matrix. Expression <a href="#eq-usv" class="quarto-xref"><span>7.5</span></a> can be written elementwise as</p>
<p><span class="math display">\[
X_{ij} = u_{i1}s_1v_{1j} +  u_{i2}s_2v_{2j} + u_{i3}s_3v_{3j} +... +
u_{ir}s_rv_{rj},
\]</span></p>
<p><span class="math inline">\(U\)</span> and <span class="math inline">\(V\)</span> are said to be orthonormal<a href="#fn8" class="footnote-ref" id="fnref8" role="doc-noteref"><sup>8</sup></a>, because their self-crossproducts are the identity matrix.</p>
<div class="no-row-height column-margin column-container"><div id="fn8"><p><sup>8</sup>&nbsp;Nothing to do with the normal distribution, it stands for orthogonal and having norm 1.</p></div></div></section>
<section id="principal-components" class="level3" data-number="7.6.4">
<h3 data-number="7.6.4" class="anchored" data-anchor-id="principal-components"><span class="header-section-number">7.6.4</span> Principal components</h3>
<p>The singular vectors from the singular value decomposition (provided by the <code>svd</code> function in R) contain the coefficients to put in front of the original variables to make the more informative ones we call the principal components. We write this as:</p>
<p><span class="math display">\[
Z_1=v_{11} X_{\cdot 1} +v_{21} X_{\cdot 2} + v_{31} X_{\cdot 3}+ \cdots + v_{p1} X_{\cdot p}.
\]</span></p>
<p>If <code>usv = svd(X)</code>, then <span class="math inline">\((v_{11},v_{21},v_{31},...)\)</span> are given by the first column of <code>usv$v</code>; similarly for <span class="math inline">\(Z_2\)</span> with the second column of <code>usv$v</code>, and so son. <span class="math inline">\(p\)</span> is the number of columns of <span class="math inline">\(X\)</span> and the number of rows of <span class="math inline">\(V\)</span>. These new variables <span class="math inline">\(Z_1, Z_2, Z_3, ...\)</span> have variances that decrease in size: <span class="math inline">\(s_1^2 \geq s_2^2 \geq s_3^2 \geq ...\)</span>.</p>
<div id="wrn-multivariate-checkus" class="callout callout-style-default callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Question&nbsp;7.18
</div>
</div>
<div class="callout-body-container callout-body">
<p>Compute the first principal component for the turtles data by multiplying by the first singular value <code>d[1]</code> by <code>u[,1]</code>. What is another way of computing it ?</p>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-35-contents" aria-controls="callout-35" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-35" class="callout-35-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>We show this using the code:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>US <span class="ot">=</span> turtles.svd<span class="sc">$</span>u[,<span class="dv">1</span>, drop <span class="ot">=</span> <span class="cn">FALSE</span>] <span class="sc">%*%</span> turtles.svd<span class="sc">$</span>d[<span class="dv">1</span>]</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>XV <span class="ot">=</span> scaledTurtles <span class="sc">%*%</span> turtles.svd<span class="sc">$</span>v[, <span class="dv">1</span>, drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a><span class="fu">max</span>(<span class="fu">abs</span>(US<span class="sc">-</span>XV))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can also see using matrix algebra that <span class="math inline">\(XV\)</span> and <span class="math inline">\(US\)</span> are the same. Remember that <span class="math inline">\(V\)</span> is orthogonal, so <span class="math inline">\(V^t V={\mathbb I}\)</span> and <span class="math inline">\(XV = USV^tV=US\,{\mathbb I}\)</span>.</p>
<p><em>Note:</em> The <code>drop = FALSE</code> argument in the first line of the below code makes sure that the selected matrix column retains <em>matrix</em> / <em>array</em> class attributes and thus is eligible for the matrix multiplication operator. Alternatively, you could use the regular multiplication operator <code>*</code>. In the second line, the <code>drop = FALSE</code> is not strictly necessary, but we have it there for symmetry.</p>
</div>
</div>
</div>
<p>Here are two useful facts, first in words, then with the mathematical shorthand.</p>
<p>The number of principal components <span class="math inline">\(k\)</span> is always chosen to be fewer than the number of original variables or the number of observations. We are “lowering” the dimension of the problem:</p>
<p><span class="math display">\[
k\leq \min(n,p).
\]</span></p>
<p>The principal component transformation is defined so that the first principal component has the largest possible variance (that is, accounts for as much of the variability in the data as possible), and each successive component in turn has the highest variance possible under the constraint that it be orthogonal to the preceding components:</p>
<p><span class="math display">\[
\max_{aX \perp bX}\mbox{var}(\mbox{Proj}_{aX} (X)), \qquad \mbox{where } bX=\mbox{previous components}
\]</span></p>
</section>
</section>
<section id="plotting-the-observations-in-the-principal-plane" class="level2 page-columns page-full" data-number="7.7">
<h2 data-number="7.7" class="anchored" data-anchor-id="plotting-the-observations-in-the-principal-plane"><span class="header-section-number">7.7</span> Plotting the observations in the principal plane</h2>
<div class="page-columns page-full"><p>We revisit our two-variable athletes data with the <code>discus</code> and the <code>weight</code> variables. In <a href="#sec-multivariate-pcaline" class="quarto-xref"><span>Section 7.3.2</span></a>, we computed the first principal component and represented it as the purple line in <a href="#fig-PCAR1R2-1" class="quarto-xref">Figure&nbsp;<span>7.10</span></a>. We showed that <span class="math inline">\(Z_1\)</span> was the linear combination given by the diagonal. As the coefficients have to have their sum of squares add to <span class="math inline">\(1\)</span>, we have that <span class="math display">\[Z_1=-0.707*\text{athletes\$disc}- 0.707*\text{athletes\$weight}.\]</span> </p><div class="no-row-height column-margin column-container"><span class="margin-aside">This is the same as if the two coordinates were <span class="math inline">\(c_1=0.7071\)</span> and <span class="math inline">\(c_2=0.7071\)</span>.</span></div></div>
<div id="wrn-xmultivariate-pcxy" class="callout callout-style-default callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Question&nbsp;7.19
</div>
</div>
<div class="callout-body-container callout-body">
<p>What part of the output of the <code>svd</code> functions leads us to the first PC coefficients, also known as the PC <strong>loadings</strong> ?</p>
</div>
</div>
<div class="page-columns page-full"><p></p><div class="no-row-height column-margin column-container"><span class="margin-aside">Note that we use <code>svda</code> which was the svd applied to the two variables <code>discus</code> and <code>weight</code>.</span></div></div>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-37-contents" aria-controls="callout-37" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-37" class="callout-37-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>svda<span class="sc">$</span>v[,<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.7071068 -0.7071068</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>If we rotate the <code>(discus, weight)</code> plane by making the purple line the horizontal <span class="math inline">\(x\)</span> axis, we obtain what is know as the first <strong>principal plane</strong>.</p>
<div class="cell page-columns page-full" data-layout-nrow="1" data-layout-align="center" data-fig-cap-location="margin">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>ppdf <span class="ot">=</span> <span class="fu">tibble</span>(<span class="at">PC1n =</span> <span class="sc">-</span>svda<span class="sc">$</span>u[, <span class="dv">1</span>] <span class="sc">*</span> svda<span class="sc">$</span>d[<span class="dv">1</span>],</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">PC2n =</span>  svda<span class="sc">$</span>u[, <span class="dv">2</span>] <span class="sc">*</span> svda<span class="sc">$</span>d[<span class="dv">2</span>])</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>gg <span class="ot">=</span> <span class="fu">ggplot</span>(ppdf, <span class="fu">aes</span>(<span class="at">x =</span> PC1n, <span class="at">y =</span> PC2n)) <span class="sc">+</span> </span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"purple"</span>, <span class="at">linewidth =</span> <span class="fl">1.5</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">"PC1 "</span>)<span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"PC2"</span>) <span class="sc">+</span> <span class="fu">xlim</span>(<span class="sc">-</span><span class="fl">3.5</span>, <span class="fl">2.7</span>) <span class="sc">+</span> <span class="fu">ylim</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span>) <span class="sc">+</span> <span class="fu">coord_fixed</span>()</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>gg <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> PC1n, <span class="at">y =</span> <span class="dv">0</span>), <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">xend =</span> PC1n, <span class="at">yend =</span> <span class="dv">0</span>), <span class="at">color =</span> <span class="st">"red"</span>) </span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>gg <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> PC2n), <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">yend =</span> PC2n, <span class="at">xend =</span> <span class="dv">0</span>), <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"skyblue"</span>, <span class="at">linewidth =</span> <span class="fl">1.5</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-pcablue" class="quarto-layout-panel page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-pcablue-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-pcablue" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-pcablue-1" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center" width="480">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-pcablue-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="07-chap_files/figure-html/fig-pcablue-1.png" class="lightbox" data-gallery="fig-pcablue" title="Figure&nbsp;7.16&nbsp;(a): "><img src="07-chap_files/figure-html/fig-pcablue-1.png" id="fig-pcablue-1" class="img-fluid quarto-figure quarto-figure-center anchored figure-img" data-ref-parent="fig-pcablue" width="480"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-pcablue-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a)
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-pcablue" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-pcablue-2" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center" width="480">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-pcablue-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="07-chap_files/figure-html/fig-pcablue-2.png" class="lightbox" data-gallery="fig-pcablue" title="Figure&nbsp;7.16&nbsp;(b): "><img src="07-chap_files/figure-html/fig-pcablue-2.png" id="fig-pcablue-2" class="img-fluid quarto-figure quarto-figure-center anchored figure-img" data-ref-parent="fig-pcablue" width="480"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-pcablue-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b)
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-pcablue-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7.16: In the case where we only have two original variables, the PCA transformation is a simple rotation; the new coordinates are always chosen to be the horizontal and vertical axes.
</figcaption>
</figure>
</div>
</div>
<div id="wrn-multivariate-PCAdiscusweight" class="callout callout-style-default callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Question&nbsp;7.20
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="a">
<li>What is the mean of the sums of squares of the red segments in <a href="#fig-pcablue" class="quarto-xref">Figure&nbsp;<span>7.16</span></a> equal to?<br>
</li>
<li>How does this compare to the variance of the red points?<br>
</li>
<li>Compute the ratio of the standard deviation of the blue segments to the red segments in <a href="#fig-pcablue" class="quarto-xref">Figure&nbsp;<span>7.16</span></a>. Compare this to the ratio of singular values 1 and 2.</li>
</ol>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-39-contents" aria-controls="callout-39" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-39" class="callout-39-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ol type="a">
<li>The sum of squares of the red segments corresponds to the square of the second singular value:</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(ppdf<span class="sc">$</span>PC2n<span class="sc">^</span><span class="dv">2</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 6.196729</code></pre>
</div>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>svda<span class="sc">$</span>d[<span class="dv">2</span>]<span class="sc">^</span><span class="dv">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 6.196729</code></pre>
</div>
</div>
<p>Since the mean of the red segments is zero, the above quantities are also proportional to the variance:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(ppdf<span class="sc">$</span>PC2n) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5.451106e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">var</span>(ppdf<span class="sc">$</span>PC2n) <span class="sc">*</span> (<span class="fu">nrow</span>(ppdf)<span class="sc">-</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 6.196729</code></pre>
</div>
</div>
<ol start="2" type="a">
<li>The variance of the red points is <code>var(ppdf$PC1n)</code>, which is larger than what we calculated in a) by design of the first PC.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">var</span>(ppdf<span class="sc">$</span>PC1n) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.806352</code></pre>
</div>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">var</span>(ppdf<span class="sc">$</span>PC2n) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.1936478</code></pre>
</div>
</div>
<ol start="3" type="a">
<li>We take the ratios of the standard deviations explained by the points on the vertical and horizontal axes by computing:</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sd</span>(ppdf<span class="sc">$</span>PC1n) <span class="sc">/</span> <span class="fu">sd</span>(ppdf<span class="sc">$</span>PC2n)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3.054182</code></pre>
</div>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>svda<span class="sc">$</span>d[<span class="dv">1</span>] <span class="sc">/</span> svda<span class="sc">$</span>d[<span class="dv">2</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3.054182</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Task
</div>
</div>
<div class="callout-body-container callout-body">
<p>Use <code>prcomp</code> to compute the PCA of the first two columns of the athletes data, look at the output. Compare to the singular value decomposition.</p>
</div>
</div>
<section id="pca-of-the-turtles-data" class="level3 page-columns page-full" data-number="7.7.1">
<h3 data-number="7.7.1" class="anchored" data-anchor-id="pca-of-the-turtles-data"><span class="header-section-number">7.7.1</span> PCA of the turtles data</h3>
<p>We now want to do a complete PCA analysis on the turtles data. Remember, we already looked at the summary statistics for the one- and two-dimensional data. Now we are going to answer the question about the “true” dimensionality of these rescaled data.</p>
<p>In the following code, we use the function <code>princomp</code>. Its return value is a list of all the important pieces of information needed to plot and interpret a PCA.</p>
<div class="cell page-columns page-full" data-layout-align="center">

<div class="no-row-height column-margin column-container"><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="imgs/devil.png" class="lightbox" data-gallery="quarto-lightbox-gallery-27" title="In fact, PCA is such a fundamental technique that there are many different implementations of it in various R packages. Unfortunately, the input arguments and the formatting and naming of their output is not standardized, and some even use different conventions for the scaling of their output. We will experiment with several different ones to familiarize ourselves with these choices."><img src="imgs/devil.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="123" alt="In fact, PCA is such a fundamental technique that there are many different implementations of it in various R packages. Unfortunately, the input arguments and the formatting and naming of their output is not standardized, and some even use different conventions for the scaling of their output. We will experiment with several different ones to familiarize ourselves with these choices."></a></p>
</figure>
</div>
<figcaption>In fact, PCA is such a fundamental technique that there are many different implementations of it in various R packages. Unfortunately, the input arguments and the formatting and naming of their output is not standardized, and some even use different conventions for the scaling of their output. We will experiment with several different ones to familiarize ourselves with these choices.</figcaption>
</figure>
</div>
</div></div></div>
<div class="cell page-columns page-full" data-layout-align="center">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(scaledTurtles)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          length     width    height
length 1.0000000 0.9783116 0.9646946
width  0.9783116 1.0000000 0.9605705
height 0.9646946 0.9605705 1.0000000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>pcaturtles <span class="ot">=</span> <span class="fu">princomp</span>(scaledTurtles)</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>pcaturtles</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
princomp(x = scaledTurtles)

Standard deviations:
   Comp.1    Comp.2    Comp.3 
1.6954576 0.2048201 0.1448180 

 3  variables and  48 observations.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"factoextra"</span>)</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_eig</span>(pcaturtles, <span class="at">geom =</span> <span class="st">"bar"</span>, <span class="at">bar_width =</span> <span class="fl">0.4</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

<div class="no-row-height column-margin column-container"><div class="cell-output-display">
<div id="fig-PCAturtles" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-PCAturtles-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="07-chap_files/figure-html/fig-PCAturtles-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-28" title="Figure&nbsp;7.17: The screeplot shows the eigenvalues for the standardized turtles data (scaledTurtles): there is one large value and two small ones. The data are (almost) one-dimensional. We will see why this dimension is called an axis of size, a frequent phenomenon in biometric data [@Jolicoeur1960]."><img src="07-chap_files/figure-html/fig-PCAturtles-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="240"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-PCAturtles-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7.17: The screeplot shows the eigenvalues for the standardized turtles data (<code>scaledTurtles</code>): there is one large value and two small ones. The data are (almost) one-dimensional. We will see why this dimension is called an axis of size, a frequent phenomenon in biometric data <span class="citation" data-cites="Jolicoeur1960">(<a href="16-chap.html#ref-Jolicoeur1960" role="doc-biblioref">Jolicoeur and Mosimann 1960</a>)</span>.
</figcaption>
</figure>
</div>
</div></div></div>
<div id="wrn-multivariate-pcavariations" class="callout callout-style-default callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Question&nbsp;7.21
</div>
</div>
<div class="callout-body-container callout-body">
<p>Many PCA functions have been created by different teams who worked in different areas at different times. This can lead to confusion, especially because they have different naming conventions. Let’s compare three of them; run the following lines of code and look at the resulting objects:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">svd</span>(scaledTurtles)<span class="sc">$</span>v[, <span class="dv">1</span>]</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a><span class="fu">prcomp</span>(turtles[, <span class="sc">-</span><span class="dv">1</span>])<span class="sc">$</span>rotation[, <span class="dv">1</span>]</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a><span class="fu">princomp</span>(scaledTurtles)<span class="sc">$</span>loadings[, <span class="dv">1</span>]</span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"ade4"</span>)</span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a><span class="fu">dudi.pca</span>(turtles[, <span class="sc">-</span><span class="dv">1</span>], <span class="at">nf =</span> <span class="dv">2</span>, <span class="at">scannf =</span> <span class="cn">FALSE</span>)<span class="sc">$</span>c1[, <span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>What happens when you disable the scaling in the <code>prcomp</code> and <code>princomp</code> functions?</p>
</div>
</div>
<p>In what follows, we always suppose that the matrix <span class="math inline">\(X\)</span> represents the centered and scaled matrix.</p>
<div id="wrn-multivariate-newvariables" class="callout callout-style-default callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Question&nbsp;7.22
</div>
</div>
<div class="callout-body-container callout-body">
<p>The coordinates of the observations in the new variables from the <code>prcomp</code> function (call it <code>res</code>) are in the <code>scores</code> slot of the result. Take a look at PC1 for the <code>turtles</code> and compare it to <code>res$scores</code>. Compare the standard deviation <code>sd1</code> to that in the <code>res</code> object and to the standard deviation of the scores.</p>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-43-contents" aria-controls="callout-43" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-43" class="callout-43-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>res <span class="ot">=</span> <span class="fu">princomp</span>(scaledTurtles)</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>PC1 <span class="ot">=</span> scaledTurtles <span class="sc">%*%</span> res<span class="sc">$</span>loadings[,<span class="dv">1</span>]</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>sd1 <span class="ot">=</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>(res<span class="sc">$</span>scores[, <span class="dv">1</span>]<span class="sc">^</span><span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<div id="wrn-multivariate-orthoscores" class="callout callout-style-default callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Question&nbsp;7.23
</div>
</div>
<div class="callout-body-container callout-body">
<p>Check the orthogonality of the <code>res$scores</code> matrix. Why can’t we say that it is <strong>orthonormal</strong>?</p>
</div>
</div>
<p>Now we are going to combine both the PC scores (<span class="math inline">\(US\)</span>) and the loadings-coefficients (<span class="math inline">\(V\)</span>). The plots with both the samples and the variables represented are called <strong>biplots</strong>. This can be done in one line using the following <strong><a href="https://cran.r-project.org/web/packages/factoextra/">factoextra</a></strong> package function.</p>
<div class="cell page-columns page-full" data-layout-align="center">
<div class="sourceCode cell-code" id="cb89" data-cap-location="margin"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_pca_biplot</span>(pcaturtles, <span class="at">label =</span> <span class="st">"var"</span>, <span class="at">habillage =</span> turtles[, <span class="dv">1</span>]) <span class="sc">+</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display page-columns page-full">
<div id="fig-turtlebiplot" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full" data-cap-location="margin" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-turtlebiplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="07-chap_files/figure-html/fig-turtlebiplot-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-29" title="Figure&nbsp;7.18: A biplot of the first two dimensions showing both variables and observations. The arrows show the variables. The turtles are labeled by sex. The extended horizontal direction is due to the size of the first eigenvalue, which is much larger than the second."><img src="07-chap_files/figure-html/fig-turtlebiplot-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="480"></a>
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-turtlebiplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7.18: A biplot of the first two dimensions showing both variables and observations. The arrows show the variables. The turtles are labeled by sex. The extended horizontal direction is due to the size of the first eigenvalue, which is much larger than the second.
</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell page-columns page-full" data-layout-align="center">

<div class="no-row-height column-margin column-container"><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="imgs/devil.png" class="lightbox" data-gallery="quarto-lightbox-gallery-30" title="Beware the aspect ratio when plotting a PCA. It is rare to have the two components be of similar norm, so square shaped plots will be the exception. More common are elongated plots, which show that the horizontal (first) principal component is more important than the second. This matters, e.g., for interpreting distances between points in the plots."><img src="imgs/devil.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="123" alt="Beware the aspect ratio when plotting a PCA. It is rare to have the two components be of similar norm, so square shaped plots will be the exception. More common are elongated plots, which show that the horizontal (first) principal component is more important than the second. This matters, e.g., for interpreting distances between points in the plots."></a></p>
</figure>
</div>
<figcaption>Beware the aspect ratio when plotting a PCA. It is rare to have the two components be of similar norm, so square shaped plots will be the exception. More common are elongated plots, which show that the horizontal (first) principal component is more important than the second. This matters, e.g., for interpreting distances between points in the plots.</figcaption>
</figure>
</div>
</div></div></div>
<div id="wrn-multivariate-aspectratio" class="callout callout-style-default callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Question&nbsp;7.24
</div>
</div>
<div class="callout-body-container callout-body">
<p>Is it possible to have a PCA plot with the PC1 as the horizontal axis whose height is longer than its width?</p>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-46-contents" aria-controls="callout-46" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-46" class="callout-46-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The variance of points in the PC1 direction is <span class="math inline">\(\lambda_1=s_1^2\)</span> which is always larger than <span class="math inline">\(\lambda_2=s_2^2\)</span>, so the PCA plot will always be wider than high.</p>
</div>
</div>
</div>
<div id="wrn-multivariate-PCAturtles" class="callout callout-style-default callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Question&nbsp;7.25
</div>
</div>
<div class="callout-body-container callout-body">
<p>Looking at <a href="#fig-turtlebiplot" class="quarto-xref">Figure&nbsp;<span>7.18</span></a>: a) Did the males or female turtles tend to be larger?<br>
b) What do the arrows tell us about the correlations?</p>
</div>
</div>
<div id="wrn-multivariate-Eigenturtles" class="callout callout-style-default callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Question&nbsp;7.26
</div>
</div>
<div class="callout-body-container callout-body">
<p>Compare the variance of each new coordinate to the eigenvalues returned by the PCA <code>dudi.pca</code> function.</p>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-49-contents" aria-controls="callout-49" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-49" class="callout-49-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>pcadudit <span class="ot">=</span> <span class="fu">dudi.pca</span>(scaledTurtles, <span class="at">nf =</span> <span class="dv">2</span>, <span class="at">scannf =</span> <span class="cn">FALSE</span>)</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(pcadudit<span class="sc">$</span>li, <span class="dv">2</span>, <span class="cf">function</span>(x) <span class="fu">sum</span>(x<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span><span class="dv">48</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Axis1      Axis2 
2.93573765 0.04284387 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>pcadudit<span class="sc">$</span>eig</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2.93573765 0.04284387 0.02141848</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>Now we look at the relationships between the variables, both old and new by drawing what is known as the correlation circle. The aspect ratio is 1 here and the variables are represented by arrows as shown in <a href="#fig-turtlesCirclef" class="quarto-xref">Figure&nbsp;<span>7.19</span></a>. The lengths of the arrows indicate the quality of the projections onto the first principal plane:</p>
<div class="cell page-columns page-full" data-layout-align="center">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_pca_var</span>(pcaturtles, <span class="at">col.circle =</span> <span class="st">"black"</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.2</span>, <span class="fl">1.2</span>)) <span class="sc">+</span> <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.2</span>, <span class="fl">1.2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

<div class="no-row-height column-margin column-container"><div class="cell-output-display">
<div id="fig-turtlesCirclef" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-turtlesCirclef-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="07-chap_files/figure-html/fig-turtlesCirclef-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-31" title="Figure&nbsp;7.19: Part of the “circle of correlations” showing the original variables. Their correlations with each other and with the new principal components are given by the angles between the vectors and between the axes and the vectors."><img src="07-chap_files/figure-html/fig-turtlesCirclef-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="256"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-turtlesCirclef-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7.19: Part of the “circle of correlations” showing the original variables. Their correlations with each other and with the new principal components are given by the angles between the vectors and between the axes and the vectors.
</figcaption>
</figure>
</div>
</div></div></div>
<div id="wrn-multivariate-relationsvdsd" class="callout callout-style-default callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Question&nbsp;7.27
</div>
</div>
<div class="callout-body-container callout-body">
<p>Explain the relationships between the number of rows of our turtles data matrix and the following numbers:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="fu">svd</span>(scaledTurtles)<span class="sc">$</span>d<span class="sc">/</span>pcaturtles<span class="sc">$</span>sdev</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sqrt</span>(<span class="dv">47</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-51-contents" aria-controls="callout-51" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-51" class="callout-51-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>When computing the variance covariance matrix, many implementations use <span class="math inline">\(1/(n-1)\)</span> as the denominator. Here, <span class="math inline">\(n=48\)</span> so the sum of the variances are off by a factor of 48/47.</p>
</div>
</div>
</div>
<div class="page-columns page-full"><p>These data are a good example of how sometimes almost all the variation in the data can be captured in a lower-dimensional space: here, three-dimensional data can be essentially replaced by a line.  Keep in mind: <span class="math inline">\(X^tC=VSU^tUS=VS^2.\)</span> The <strong>principal components</strong> are the columns of the matrix <span class="math inline">\(C=US\)</span>. The <span class="math inline">\(p\)</span> columns of <span class="math inline">\(U\)</span> (the matrix given as <code>USV$u</code> in the output from the <code>svd</code> function above) are rescaled to have norms <span class="math inline">\((s_1^2,s_2^2,...,s_p^2)\)</span>. Each column has a different variance it is <em>responsible</em> for explaining. Notice that these will be decreasing numbers.</p><div class="no-row-height column-margin column-container"><span class="margin-aside">If we only want the first one then it is just <span class="math inline">\(c_1=s_1 u_1\)</span>. Notice that <span class="math inline">\(||c_1||^2=s_1^tu_1 u_1^t s_1= s_1^2 u_1^tu_1=s_1^2=\lambda_1\)</span></span></div></div>
<p>If the matrix <span class="math inline">\(X\)</span> comes from the study of <span class="math inline">\(n\)</span> different samples or specimens, then the principal components provides new coordinates for these <span class="math inline">\(n\)</span> points as in <a href="#fig-pcablue" class="quarto-xref">Figure&nbsp;<span>7.16</span></a>. These are sometimes called the <em>scores</em> in the results of PCA functions.</p>
<div class="cell page-columns page-full" data-layout-align="center">

<div class="no-row-height column-margin column-container"><div class="cell-output-display">
<div id="fig-xkcd-ev" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-xkcd-ev-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="imgs/xkcdEigenVectors.jpg" class="lightbox" data-gallery="quarto-lightbox-gallery-32" title="Figure&nbsp;7.20: Another great xkcd take: this time eigenvectors."><img src="imgs/xkcdEigenVectors.jpg" class="img-fluid quarto-figure quarto-figure-center figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-xkcd-ev-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7.20: Another great xkcd take: this time eigenvectors.
</figcaption>
</figure>
</div>
</div></div></div>
<p>Before we go into more detailed examples, let’s summarize what SVD and PCA provide:</p>
<ul>
<li><p>Each principal component has a variance measured by the corresponding eigenvalue, the square of the corresponding singular value.</p></li>
<li><p>The new variables are made to be orthogonal. Since they are also centered, this means they are uncorrelated. In the case of normal distributed data, this also means they are independent. </p></li>
<li><p>When the variables are have been rescaled, the sum of the variances of all the variables is the number of variables (<span class="math inline">\(=p\)</span>). The sum of the variances is computed by adding the diagonal of the crossproduct matrix<a href="#fn9" class="footnote-ref" id="fnref9" role="doc-noteref"><sup>9</sup></a>.</p></li>
<li><p>The principal components are ordered by the size of their eigenvalues. We always check the screeplot before deciding how many components to retain. It is also best practice to do as we did in <a href="#fig-turtlebiplot" class="quarto-xref">Figure&nbsp;<span>7.18</span></a> and annotate each PC axis with the proportion of variance it explains.</p></li>
</ul>
<div class="no-row-height column-margin column-container"><span class="margin-aside"><strong>Eigen Decomposition:</strong> The crossproduct of X with itself verifies <span class="math display">\[X^tX=VSU^tUSV^t=VS^2V^t=V\Lambda V^t\]</span> where <span class="math inline">\(V\)</span> is called the eigenvector matrix of the symmetric matrix <span class="math inline">\(X^tX\)</span> and <span class="math inline">\(\Lambda\)</span> is the diagonal matrix of eigenvalues of <span class="math inline">\(X^tX\)</span>.</span><div id="fn9"><p><sup>9</sup>&nbsp;This sum of the diagonal elements is called <strong>the trace</strong> of the matrix.</p></div></div><div class="callout callout-style-default callout-tip no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Task
</div>
</div>
<div class="callout-body-container callout-body">
<p>Look up eigenvalue in the Wikipedia. Try to find a sentence that defines it without using a formula. Why would eigenvectors come into use in Cinderella (at a stretch)? (See the xkcd cartoon in <a href="#fig-xkcd-ev" class="quarto-xref">Figure&nbsp;<span>7.20</span></a>.)</p>
</div>
</div>
<div class="cell page-columns page-full" data-layout-align="center">

<div class="no-row-height column-margin column-container"><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="imgs/book_icon.png" class="lightbox" data-gallery="quarto-lightbox-gallery-33"><img src="imgs/book_icon.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="126"></a></p>
</figure>
</div>
</div></div></div>
<div class="page-columns page-full"><p></p><div class="no-row-height column-margin column-container"><span class="margin-aside">For help with the basics of linear algebra, a motivated student pressed for time may consult <a href="https://www.khanacademy.org/math/linear-algebra/alternate-bases/eigen-everything/v/linear-algebra-introduction-to-eigenvalues-and-eigenvectors">Khan’s Academy</a>. If you have more time and would like in depth coverage, <a href="http://ocw.mit.edu/courses/mathematics/18-06-linear-algebra-spring-2010">Gil Strang’s MIT course</a> is a classic, and <a href="http://math.mit.edu/linearalgebra">some of the book is available online</a> <span class="citation" data-cites="Strang:09">(<a href="16-chap.html#ref-Strang:09" role="doc-biblioref">Strang 2009</a>)</span>.</span></div></div>
</section>
<section id="a-complete-analysis-the-decathlon-athletes" class="level3 page-columns page-full" data-number="7.7.2">
<h3 data-number="7.7.2" class="anchored" data-anchor-id="a-complete-analysis-the-decathlon-athletes"><span class="header-section-number">7.7.2</span> A complete analysis: the decathlon athletes</h3>
<p>We started looking at these data earlier in this chapter. Here, we will follow step by step a complete multivariate analysis. First, let us have another look at the correlation matrix (rounded to 2 digits after the decimal point), which captures the bivariate associations. We already plotted it as a colored heatmap in <a href="#fig-heatmapathletes" class="quarto-xref">Figure&nbsp;<span>7.3</span></a>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(athletes) <span class="sc">|&gt;</span> <span class="fu">round</span>(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        m100  long weight  high  m400  m110  disc  pole javel m1500
m100    1.00 -0.54  -0.21 -0.15  0.61  0.64 -0.05 -0.39 -0.06  0.26
long   -0.54  1.00   0.14  0.27 -0.52 -0.48  0.04  0.35  0.18 -0.40
weight -0.21  0.14   1.00  0.12  0.09 -0.30  0.81  0.48  0.60  0.27
high   -0.15  0.27   0.12  1.00 -0.09 -0.31  0.15  0.21  0.12 -0.11
m400    0.61 -0.52   0.09 -0.09  1.00  0.55  0.14 -0.32  0.12  0.59
m110    0.64 -0.48  -0.30 -0.31  0.55  1.00 -0.11 -0.52 -0.06  0.14
disc   -0.05  0.04   0.81  0.15  0.14 -0.11  1.00  0.34  0.44  0.40
pole   -0.39  0.35   0.48  0.21 -0.32 -0.52  0.34  1.00  0.27 -0.03
javel  -0.06  0.18   0.60  0.12  0.12 -0.06  0.44  0.27  1.00  0.10
m1500   0.26 -0.40   0.27 -0.11  0.59  0.14  0.40 -0.03  0.10  1.00</code></pre>
</div>
</div>
<p>Then we look at the screeplot, which will help us choose a rank <span class="math inline">\(k\)</span> for representing the essence of these data.</p>
<div class="cell page-columns page-full" data-layout-align="center">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>pca.ath <span class="ot">=</span> <span class="fu">dudi.pca</span>(athletes, <span class="at">scannf =</span> <span class="cn">FALSE</span>)</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>pca.ath<span class="sc">$</span>eig</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 3.4182381 2.6063931 0.9432964 0.8780212 0.5566267 0.4912275 0.4305952
 [8] 0.3067981 0.2669494 0.1018542</code></pre>
</div>
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_eig</span>(pca.ath, <span class="at">geom =</span> <span class="st">"bar"</span>, <span class="at">bar_width =</span> <span class="fl">0.3</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

<div class="no-row-height column-margin column-container"><div class="cell-output-display">
<div id="fig-screeplota" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-screeplota-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="07-chap_files/figure-html/fig-screeplota-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-34" title="Figure&nbsp;7.21: The screeplot of the athletes data indicates that most of the variation in the data can be captured in a two-dimensional plane (spanned by the first two principal components)."><img src="07-chap_files/figure-html/fig-screeplota-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="320"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-screeplota-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7.21: The screeplot of the athletes data indicates that most of the variation in the data can be captured in a two-dimensional plane (spanned by the first two principal components).
</figcaption>
</figure>
</div>
</div></div></div>
<p>The screeplot in <a href="#fig-screeplota" class="quarto-xref">Figure&nbsp;<span>7.21</span></a> shows a clear drop in the eigenvalues after the second one. This indicates that a good approximation will be obtained at rank 2. Let’s look at an interpretation of the first two axes by projecting the loadings of the original variables onto the two new ones, the principal components.</p>
<div class="cell page-columns page-full" data-layout-align="center">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_pca_var</span>(pca.ath, <span class="at">col.var =</span> <span class="st">"blue"</span>, <span class="at">repel =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

<div class="no-row-height column-margin column-container"><div class="cell-output-display">
<div id="fig-athletecorr" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-athletecorr-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="07-chap_files/figure-html/fig-athletecorr-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-35" title="Figure&nbsp;7.22: Correlation circle of the original variables."><img src="07-chap_files/figure-html/fig-athletecorr-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="240"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-athletecorr-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7.22: Correlation circle of the original variables.
</figcaption>
</figure>
</div>
</div></div></div>
<p>The correlation circle <a href="#fig-athletecorr" class="quarto-xref">Figure&nbsp;<span>7.22</span></a> displays the projection of the original variables onto the two first new principal axes. The angles between vectors are interpreted as correlations. On the right side of the plane, we have the track and field events (m110, m100, m400, m1500), and on the left, we have the throwing and jumping events. Maybe there is an opposition of skills as characterized in the correlation matrix. We did see the correlations were negative between variables from these two groups. How can we interpret this?</p>
<p>It seems that those who throw the best have lower scores in the track competitions. In fact, if we look at the original measurements, we can see what is happening. The athletes who run in short times are the stronger ones, as are the ones who throw or jump longer distances. We should probably change the scores of the track variables and redo the analysis.</p>
<div id="wrn-multivariate-changesigns" class="callout callout-style-default callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Question&nbsp;7.28
</div>
</div>
<div class="callout-body-container callout-body">
<p>What transformations of the variables induce the best athletic performances to vary in the same direction, i.e., be mostly positively correlated?</p>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-54-contents" aria-controls="callout-54" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-54" class="callout-54-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>If we change the signs on the running performances, almost all the variables will be positively correlated.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>runningvars <span class="ot">=</span> <span class="fu">grep</span>(<span class="st">"^m"</span>, <span class="fu">colnames</span>(athletes), <span class="at">value =</span> <span class="cn">TRUE</span>)</span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>runningvars</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "m100"  "m400"  "m110"  "m1500"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>athletes[, runningvars] <span class="ot">=</span> <span class="sc">-</span>athletes[, runningvars]</span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(athletes) <span class="sc">|&gt;</span> <span class="fu">round</span>(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       m100 long weight high  m400 m110  disc pole javel m1500
m100   1.00 0.54   0.21 0.15  0.61 0.64  0.05 0.39  0.06  0.26
long   0.54 1.00   0.14 0.27  0.52 0.48  0.04 0.35  0.18  0.40
weight 0.21 0.14   1.00 0.12 -0.09 0.30  0.81 0.48  0.60 -0.27
high   0.15 0.27   0.12 1.00  0.09 0.31  0.15 0.21  0.12  0.11
m400   0.61 0.52  -0.09 0.09  1.00 0.55 -0.14 0.32 -0.12  0.59
m110   0.64 0.48   0.30 0.31  0.55 1.00  0.11 0.52  0.06  0.14
disc   0.05 0.04   0.81 0.15 -0.14 0.11  1.00 0.34  0.44 -0.40
pole   0.39 0.35   0.48 0.21  0.32 0.52  0.34 1.00  0.27  0.03
javel  0.06 0.18   0.60 0.12 -0.12 0.06  0.44 0.27  1.00 -0.10
m1500  0.26 0.40  -0.27 0.11  0.59 0.14 -0.40 0.03 -0.10  1.00</code></pre>
</div>
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>pcan.ath <span class="ot">=</span> <span class="fu">dudi.pca</span>(athletes, <span class="at">nf =</span> <span class="dv">2</span>, <span class="at">scannf =</span> <span class="cn">FALSE</span>)</span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>pcan.ath<span class="sc">$</span>eig</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 3.4182381 2.6063931 0.9432964 0.8780212 0.5566267 0.4912275 0.4305952
 [8] 0.3067981 0.2669494 0.1018542</code></pre>
</div>
</div>
<p>Now all the negative correlations are quite small. The screeplot will show no change, as the eigenvalues of the matrix are unaffected by the above sign flips. The only ouput that changes are the signs of the coefficients of the principal component loadings for the variables whose signs we flipped.</p>
</div>
</div>
</div>
<div class="cell page-columns page-full" data-layout-align="center">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_pca_var</span>(pcan.ath, <span class="at">col.var =</span> <span class="st">"blue"</span>, <span class="at">repel =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

<div class="no-row-height column-margin column-container"><div class="cell-output-display">
<div id="fig-athletecorrn" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-athletecorrn-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="07-chap_files/figure-html/fig-athletecorrn-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-36" title="Figure&nbsp;7.23: Correlation circle after changing the signs of the running variables."><img src="07-chap_files/figure-html/fig-athletecorrn-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="240"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-athletecorrn-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7.23: Correlation circle after changing the signs of the running variables.
</figcaption>
</figure>
</div>
</div></div></div>
<p><a href="#fig-athletecorrn" class="quarto-xref">Figure&nbsp;<span>7.23</span></a> shows the correlation circle of the transformed variables. We now see we have a broad common overall axis: all the arrows are pointing broadly in the same direction.</p>
<p>We now plot the athletes projected in the principal plane using:</p>
<div class="cell page-columns page-full" data-layout-align="center">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_pca_ind</span>(pcan.ath, <span class="at">repel =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">""</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

<div class="no-row-height column-margin column-container"><div class="cell-output-display">
<div id="fig-athletepc" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-athletepc-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="07-chap_files/figure-html/fig-athletepc-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-37" title="Figure&nbsp;7.24: First principal plane showing the projections of the athletes. Do you notice something about the organization of the numbers?"><img src="07-chap_files/figure-html/fig-athletepc-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="280"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-athletepc-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7.24: First principal plane showing the projections of the athletes. Do you notice something about the organization of the numbers?
</figcaption>
</figure>
</div>
</div></div></div>
<div id="wrn-multivariate-PCAnumba" class="callout callout-style-default callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Question&nbsp;7.29
</div>
</div>
<div class="callout-body-container callout-body">
<p>If we look at the athletes themselves as they are shown in <a href="#fig-athletepc" class="quarto-xref">Figure&nbsp;<span>7.24</span></a>, we notice a slight ordering effect. Do you see a relation between the performance of the athletes and their numbering in <a href="#fig-athletepc" class="quarto-xref">Figure&nbsp;<span>7.24</span></a> ?</p>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-56-contents" aria-controls="callout-56" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-56" class="callout-56-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>If you play join the dots following the order of the numbers, you will probably realize you are spending more time on one side of the plot than you would be if the numbers were randomly assigned.</p>
</div>
</div>
</div>
<p>It turns out there is complementary information available in the <code>olympic</code> dataset. An extra vector variable called <code>score</code> reports the final scores at the competition, the men’s decathlon at the 1988 Olympics.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>olympic<span class="sc">$</span>score</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 8488 8399 8328 8306 8286 8272 8216 8189 8180 8167 8143 8114 8093 8083 8036
[16] 8021 7869 7860 7859 7781 7753 7745 7743 7623 7579 7517 7505 7422 7310 7237
[31] 7231 7016 6907</code></pre>
</div>
</div>
<p>So let us look at the scatterplot comparing the first principal component coordinate of the athletes to this score. This is shown in <a href="#fig-AthleteScorePCA" class="quarto-xref">Figure&nbsp;<span>7.25</span></a>. We can see a strong correlation between the two variables. We note that athlete number 1 (who in fact won the Olympic decathlon gold medal) has the highest score, but not the highest value in PC1. Why do you think that is?</p>
<div class="cell page-columns page-full" data-layout-align="center">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> <span class="fu">tibble</span>(<span class="at">pc1 =</span> pcan.ath<span class="sc">$</span>li[, <span class="dv">1</span>], <span class="at">score =</span> olympic<span class="sc">$</span>score, <span class="at">label =</span> <span class="fu">rownames</span>(athletes)),</span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">y =</span> score, <span class="at">x =</span> pc1)) <span class="sc">+</span> </span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> label)) <span class="sc">+</span> <span class="fu">stat_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

<div class="no-row-height column-margin column-container"><div class="cell-output-display">
<div id="fig-AthleteScorePCA" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-AthleteScorePCA-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="07-chap_files/figure-html/fig-AthleteScorePCA-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-38" title="Figure&nbsp;7.25: Scatterplot between olympic$score and the first principal component. The points are labeled by their order in the data set. We can see a strong correlation. Why is it not a perfectly linear fit?"><img src="07-chap_files/figure-html/fig-AthleteScorePCA-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="280"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-AthleteScorePCA-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7.25: Scatterplot between <code>olympic$score</code> and the first principal component. The points are labeled by their order in the data set. We can see a strong correlation. Why is it not a perfectly linear fit?
</figcaption>
</figure>
</div>
</div></div></div>
</section>
<section id="how-to-choose-k-the-number-of-dimensions" class="level3 page-columns page-full" data-number="7.7.3">
<h3 data-number="7.7.3" class="anchored" data-anchor-id="how-to-choose-k-the-number-of-dimensions"><span class="header-section-number">7.7.3</span> How to choose <span class="math inline">\(k\)</span>, the number of dimensions ?</h3>
<div class="cell page-columns page-full" data-layout-align="center">

<div class="no-row-height column-margin column-container"><div class="cell-output-display">
<div id="fig-screeploteq" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-screeploteq-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="07-chap_files/figure-html/fig-screeploteq-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-39" title="Figure&nbsp;7.26: A screeplot showing ‘dangerously’ similar variances. Choosing to cutoff at a hard threshold of 80% of the variance would give unstable PC plots. With so such cutoff, the axes corresponding to the 3D subspace of 3 similar eigenvalues are unstable and cannot be individually interpreted."><img src="07-chap_files/figure-html/fig-screeploteq-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="280"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-screeploteq-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7.26: A screeplot showing ‘dangerously’ similar variances. Choosing to cutoff at a hard threshold of 80% of the variance would give unstable PC plots. With so such cutoff, the axes corresponding to the 3D subspace of 3 similar eigenvalues are unstable and cannot be individually interpreted.
</figcaption>
</figure>
</div>
</div></div></div>
<p>We have seen in the examples that the first step in PCA is to make the screeplot of the variances of the new variables (equal to the <strong>eigenvalues</strong>). We cannot decide how many dimensions are needed before seeing this plot. The reason is that there are situations when the principal components are ill-defined: when two or three successive PCs have very similar variances, giving a screeplot as in <a href="#fig-screeploteq" class="quarto-xref">Figure&nbsp;<span>7.26</span></a>, the subspace corresponding to a group of similar eigenvalues exists. In this case this would be 3D space generated by <span class="math inline">\(u_2,u_3,u_4\)</span>. The vectors are not meaningful individually and one cannot interpret their loadings. This is because a very slight change in one observations could give a completely different set of three vectors. These would generate the same 3D space, but could have very different loadings. We say the PCs are unstable.</p>
</section>
</section>
<section id="pca-as-an-exploratory-tool-using-extra-information" class="level2 page-columns page-full" data-number="7.8">
<h2 data-number="7.8" class="anchored" data-anchor-id="pca-as-an-exploratory-tool-using-extra-information"><span class="header-section-number">7.8</span> PCA as an exploratory tool: using extra information</h2>
<p>We have seen that unlike regression, PCA treats all variables equally (to the extent that they were preprocessed to have equivalent standard deviations). However, it is still possible to map other continuous variables or categorical factors onto the plots in order to help interpret the results. Often we have complementary information on the samples, for example, diagnostic labels in the diabetes data or the cell types in the T-cell gene expression data.</p>
<p>Here we see how we can use such extra variables to inform our interpretation. The best place to store such so-called <em>metadata</em> is in appropriate slots of the data object (such as in the Bioconductor <em>SummarizedExperiment</em> class); the second-best, in additional columns of the data frame that also contains the numeric data. In practice, such information is often stored in a more or less cryptic manner in the row names of the matrix. Below, we need to face the latter scenario, and we use <code>substr</code> gymnastics to extract the cell types and show the screeplot in <a href="#fig-tcellexpr" class="quarto-xref">Figure&nbsp;<span>7.27</span></a> and the PCA in <a href="#fig-tcelltypes-1" class="quarto-xref">Figure&nbsp;<span>7.28</span></a>.</p>
<div class="cell page-columns page-full" data-layout-align="center">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>pcaMsig3 <span class="ot">=</span> <span class="fu">dudi.pca</span>(Msig3transp, <span class="at">center =</span> <span class="cn">TRUE</span>, <span class="at">scale =</span> <span class="cn">TRUE</span>,</span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">scannf =</span> <span class="cn">FALSE</span>, <span class="at">nf =</span> <span class="dv">4</span>)</span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_screeplot</span>(pcaMsig3) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

<div class="no-row-height column-margin column-container"><div class="cell-output-display">
<div id="fig-tcellexpr" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-tcellexpr-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="07-chap_files/figure-html/fig-tcellexpr-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-40" title="Figure&nbsp;7.27: T-cell expression PCA screeplot."><img src="07-chap_files/figure-html/fig-tcellexpr-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="280"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-tcellexpr-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7.27: T-cell expression PCA screeplot.
</figcaption>
</figure>
</div>
</div></div></div>
<div class="cell page-columns page-full" data-layout-align="center">
<div class="sourceCode cell-code" id="cb114" data-cap-location="margin"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>ids <span class="ot">=</span> <span class="fu">rownames</span>(Msig3transp)</span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>celltypes <span class="ot">=</span> <span class="fu">factor</span>(<span class="fu">substr</span>(ids, <span class="dv">7</span>, <span class="dv">9</span>))</span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>status <span class="ot">=</span> <span class="fu">factor</span>(<span class="fu">substr</span>(ids, <span class="dv">1</span>, <span class="dv">3</span>))</span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(celltypes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-cap-location="margin"><code>celltypes
EFF MEM NAI 
 10   9  11 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb116" data-cap-location="margin"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(pcaMsig3<span class="sc">$</span>li, <span class="fu">tibble</span>(<span class="at">Cluster =</span> celltypes, <span class="at">sample =</span> ids)) <span class="sc">%&gt;%</span></span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Axis1, <span class="at">y =</span> Axis2)) <span class="sc">+</span></span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> Cluster), <span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb116-6"><a href="#cb116-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>(<span class="at">name =</span> <span class="st">"Cluster"</span>) <span class="sc">+</span> <span class="fu">coord_fixed</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display page-columns page-full">
<div id="fig-tcelltypes-1" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full" data-cap-location="margin" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-tcelltypes-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="07-chap_files/figure-html/fig-tcelltypes-1-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-41" title="Figure&nbsp;7.28: PCA of gene expression for a subset of 156 genes involved in specificities of each of the three separate T-cell types: effector, naïve and memory. Again, we see that the plot is elongated along the the first axis, as that explains much of the variance. Notice that one of the T-cells seems to be mislabeled."><img src="07-chap_files/figure-html/fig-tcelltypes-1-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="640"></a>
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-tcelltypes-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7.28: PCA of gene expression for a subset of 156 genes involved in specificities of each of the three separate T-cell types: effector, naïve and memory. Again, we see that the plot is elongated along the the first axis, as that explains much of the variance. Notice that one of the T-cells seems to be mislabeled.
</figcaption>
</figure>
</div>
</div>
</div>
<section id="mass-spectroscopy-data-analysis" class="level3 page-columns page-full" data-number="7.8.1">
<h3 data-number="7.8.1" class="anchored" data-anchor-id="mass-spectroscopy-data-analysis"><span class="header-section-number">7.8.1</span> Mass Spectroscopy Data Analysis</h3>
<p>These data requires delicate preprocessing before we obtain our desired matrix with the relevant features as columns and the samples as rows. Starting with the raw mass spectroscopy readings, the steps involve extracting peaks of relevant features, aligning them across multiple samples and estimating peak heights. We refer the reader to the vignette of the Bioconductor <strong><a href="https://bioconductor.org/packages/xcms/">xcms</a></strong> package for gruesome details. We load a matrix of data generated in such a way from the file <code>mat1xcms.RData</code>. The output of the below code is in Figures <a href="#fig-xset3scree" class="quarto-xref"><span>7.29</span></a> and <a href="#fig-Stretchedbiplot" class="quarto-xref"><span>7.30</span></a>.</p>
<div class="cell page-columns page-full" data-layout-align="center">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"../data/mat1xcms.RData"</span>)</span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(mat1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 399  12</code></pre>
</div>
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>pcamat1 <span class="ot">=</span> <span class="fu">dudi.pca</span>(<span class="fu">t</span>(mat1), <span class="at">scannf =</span> <span class="cn">FALSE</span>, <span class="at">nf =</span> <span class="dv">3</span>)</span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_eig</span>(pcamat1, <span class="at">geom =</span> <span class="st">"bar"</span>, <span class="at">bar_width =</span> <span class="fl">0.7</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

<div class="no-row-height column-margin column-container"><div class="cell-output-display">
<div id="fig-xset3scree" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-xset3scree-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="07-chap_files/figure-html/fig-xset3scree-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-42" title="Figure&nbsp;7.29: Screeplot showing the eigenvalues for the mice data."><img src="07-chap_files/figure-html/fig-xset3scree-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="320"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-xset3scree-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7.29: Screeplot showing the eigenvalues for the mice data.
</figcaption>
</figure>
</div>
</div></div></div>
<div class="cell page-columns page-full" data-layout-align="center">
<div class="sourceCode cell-code" id="cb120" data-cap-location="margin"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>dfmat1 <span class="ot">=</span> <span class="fu">cbind</span>(pcamat1<span class="sc">$</span>li, <span class="fu">tibble</span>(</span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="fu">rownames</span>(pcamat1<span class="sc">$</span>li),</span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">number =</span> <span class="fu">substr</span>(label, <span class="dv">3</span>, <span class="dv">4</span>),</span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="fu">factor</span>(<span class="fu">substr</span>(label, <span class="dv">1</span>, <span class="dv">2</span>))))</span>
<span id="cb120-5"><a href="#cb120-5" aria-hidden="true" tabindex="-1"></a>pcsplot <span class="ot">=</span> <span class="fu">ggplot</span>(dfmat1,</span>
<span id="cb120-6"><a href="#cb120-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x=</span>Axis1, <span class="at">y=</span>Axis2, <span class="at">label=</span>label, <span class="at">group=</span>number, <span class="at">colour=</span>type)) <span class="sc">+</span></span>
<span id="cb120-7"><a href="#cb120-7" aria-hidden="true" tabindex="-1"></a> <span class="fu">geom_text</span>(<span class="at">size =</span> <span class="dv">4</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>)<span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>)<span class="sc">+</span><span class="fu">ylim</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">18</span>,<span class="dv">19</span>))</span>
<span id="cb120-8"><a href="#cb120-8" aria-hidden="true" tabindex="-1"></a>pcsplot <span class="sc">+</span> <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb120-9"><a href="#cb120-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display page-columns page-full">
<div id="fig-Stretchedbiplot" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full" data-cap-location="margin" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-Stretchedbiplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="07-chap_files/figure-html/fig-Stretchedbiplot-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-43" title="Figure&nbsp;7.30: The first principal plane for the mat1 data. It explains 59% of the variance."><img src="07-chap_files/figure-html/fig-Stretchedbiplot-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="720"></a>
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-Stretchedbiplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7.30: The first principal plane for the <code>mat1</code> data. It explains 59% of the variance.
</figcaption>
</figure>
</div>
</div>
</div>
<div id="wrn-multivariate-Stretchedbiplot" class="callout callout-style-default callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Question&nbsp;7.30
</div>
</div>
<div class="callout-body-container callout-body">
<p>Looking at <a href="#fig-Stretchedbiplot" class="quarto-xref">Figure&nbsp;<span>7.30</span></a>, do the samples seem to be randomly placed in the plane? Do you notice any structure explained by the labels?</p>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-58-contents" aria-controls="callout-58" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-58" class="callout-58-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The answer becomes (even more) evident if you make this plot. Knockouts are always below their paired wildtype sample. We will revisit this example when we look at supervised multivariate methods in our next chapter.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>pcsplot <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="at">colour =</span> <span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="biplots-and-scaling" class="level3 page-columns page-full" data-number="7.8.2">
<h3 data-number="7.8.2" class="anchored" data-anchor-id="biplots-and-scaling"><span class="header-section-number">7.8.2</span> Biplots and scaling</h3>
<p>In the previous example, the number of variables measured was too large to enable useful concurrent plotting of both variables and samples. In this example we plot the PCA biplot of a simple data set where chemical measurements were made on different wines for which we also have a categorical <code>wine.class</code> variable. We start the analysis by looking at the two-dimensional correlations and a heatmap of the variables.</p>
<div class="cell page-columns page-full" data-layout-align="center">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"pheatmap"</span>)</span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"../data/wine.RData"</span>)</span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"../data/wineClass.RData"</span>)</span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a>wine[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Alcohol MalicAcid  Ash AlcAsh  Mg Phenols Flav
1   14.23      1.71 2.43   15.6 127    2.80 3.06
2   13.20      1.78 2.14   11.2 100    2.65 2.76</code></pre>
</div>
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pheatmap</span>(<span class="dv">1</span> <span class="sc">-</span> <span class="fu">cor</span>(wine), <span class="at">treeheight_row =</span> <span class="fl">0.2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

<div class="no-row-height column-margin column-container"><div class="cell-output-display">
<div id="fig-WineHeatplot" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-WineHeatplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="07-chap_files/figure-html/fig-WineHeatplot-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-44" title="Figure&nbsp;7.31: The difference between 1 and the correlation can be used as a distance between variables and is used to make a heatmap of the associations between the variables."><img src="07-chap_files/figure-html/fig-WineHeatplot-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="320"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-WineHeatplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7.31: The difference between 1 and the correlation can be used as a distance between variables and is used to make a heatmap of the associations between the variables.
</figcaption>
</figure>
</div>
</div></div></div>
<p>A <strong>biplot</strong> is a simultaneous representation of both the space of observations and the space of variables. In the case of a PCA biplot like <a href="#fig-WineBiplot2" class="quarto-xref">Figure&nbsp;<span>7.32</span></a> the arrows represent the directions of the old variables as they project onto the plane defined by the first two new axes. Here the observations are just colored dots, the color has been chosen according to which type of wine is being plotted. We can interpret the variables’ directions with regards to the sample points, for instance the blue points are from the barbera group and show higher Malic Acid content than the other wines.</p>
<div class="cell page-columns page-full" data-layout-align="center">
<div class="sourceCode cell-code" id="cb125" data-cap-location="margin"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>winePCAd <span class="ot">=</span> <span class="fu">dudi.pca</span>(wine, <span class="at">scannf=</span><span class="cn">FALSE</span>)</span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(wine.class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-cap-location="margin"><code>wine.class
    barolo grignolino    barbera 
        59         71         48 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb127" data-cap-location="margin"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_pca_biplot</span>(winePCAd, <span class="at">geom =</span> <span class="st">"point"</span>, <span class="at">habillage =</span> wine.class,</span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a>   <span class="at">col.var =</span> <span class="st">"violet"</span>, <span class="at">addEllipses =</span> <span class="cn">TRUE</span>, <span class="at">ellipse.level =</span> <span class="fl">0.69</span>) <span class="sc">+</span></span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">ggtitle</span>(<span class="st">""</span>) <span class="sc">+</span> <span class="fu">coord_fixed</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display page-columns page-full">
<div id="fig-WineBiplot2" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full" data-cap-location="margin" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-WineBiplot2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="07-chap_files/figure-html/fig-WineBiplot2-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-45" title="Figure&nbsp;7.32: PCA biplot including ellipses for the three types of wine: barolo, grignolino and barbera. For each ellipsis, the axis lengths are given by one standard deviation. Small angles between the vectors Phenols, Flav and Proa indicate that they are strongly correlated, whereas Hue and Alcohol are uncorrelated."><img src="07-chap_files/figure-html/fig-WineBiplot2-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:75.0%"></a>
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-WineBiplot2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7.32: PCA biplot including ellipses for the three types of wine: barolo, grignolino and barbera. For each ellipsis, the axis lengths are given by one standard deviation. Small angles between the vectors <code>Phenols</code>, <code>Flav</code> and <code>Proa</code> indicate that they are strongly correlated, whereas <code>Hue</code> and <code>Alcohol</code> are uncorrelated.
</figcaption>
</figure>
</div>
</div>
</div>
<p>Interpretation of multivariate plots requires the use of as much of the available information as possible; here we have used the samples and their groups as well as the variables to understand the main differences between the wines.</p>
</section>
<section id="an-example-of-weighted-pca" class="level3 page-columns page-full" data-number="7.8.3">
<h3 data-number="7.8.3" class="anchored" data-anchor-id="an-example-of-weighted-pca"><span class="header-section-number">7.8.3</span> An example of weighted PCA</h3>
<p>Sometimes we want to see variability between different groups or observations, but want to weight them. This can be the case if, e.g., the groups have very different sizes. Let’s re-examine the Hiiragi data we already saw in <a href="03-chap.html" class="quarto-xref"><span>Chapter 3</span></a>. In the code below, we select the wildtype (WT) samples and the top 100 features with the highest overall variance.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"x"</span>, <span class="at">package =</span> <span class="st">"Hiiragi2013"</span>)</span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a>xwt <span class="ot">=</span> x[, x<span class="sc">$</span>genotype <span class="sc">==</span> <span class="st">"WT"</span>]</span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a>sel <span class="ot">=</span> <span class="fu">order</span>(<span class="fu">rowVars</span>(Biobase<span class="sc">::</span><span class="fu">exprs</span>(xwt)), <span class="at">decreasing =</span> <span class="cn">TRUE</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>]</span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a>xwt <span class="ot">=</span> xwt[sel, ]</span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">=</span> <span class="fu">table</span>(xwt<span class="sc">$</span>sampleGroup)</span>
<span id="cb128-6"><a href="#cb128-6" aria-hidden="true" tabindex="-1"></a>tab</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
     E3.25 E3.5 (EPI)  E3.5 (PE) E4.5 (EPI)  E4.5 (PE) 
        36         11         11          4          4 </code></pre>
</div>
</div>
<div class="cell page-columns page-full" data-layout-align="center">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a>xwt<span class="sc">$</span>weight <span class="ot">=</span> <span class="dv">1</span> <span class="sc">/</span> <span class="fu">as.numeric</span>(tab[xwt<span class="sc">$</span>sampleGroup])</span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a>pcaMouse <span class="ot">=</span> <span class="fu">dudi.pca</span>(<span class="fu">as.data.frame</span>(<span class="fu">t</span>(Biobase<span class="sc">::</span><span class="fu">exprs</span>(xwt))),</span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">row.w =</span> xwt<span class="sc">$</span>weight,</span>
<span id="cb130-4"><a href="#cb130-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">center =</span> <span class="cn">TRUE</span>, <span class="at">scale =</span> <span class="cn">TRUE</span>, <span class="at">nf =</span> <span class="dv">2</span>, <span class="at">scannf =</span> <span class="cn">FALSE</span>)</span>
<span id="cb130-5"><a href="#cb130-5" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_eig</span>(pcaMouse) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

<div class="no-row-height column-margin column-container"><div class="cell-output-display">
<div id="fig-resPCADscree" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-resPCADscree-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="07-chap_files/figure-html/fig-resPCADscree-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-46" title="Figure&nbsp;7.33: Screeplot from the weighted PCA of the Hiiragi data. The drop after the second eigenvalue suggests that a two-dimensional PCA is appropriate."><img src="07-chap_files/figure-html/fig-resPCADscree-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="280"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-resPCADscree-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7.33: Screeplot from the weighted PCA of the Hiiragi data. The drop after the second eigenvalue suggests that a two-dimensional PCA is appropriate.
</figcaption>
</figure>
</div>
</div></div></div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_pca_ind</span>(pcaMouse, <span class="at">geom =</span> <span class="st">"point"</span>, <span class="at">col.ind =</span> xwt<span class="sc">$</span>sampleGroup) <span class="sc">+</span></span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">""</span>) <span class="sc">+</span> <span class="fu">coord_fixed</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We see from <code>tab</code> that the groups are represented rather unequally. To account for this, we reweigh each sample by the inverse of its group size. The function <code>dudi.pca</code> in the <strong><a href="https://cran.r-project.org/web/packages/ade4/">ade4</a></strong> package has a <code>row.w</code> argument into which we can enter the weights. The output of the code is in Figures <a href="#fig-resPCADscree" class="quarto-xref"><span>7.33</span></a> and <a href="#fig-resPCADplot" class="quarto-xref"><span>7.34</span></a>.</p>
<div class="cell page-columns page-full" data-layout-align="center">
<div class="cell-output-display page-columns page-full">
<div id="fig-resPCADplot" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full" data-cap-location="margin" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-resPCADplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="07-chap_files/figure-html/fig-resPCADplot-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-47" title="Figure&nbsp;7.34: Output from weighted PCA on the Hiiragi data. The samples are colored according to their groups."><img src="07-chap_files/figure-html/fig-resPCADplot-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:75.0%"></a>
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-resPCADplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7.34: Output from weighted PCA on the Hiiragi data. The samples are colored according to their groups.
</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="summary-of-this-chapter" class="level2" data-number="7.9">
<h2 data-number="7.9" class="anchored" data-anchor-id="summary-of-this-chapter"><span class="header-section-number">7.9</span> Summary of this chapter</h2>
<p><strong>Preprocessing matrices</strong> Multivariate data analyses require “conscious” preprocessing. After consulting all the means, variances and one-dimensional histograms we saw how to rescale and recenter the data.</p>
<p><strong>Projecting onto new variables</strong> We saw how we can make projections into lower dimensions (2D planes and 3D are the most frequently used) of high dimensional data without losing too much information. PCA searches for new “more informative” variables that are linear combinations of the original (old) ones.</p>
<p><strong>Matrix decomposition</strong> PCA is based on finding decompositions of the matrix <span class="math inline">\(X\)</span> called SVD. This decomposition provides a lower rank approximation and is equivalent to the eigendecomposition of <span class="math inline">\(X^tX\)</span>. The squares of the singular values are equal to the eigenvalues and to the variances of the new variables. We systematically plotted these values before deciding how many axes are necessary to reproduce the signal in the data.</p>
<p>Two eigenvalues which are quite close can give rise to scores or PC scores which are highly unstable. It is always necessary to look at the screeplot of the eigenvalues and avoid separating the axes corresponding to the these close eigenvalues. This may require using interactive three or four-dimensional projections, which are available in several R packages.</p>
<p><strong>Biplot representations</strong> The space of observations is naturally a <span class="math inline">\(p\)</span>-dimensional space (the <span class="math inline">\(p\)</span> original variables provide the coordinates). The space of variables is <span class="math inline">\(n\)</span>-dimensional. Both decompositions we have studied (singular values / eigenvalues and singular vectors / eigenvectors) provide new coordinates for both of these spaces, sometimes we call one the dual of the other. We can plot the projection of both the observations and the variables onto the same eigenvectors. This provides a biplot that can be useful for interpreting the PCA output.</p>
<p><strong>Projecting other group variables</strong> Interpretation of PCA can also be facilitated by redundant or contiguous data about the observations.</p>
</section>
<section id="further-reading" class="level2" data-number="7.10">
<h2 data-number="7.10" class="anchored" data-anchor-id="further-reading"><span class="header-section-number">7.10</span> Further reading</h2>
<p>The best way to deepen your understanding of singular value decomposition is to read Chapter 7 of <span class="citation" data-cites="Strang:09">Strang (<a href="16-chap.html#ref-Strang:09" role="doc-biblioref">2009</a>)</span>. The whole book sets the foundations for the linear algebra necessary to understanding the meaning of the rank of matrix and the duality between row spaces and column spaces <span class="citation" data-cites="frenchway">(<a href="16-chap.html#ref-frenchway" role="doc-biblioref">Holmes 2006</a>)</span>.</p>
<p>Complete textbooks have been written on the subject of PCA and related methods. <span class="citation" data-cites="Mardia">Mardia, Kent, and Bibby (<a href="16-chap.html#ref-Mardia" role="doc-biblioref">1979</a>)</span> is a standard text that covers all multivariate methods in a classical way, with linear algebra and matrices. By making the parametric assumptions that the data come from multivariate normal distributions, <span class="citation" data-cites="Mardia">Mardia, Kent, and Bibby (<a href="16-chap.html#ref-Mardia" role="doc-biblioref">1979</a>)</span> also provide inferential tests for the number of components and limiting properties for principal components. <span class="citation" data-cites="Jolliffe">Jolliffe (<a href="16-chap.html#ref-Jolliffe" role="doc-biblioref">2002</a>)</span> is a book-long treatment of everything to do with PCA with extensive examples.</p>
<p>We can incorporate supplementary information into weights for the observations and the variables. This was introduced in the 1970’s by French data scientists, see <span class="citation" data-cites="frenchway">Holmes (<a href="16-chap.html#ref-frenchway" role="doc-biblioref">2006</a>)</span> for a review and <a href="09-chap.html" class="quarto-xref"><span>Chapter 9</span></a> for further examples.</p>
<p>Improvements to the interpretation and stability of PCA can be obtained by adding a penalty that minimizes the number of nonzero coefficients that appear in the linear combinations. <span class="citation" data-cites="Zou2006">Zou, Hastie, and Tibshirani (<a href="16-chap.html#ref-Zou2006" role="doc-biblioref">2006</a>)</span> and <span class="citation" data-cites="Witten2009">Witten, Tibshirani, and Hastie (<a href="16-chap.html#ref-Witten2009" role="doc-biblioref">2009</a>)</span> have developed sparse versions of principal component analysis, and their packages <strong><a href="https://cran.r-project.org/web/packages/elasticnet/">elasticnet</a></strong> and <strong><a href="https://cran.r-project.org/web/packages/PMA/">PMA</a></strong> provide implementations in R.</p>
</section>
<section id="exercises" class="level2" data-number="7.11">
<h2 data-number="7.11" class="anchored" data-anchor-id="exercises"><span class="header-section-number">7.11</span> Exercises</h2>
<div id="imp-multivariate-svdstepbystep" class="callout callout-style-default callout-important no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise&nbsp;7.1
</div>
</div>
<div class="callout-body-container callout-body">
<p>Revise the material about svd by reading sections 1, 2, and 3 of the <a href="http://en.wikipedia.org/wiki/Singular_value_decomposition">Wikipedia article about SVD</a>. It will also be beneficial to read about the related eigenvalue decomposition by reading sections 1, 2, and 2.1 of the <a href="http://en.wikipedia.org/wiki/Eigendecomposition_of_a_matrix">Wikipedia article about eigendecomposition of a matrix</a>. We know that we can decompose a <span class="math inline">\(n\)</span> row by <span class="math inline">\(p\)</span> column rank 1 matrix <span class="math inline">\(X\)</span> as:</p>
<p><span class="math display">\[
**X** =
\begin{pmatrix}
x_{11} &amp; x_{12} &amp; ... &amp; x_{1p}\\
x_{21} &amp; x_{22} &amp; ... &amp; x_{2p}\\
\vdots &amp; \vdots &amp; \vdots &amp; \vdots \\
x_{n1} &amp; x_{n2} &amp; ... &amp; x_{np}
\end{pmatrix}
=
\begin{pmatrix}
u_{11} \\ u_{21} \\ \vdots \\ u_{n1} \\
\end{pmatrix}
\times
\begin{pmatrix}
v_{11} &amp; v_{21} &amp; \cdots &amp; v_{p1}
\end{pmatrix}
\]</span></p>
<ol type="a">
<li><p>If <span class="math inline">\(X\)</span> has no rows and no columns which are all zeros, then is this decomposition unique?<br>
</p></li>
<li><p>Generate a rank-one matrix. Start by taking a vector of length 15 with values from 2 to 30 in increments of 2, and a vector of length 4 with values 3, 6, 9, 12, then take their outer product.</p></li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a>u <span class="ot">=</span> <span class="fu">seq</span>(<span class="dv">2</span>, <span class="dv">30</span>, <span class="at">by =</span> <span class="dv">2</span>)</span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a>v <span class="ot">=</span> <span class="fu">seq</span>(<span class="dv">3</span>, <span class="dv">12</span>, <span class="at">by =</span> <span class="dv">3</span>)</span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a>X1 <span class="ot">=</span> u <span class="sc">%*%</span> <span class="fu">t</span>(v)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Why do we have to take <code>t(v)</code>?</p>
<ol start="3" type="a">
<li>Now we add some noise in the form a matrix we call <code>Materr</code> so we have an “approximately rank-one” matrix.</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a>Materr <span class="ot">=</span> <span class="fu">matrix</span>(<span class="fu">rnorm</span>(<span class="dv">60</span>,<span class="dv">1</span>),<span class="at">nrow=</span><span class="dv">15</span>,<span class="at">ncol=</span><span class="dv">4</span>)</span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a>X <span class="ot">=</span> X1<span class="sc">+</span>Materr</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Visualize <span class="math inline">\(X\)</span> using <code>ggplot</code>.</p>
<ol start="4" type="a">
<li>Redo the same analyses with a rank 2 matrix.</li>
</ol>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-60-contents" aria-controls="callout-60" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-60" class="callout-60-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Note that <code>X1</code> can also be computed as</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="fu">outer</span>(u, v)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span><span class="fu">data.frame</span>(X), <span class="fu">aes</span>(<span class="at">x=</span>X1, <span class="at">y=</span>X2, <span class="at">col=</span>X3, <span class="at">size=</span>X4)) <span class="sc">+</span> <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here we see that the data looks linear in all four dimensions. This is what it means to be of rank-one. Now let’s consider a rank 2 matrix.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">=</span> <span class="dv">100</span></span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a>p <span class="ot">=</span> <span class="dv">4</span></span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a>Y2 <span class="ot">=</span> <span class="fu">outer</span>(<span class="fu">rnorm</span>(n), <span class="fu">rnorm</span>(p)) <span class="sc">+</span> <span class="fu">outer</span>(<span class="fu">rnorm</span>(n), <span class="fu">rnorm</span>(p))</span>
<span id="cb136-4"><a href="#cb136-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(Y2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            [,1]       [,2]         [,3]        [,4]
[1,] -0.44143871  2.3213197  0.433215525 -1.35523790
[2,]  0.79620920 -1.0748037  1.217052906 -1.13096295
[3,]  0.16787281  0.2259296  0.547203332 -0.75836031
[4,]  0.87269426 -1.9208649  0.856966180 -0.38621340
[5,]  0.03751521 -0.1480678 -0.005217966  0.05864122
[6,]  0.50195482 -2.0409896 -0.108241027  0.85336630</code></pre>
</div>
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span><span class="fu">data.frame</span>(Y2), <span class="fu">aes</span>(<span class="at">x=</span>X1, <span class="at">y=</span>X2, <span class="at">col=</span>X3, <span class="at">size=</span>X4)) <span class="sc">+</span> <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now there are obviously at least two dimensions because if we project the data onto the first two coordinates (by default called <code>X1</code> and <code>X2</code> when you convert a matrix into a data frame in R), then the data varies in both dimensions. So the next step is to try to decide if there are more than two dimensions. The top right points are the closest to you (they’re biggest) and as you go down and left in the plot those points are farther away. In the left are the bluest points and they seem to get darker linearly as you move right. As you can probably tell, it is very hard to visually discover a low dimensional space in higher dimensions, even when “high dimensions” only means 4! This is one reason why we rely on the singular value decomposition.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="fu">svd</span>(Y2)<span class="sc">$</span>d <span class="co"># two non-zero eigenvalues</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2.637465e+01 1.266346e+01 3.144564e-15 1.023131e-15</code></pre>
</div>
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">=</span> Y2 <span class="sc">+</span> <span class="fu">matrix</span>(<span class="fu">rnorm</span>(n<span class="sc">*</span>p, <span class="at">sd=</span><span class="fl">0.01</span>),n,p) <span class="co"># add some noise to Y2</span></span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a><span class="fu">svd</span>(Y)<span class="sc">$</span>d <span class="co"># four non-zero eigenvalues (but only 2 big ones)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 26.39673712 12.68547439  0.10735103  0.09104741</code></pre>
</div>
</div>
<p>Here we have two dimensions which are non-zero and two dimensions which are approximately 0 (for “Y2”, they are within square root of computer tolerance of 0).</p>
</div>
</div>
</div>
<div id="imp-multivariate-elongated" class="callout callout-style-default callout-important no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise&nbsp;7.2
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="a">
<li>create a first a matrix of highly correlated bivariate data such as that shown in <a href="#fig-binormalpc" class="quarto-xref">Figure&nbsp;<span>7.35</span></a>.<br>
Hint: Use the function <code>mvrnorm</code>.</li>
</ol>
<p>Check the rank of the matrix by looking at its singular values.</p>
<ol start="2" type="a">
<li>perform a PCA and show the rotated principal component axes.</li>
</ol>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-62-contents" aria-controls="callout-62" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-62" class="callout-62-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ol type="a">
<li>we generate correlated bivariate normal data using:</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"MASS"</span>)</span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a>mu1 <span class="ot">=</span> <span class="dv">1</span>; mu2 <span class="ot">=</span> <span class="dv">2</span>; s1<span class="ot">=</span><span class="fl">2.5</span>; s2<span class="ot">=</span><span class="fl">0.8</span>; rho<span class="ot">=</span><span class="fl">0.9</span>;</span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">=</span> <span class="fu">matrix</span>(<span class="fu">c</span>(s1<span class="sc">^</span><span class="dv">2</span>, s1<span class="sc">*</span>s2<span class="sc">*</span>rho, s1<span class="sc">*</span>s2<span class="sc">*</span>rho, s2<span class="sc">^</span><span class="dv">2</span>),<span class="dv">2</span>)</span>
<span id="cb143-4"><a href="#cb143-4" aria-hidden="true" tabindex="-1"></a>sim2d <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="fu">mvrnorm</span>(<span class="dv">50</span>, <span class="at">mu =</span> <span class="fu">c</span>(mu1,mu2), <span class="at">Sigma =</span> sigma))</span>
<span id="cb143-5"><a href="#cb143-5" aria-hidden="true" tabindex="-1"></a><span class="fu">svd</span>(<span class="fu">scale</span>(sim2d))<span class="sc">$</span>d</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 9.647686 2.218592</code></pre>
</div>
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="fu">svd</span>(<span class="fu">scale</span>(sim2d))<span class="sc">$</span>v[,<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7071068 0.7071068</code></pre>
</div>
</div>
<ol start="2" type="a">
<li>We use <code>prcomp</code> to perform a PCA and the scores provide the desired rotation.</li>
</ol>
<div class="cell" data-layout-nrow="1" data-layout-align="center">
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a>respc <span class="ot">=</span> <span class="fu">princomp</span>(sim2d)</span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a>dfpc  <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">pc1=</span>respc<span class="sc">$</span>scores[,<span class="dv">1</span>], </span>
<span id="cb147-3"><a href="#cb147-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">pc2=</span>respc<span class="sc">$</span>scores[,<span class="dv">2</span>])</span>
<span id="cb147-4"><a href="#cb147-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-5"><a href="#cb147-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">data.frame</span>(sim2d), <span class="fu">aes</span>(<span class="at">x=</span>X1,<span class="at">y=</span>X2)) <span class="sc">+</span> <span class="fu">geom_point</span>()</span>
<span id="cb147-6"><a href="#cb147-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dfpc, <span class="fu">aes</span>(<span class="at">x=</span>pc1, <span class="at">y=</span>pc2)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">coord_fixed</span>(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-binormalpc" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-binormalpc-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-binormalpc" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-binormalpc-1" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-binormalpc-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="07-chap_files/figure-html/fig-binormalpc-1.png" class="lightbox" data-gallery="fig-binormalpc" title="Figure&nbsp;7.35&nbsp;(a): \text{}"><img src="07-chap_files/figure-html/fig-binormalpc-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" data-ref-parent="fig-binormalpc" width="360"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-binormalpc-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) <span class="math inline">\(\text{}\)</span>
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-binormalpc" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-binormalpc-2" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-binormalpc-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="07-chap_files/figure-html/fig-binormalpc-2.png" class="lightbox" data-gallery="fig-binormalpc" title="Figure&nbsp;7.35&nbsp;(b): \text{}"><img src="07-chap_files/figure-html/fig-binormalpc-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" data-ref-parent="fig-binormalpc" width="360"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-binormalpc-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) <span class="math inline">\(\text{}\)</span>
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-binormalpc-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7.35: The original data shown in scatterplot (A) and the plot obtained using the principal component rotation (B).
</figcaption>
</figure>
</div>
</div>
</div>
</div>
</div>
<div id="imp-multivariate-coordfixed" class="callout callout-style-default callout-important no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise&nbsp;7.3
</div>
</div>
<div class="callout-body-container callout-body">
<p>Part (a) in <a href="#fig-binormalpc" class="quarto-xref">Figure&nbsp;<span>7.35</span></a> shows a very elongated plotting region, why?<br>
What happens if you do not use the <code>coord_fixed()</code> option and have a square plotting zone? Why can this be misleading?</p>
</div>
</div>
<div id="imp-multivariate-innerworkingPCA" class="callout callout-style-default callout-important no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise&nbsp;7.4
</div>
</div>
<div class="callout-body-container callout-body">
<p>Let’s revisit the Hiiragi data and compare the weighted and unweighted approaches.</p>
<ol type="a">
<li><p>make a correlation circle for the unweighted Hiiragi data <code>xwt</code>. Which genes have the best projections on the first principal plane (best approximation)?</p></li>
<li><p>make a biplot showing the labels of the extreme gene-variables that explain most of the variance in the first plane. Add the the sample-points.</p></li>
</ol>
</div>
</div>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-Abbott:1884" class="csl-entry" role="listitem">
Abbott, Edwin A. 1884. <em>Flatland: A Romance of Many Dimensions</em>. OUP Oxford.
</div>
<div id="ref-Flury" class="csl-entry" role="listitem">
Flury, Bernard. 1997. <em>A First Course in Multivariate Statistics</em>. Springer.
</div>
<div id="ref-frenchway" class="csl-entry" role="listitem">
Holmes, Susan. 2006. <span>“Multivariate Analysis: <span class="nocase">The French way</span>.”</span> In <em>Probability and Statistics: Essays in Honor of David a. Freedman</em>, edited by D. Nolan and T. P. Speed. Vol. 56. IMS Lecture Notes–Monograph Series. Beachwood, OH: IMS. <a href="http://www.imstat.org/publications/lecnotes.htm">http://www.imstat.org/publications/lecnotes.htm</a>.
</div>
<div id="ref-holmes2005memory" class="csl-entry" role="listitem">
Holmes, Susan, Michael He, Tong Xu, and Peter P Lee. 2005. <span>“Memory t Cells Have Gene Expression Patterns Intermediate Between Naive and Effector.”</span> <em>PNAS</em> 102 (15): 5519–23.
</div>
<div id="ref-Hotelling:1933ki" class="csl-entry" role="listitem">
Hotelling, Harold. 1933. <span>“Analysis of a Complex of Statistical Variables into Principal Components.”</span> <em>Journal of Educational Psychology</em> 24 (6): 417–41.
</div>
<div id="ref-Jolicoeur1960" class="csl-entry" role="listitem">
Jolicoeur, Pierre, and James E Mosimann. 1960. <span>“Size and Shape Variation in the Painted Turtle. A Principal Component Analysis.”</span> <em>Growth</em> 24: 339–54.
</div>
<div id="ref-Jolliffe" class="csl-entry" role="listitem">
Jolliffe, Ian. 2002. <em>Principal Component Analysis</em>. Wiley Online Library.
</div>
<div id="ref-Mardia" class="csl-entry" role="listitem">
Mardia, Kanti, John T Kent, and John M Bibby. 1979. <em>Multiariate Analysis</em>. New York: Academic Press.
</div>
<div id="ref-Pearson1901" class="csl-entry" role="listitem">
Pearson, Karl. 1901. <span>“<span>LIII. O</span>n Lines and Planes of Closest Fit to Systems of Points in Space.”</span> <em>The London, Edinburgh, and Dublin Philosophical Magazine and Journal of Science</em> 2 (11): 559–72.
</div>
<div id="ref-Strang:09" class="csl-entry" role="listitem">
Strang, Gilbert. 2009. <em>Introduction to <span>L</span>inear <span>A</span>lgebra</em>. Fourth. Wellesley-Cambridge Press.
</div>
<div id="ref-Witten2009" class="csl-entry" role="listitem">
Witten, Daniela M, Robert Tibshirani, and Trevor Hastie. 2009. <span>“A Penalized Matrix Decomposition, with Applications to Sparse Principal Components and Canonical Correlation Analysis.”</span> <em>Biostatistics</em>, kxp008.
</div>
<div id="ref-Zou2006" class="csl-entry" role="listitem">
Zou, Hui, Trevor Hastie, and Robert Tibshirani. 2006. <span>“Sparse Principal Component Analysis.”</span> <em>Journal of Computational and Graphical Statistics</em> 15 (2): 265–86.
</div>
</div>
</section>


<p>Page built at 01:33 on 2025-09-01 using R version 4.5.1 (2025-06-13)</p></main> <!-- /main --></p><p class="build-date">
Support for maintaining the online version of this book is provided by <a href="http://www.denbi.de">de.NBI</a>
  <img src="imgs/denbi.png" style="vertical-align: text-top;height: 16px"><br>
For website support please contact msmith@embl.de
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
  const anchorJS_eq = new window.AnchorJS();
  anchorJS_eq.options = {
    placement: 'left',
    class: 'eq-link',
    icon: icon
  };
  anchorJS_eq.add('.anchored-eq');
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/www\.huber\.embl\.de\/msmb");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->
<script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","descPosition":"bottom","loop":false,"openEffect":"zoom","selector":".lightbox"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script>




</body></html>
